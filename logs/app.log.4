2025-11-26 22:37:06,819 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-26 22:37:06,825 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-26 22:37:06,829 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-26 22:37:06,829 - app.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-26 22:37:06,832 - app.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-26 22:37:06,832 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 17.0ms
2025-11-26 22:37:06,833 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 16.9ms
2025-11-26 22:37:06,840 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/
2025-11-26 22:37:06,840 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 22:37:06,841 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-26 22:37:06,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-26 22:37:06,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 22:37:06,841 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-26 22:37:06,841 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-26 22:37:06,842 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-26 22:37:06,842 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/
2025-11-26 22:37:06,846 - app.api.v1.endpoints.superadmin_auditoria - INFO - Superadmin 1 solicitando logs de autenticación - cliente_id: 2, page: 1
2025-11-26 22:37:06,846 - app.services.superadmin_auditoria_service - INFO - Obteniendo logs de autenticación - cliente_id: 2, page: 1
2025-11-26 22:37:06,847 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 22:37:06,848 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 22:37:06,849 - app.api.v1.endpoints.superadmin_auditoria - INFO - Logs de autenticación recuperados - Total: 7, Página: 1
2025-11-26 22:37:06,849 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/ 200 9.7ms
2025-11-26 22:37:06,851 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/
2025-11-26 22:37:06,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 22:37:06,852 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-26 22:37:06,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-26 22:37:06,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 22:37:06,852 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-26 22:37:06,852 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-26 22:37:06,852 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-26 22:37:06,853 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/
2025-11-26 22:37:06,857 - app.api.v1.endpoints.superadmin_auditoria - INFO - Superadmin 1 solicitando logs de autenticación - cliente_id: 2, page: 1
2025-11-26 22:37:06,857 - app.services.superadmin_auditoria_service - INFO - Obteniendo logs de autenticación - cliente_id: 2, page: 1
2025-11-26 22:37:06,858 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 22:37:06,859 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 22:37:06,860 - app.api.v1.endpoints.superadmin_auditoria - INFO - Logs de autenticación recuperados - Total: 7, Página: 1
2025-11-26 22:37:06,861 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/ 200 9.9ms
2025-11-26 23:07:16,159 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-26 23:07:16,159 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-26 23:07:16,161 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-26 23:07:16,161 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,162 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,162 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,175 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,179 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-26 23:07:16,179 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,179 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-26 23:07:16,182 - app.api.v1.endpoints.auth - INFO - Cliente 2 resuelto y validado para login.
2025-11-26 23:07:16,182 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-26 23:07:16,183 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-26 23:07:16,183 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,399 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,402 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,408 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-26 23:07:16,408 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-26 23:07:16,408 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,411 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,412 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-26 23:07:16,412 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,415 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-26 23:07:16,415 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 2038, Rotación: False
2025-11-26 23:07:16,415 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 2038
2025-11-26 23:07:16,415 - app.api.v1.endpoints.auth - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-26 23:07:16,416 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,419 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-26 23:07:16,419 - app.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=2, usuario_id=1, exito=True
2025-11-26 23:07:16,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 258.5ms
2025-11-26 23:07:16,427 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-26 23:07:16,428 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.7ms
2025-11-26 23:07:16,430 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-26 23:07:16,430 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,431 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,431 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,432 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,433 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,433 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-26 23:07:16,434 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,437 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,444 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,448 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,453 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-26 23:07:16,453 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-26 23:07:16,455 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=2
2025-11-26 23:07:16,457 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-26 23:07:16,460 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 30.5ms
2025-11-26 23:07:16,461 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 4.2ms
2025-11-26 23:07:16,461 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-26 23:07:16,461 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-26 23:07:16,462 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-26 23:07:16,462 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-26 23:07:16,462 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-26 23:07:16,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.8ms
2025-11-26 23:07:16,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.7ms
2025-11-26 23:07:16,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 2.5ms
2025-11-26 23:07:16,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.4ms
2025-11-26 23:07:16,465 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.3ms
2025-11-26 23:07:16,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-26 23:07:16,469 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-26 23:07:16,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,470 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,470 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,472 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,472 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,472 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-26 23:07:16,473 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-26 23:07:16,473 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,473 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,473 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,474 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,474 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,475 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,475 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,476 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-26 23:07:16,476 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,477 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,478 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,479 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,480 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-26 23:07:16,480 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-26 23:07:16,481 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,544 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-26 23:07:16,544 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-26 23:07:16,545 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,546 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,546 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,547 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,548 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,550 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,551 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-26 23:07:16,551 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,553 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-26 23:07:16,553 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-26 23:07:16,554 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,554 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,554 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,555 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,555 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,556 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,556 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-26 23:07:16,557 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,558 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,559 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,559 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,560 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,561 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,562 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-26 23:07:16,562 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-26 23:07:16,562 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,567 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,574 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-26 23:07:16,574 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-26 23:07:16,574 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-26 23:07:16,575 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-26 23:07:16,575 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-26 23:07:16,575 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-26 23:07:16,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 107.2ms
2025-11-26 23:07:16,576 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 106.8ms
2025-11-26 23:07:16,577 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 103.9ms
2025-11-26 23:07:16,579 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-26 23:07:16,580 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-26 23:07:16,580 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,580 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,581 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,582 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,582 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,582 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-26 23:07:16,582 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-26 23:07:16,583 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,583 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,583 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,584 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,585 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,585 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-26 23:07:16,585 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,586 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,587 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,588 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,589 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,590 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,591 - app.api.v1.endpoints.roles - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-26 23:07:16,591 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,592 - app.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-26 23:07:16,592 - app.api.v1.endpoints.roles - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-26 23:07:16,593 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,594 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,595 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,596 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,597 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-26 23:07:16,598 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-26 23:07:16,598 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,599 - app.utils.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-26 23:07:16,599 - app.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-26 23:07:16,600 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:16,600 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:16,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:16,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:16,600 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:16,601 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:16,601 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:16,601 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-26 23:07:16,602 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,603 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,604 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,605 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,606 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,608 - app.api.v1.endpoints.usuarios - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-26 23:07:16,608 - app.services.usuario_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-26 23:07:16,608 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,610 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:16,612 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-26 23:07:16,612 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-26 23:07:16,612 - app.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-26 23:07:16,612 - app.services.usuario_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-26 23:07:16,613 - app.services.usuario_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-26 23:07:16,613 - app.api.v1.endpoints.usuarios - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-26 23:07:16,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 34.5ms
2025-11-26 23:07:16,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 34.0ms
2025-11-26 23:07:16,614 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.8ms
2025-11-26 23:07:32,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-26 23:07:32,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-26 23:07:32,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-26 23:07:32,212 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-26 23:07:32,212 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-26 23:07:32,212 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-26 23:07:32,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-26 23:07:32,213 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-26 23:07:32,216 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-26 23:07:32,216 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-26 23:07:32,216 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-26 23:07:32,217 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:32,220 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:32,224 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-26 23:07:32,225 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-26 23:07:32,225 - app.api.v1.endpoints.auth - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-26 23:07:32,225 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-26 23:07:32,228 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-26 23:07:32,228 - app.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=2, usuario_id=1, exito=True
2025-11-26 23:07:32,229 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 17.1ms
2025-11-27 08:56:14,610 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'static', 'www', 'admin', 'backend', 'cdn', 'api'}
2025-11-27 08:56:35,465 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-27 08:56:35,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.1ms
2025-11-27 08:56:35,470 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-27 08:56:35,471 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 08:56:35,471 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 08:56:35,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 08:56:35,472 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 08:56:35,472 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 08:56:35,472 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 08:56:35,472 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 08:56:35,473 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-27 08:56:35,477 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-27 08:56:35,479 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 8.6ms
2025-11-27 09:21:04,684 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-27 09:21:04,685 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-27 09:21:04,687 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-27 09:21:04,687 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:21:04,687 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:21:04,687 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:21:04,688 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:21:04,688 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:21:04,688 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:21:04,688 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:21:04,688 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-27 09:21:04,778 - app.api.v1.endpoints.auth - INFO - Cliente 1 resuelto y validado para login.
2025-11-27 09:21:04,778 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-27 09:21:04,779 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-27 09:21:05,031 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-27 09:21:05,032 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-27 09:21:05,032 - app.api.v1.endpoints.auth - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-27 09:21:05,033 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-27 09:21:05,055 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-27 09:21:05,056 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 13394, Rotación: False
2025-11-27 09:21:05,056 - app.api.v1.endpoints.auth - INFO - [LOGIN-WEB] Token almacenado - ID: 13394
2025-11-27 09:21:05,056 - app.api.v1.endpoints.auth - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-27 09:21:05,066 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-27 09:21:05,067 - app.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-27 09:21:05,068 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 380.9ms
2025-11-27 09:21:05,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-27 09:21:05,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.7ms
2025-11-27 09:21:05,083 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-27 09:21:05,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:21:05,083 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:21:05,083 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:21:05,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:21:05,084 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:21:05,084 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:21:05,084 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:21:05,084 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-27 09:21:05,106 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-27 09:21:05,106 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-27 09:21:05,109 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-27 09:21:05,110 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 27.1ms
2025-11-27 09:21:05,117 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-27 09:21:05,118 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-27 09:21:05,118 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.4ms
2025-11-27 09:21:05,119 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-27 09:21:05,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-27 09:21:05,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:21:05,122 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:21:05,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:21:05,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:21:05,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:21:05,124 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:21:05,124 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:21:05,124 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-27 09:21:05,138 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-27 09:21:05,139 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-27 09:21:05,179 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-27 09:21:05,179 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 58.7ms
2025-11-27 09:21:05,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-27 09:21:05,181 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:21:05,181 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:21:05,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:21:05,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:21:05,182 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:21:05,182 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:21:05,182 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:21:05,183 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-27 09:21:05,186 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-27 09:21:05,186 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-27 09:21:05,187 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-27 09:21:05,188 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 7.2ms
2025-11-27 09:21:32,095 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-27 09:21:32,096 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.1ms
2025-11-27 09:21:32,097 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-27 09:21:32,098 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.3ms
2025-11-27 09:21:32,100 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-27 09:21:32,101 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:21:32,101 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:21:32,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:21:32,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:21:32,101 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:21:32,102 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:21:32,102 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:21:32,102 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-27 09:21:32,107 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-27 09:21:32,107 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-27 09:21:32,120 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-27 09:21:32,120 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 20.4ms
2025-11-27 09:21:32,122 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-27 09:21:32,123 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:21:32,123 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:21:32,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:21:32,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:21:32,123 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:21:32,124 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:21:32,124 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:21:32,124 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-27 09:21:32,127 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-27 09:21:32,127 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-27 09:21:32,129 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-27 09:21:32,130 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.6ms
2025-11-27 09:22:20,438 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-27 09:22:20,438 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-27 09:22:20,439 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-27 09:22:20,439 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-27 09:22:20,439 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 1.5ms
2025-11-27 09:22:20,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 1.3ms
2025-11-27 09:22:20,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 1.0ms
2025-11-27 09:22:20,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 1.1ms
2025-11-27 09:22:20,445 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-27 09:22:20,446 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-27 09:22:20,446 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:20,446 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:20,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:20,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:20,447 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:20,447 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:20,447 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:20,448 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-27 09:22:20,453 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-27 09:22:20,455 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:20,455 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:20,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:20,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:20,456 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:20,456 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:20,456 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:20,456 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-27 09:22:20,461 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-27 09:22:20,462 - app.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-27 09:22:20,471 - app.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-27 09:22:20,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 27.0ms
2025-11-27 09:22:20,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 26.5ms
2025-11-27 09:22:20,474 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-27 09:22:20,475 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-27 09:22:20,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:20,476 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:20,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:20,476 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:20,477 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:20,477 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:20,477 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:20,478 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-27 09:22:20,482 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-27 09:22:20,484 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:20,484 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:20,484 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:20,484 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:20,485 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:20,485 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:20,485 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:20,485 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-27 09:22:20,489 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-27 09:22:20,489 - app.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-27 09:22:20,492 - app.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-27 09:22:20,493 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 18.7ms
2025-11-27 09:22:20,494 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 18.5ms
2025-11-27 09:22:21,659 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/clientes/2/modulos/
2025-11-27 09:22:21,660 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/clientes/2/modulos/
2025-11-27 09:22:21,661 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/clientes/2/modulos/ 200 1.3ms
2025-11-27 09:22:21,661 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/clientes/2/modulos/ 200 0.8ms
2025-11-27 09:22:21,663 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/clientes/2/modulos/
2025-11-27 09:22:21,663 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:21,664 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:21,664 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:21,664 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:21,664 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:21,664 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:21,664 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:21,665 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/clientes/2/modulos/
2025-11-27 09:22:21,668 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /clientes/2/modulos/ recibida
2025-11-27 09:22:21,668 - app.services.modulo_service - INFO - Obteniendo módulos para cliente ID: 2
2025-11-27 09:22:21,673 - app.api.v1.endpoints.modulos - INFO - Módulos para cliente 2 recuperados: 5 módulos
2025-11-27 09:22:21,674 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/clientes/2/modulos/ 200 10.8ms
2025-11-27 09:22:21,676 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/clientes/2/modulos/
2025-11-27 09:22:21,676 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:21,676 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:21,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:21,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:21,677 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:21,677 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:21,677 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:21,677 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/clientes/2/modulos/
2025-11-27 09:22:21,681 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /clientes/2/modulos/ recibida
2025-11-27 09:22:21,681 - app.services.modulo_service - INFO - Obteniendo módulos para cliente ID: 2
2025-11-27 09:22:21,682 - app.api.v1.endpoints.modulos - INFO - Módulos para cliente 2 recuperados: 5 módulos
2025-11-27 09:22:21,683 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/clientes/2/modulos/ 200 7.2ms
2025-11-27 09:22:25,202 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2/
2025-11-27 09:22:25,203 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2/
2025-11-27 09:22:25,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-27 09:22:25,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2/ 200 1.7ms
2025-11-27 09:22:25,204 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-27 09:22:25,205 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2/ 200 1.9ms
2025-11-27 09:22:25,205 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.7ms
2025-11-27 09:22:25,206 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.2ms
2025-11-27 09:22:25,207 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2/
2025-11-27 09:22:25,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:25,208 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:25,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:25,208 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:25,209 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:25,209 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:25,209 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:25,209 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2/
2025-11-27 09:22:25,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-27 09:22:25,212 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-27 09:22:25,213 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-27 09:22:25,216 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-27 09:22:25,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:25,217 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:25,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:25,217 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:25,218 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:25,218 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:25,218 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:25,218 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-27 09:22:25,221 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-27 09:22:25,222 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-27 09:22:25,224 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-27 09:22:25,225 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-27 09:22:25,226 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2/ 200 18.5ms
2025-11-27 09:22:25,226 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 17.0ms
2025-11-27 09:22:25,228 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-27 09:22:25,229 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2/
2025-11-27 09:22:25,229 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:25,229 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:25,229 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:25,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:25,230 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:25,230 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:25,230 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:25,230 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-27 09:22:25,231 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:25,231 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:25,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:25,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:25,231 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:25,231 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:25,232 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:25,232 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2/
2025-11-27 09:22:25,235 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-27 09:22:25,236 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-27 09:22:25,237 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-27 09:22:25,237 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-27 09:22:25,240 - app.api.v1.endpoints.conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-27 09:22:25,240 - app.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-27 09:22:25,241 - app.api.v1.endpoints.conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-27 09:22:25,242 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 13.4ms
2025-11-27 09:22:25,242 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2/ 200 13.4ms
2025-11-27 09:22:35,487 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-27 09:22:35,488 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 0.7ms
2025-11-27 09:22:35,488 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-27 09:22:35,489 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 0.7ms
2025-11-27 09:22:35,490 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-27 09:22:35,490 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:35,491 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:35,491 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:35,491 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:35,491 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:35,491 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:35,491 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:35,492 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-27 09:22:35,496 - app.api.v1.endpoints.superadmin_usuarios - INFO - Superadmin 1 solicitando usuarios del cliente 2 - page: 1, limit: 10
2025-11-27 09:22:35,496 - app.services.superadmin_usuario_service - INFO - Obteniendo usuarios globales - cliente_id: 2, page: 1, limit: 10
2025-11-27 09:22:35,500 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-27 09:22:35,500 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,520 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,523 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,534 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,536 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,538 - app.api.v1.endpoints.superadmin_usuarios - INFO - Usuarios del cliente 2 recuperados - Total: 3, Página: 1
2025-11-27 09:22:35,539 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 48.7ms
2025-11-27 09:22:35,540 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-27 09:22:35,541 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:35,541 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:35,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:35,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:35,541 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:35,542 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:35,542 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:35,542 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-27 09:22:35,546 - app.api.v1.endpoints.superadmin_usuarios - INFO - Superadmin 1 solicitando usuarios del cliente 2 - page: 1, limit: 10
2025-11-27 09:22:35,546 - app.services.superadmin_usuario_service - INFO - Obteniendo usuarios globales - cliente_id: 2, page: 1, limit: 10
2025-11-27 09:22:35,547 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,547 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,548 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,550 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,552 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:35,554 - app.api.v1.endpoints.superadmin_usuarios - INFO - Usuarios del cliente 2 recuperados - Total: 3, Página: 1
2025-11-27 09:22:35,554 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 14.1ms
2025-11-27 09:22:37,308 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/usuarios/1/actividad/
2025-11-27 09:22:37,309 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/usuarios/1/sesiones/
2025-11-27 09:22:37,310 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/usuarios/1/actividad/ 200 1.2ms
2025-11-27 09:22:37,310 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/usuarios/1/sesiones/ 200 0.7ms
2025-11-27 09:22:37,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/usuarios/1/actividad/
2025-11-27 09:22:37,313 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:37,313 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:37,313 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:37,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:37,314 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:37,314 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:37,314 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:37,314 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/usuarios/1/actividad/
2025-11-27 09:22:37,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/usuarios/1/sesiones/
2025-11-27 09:22:37,318 - app.services.superadmin_usuario_service - INFO - Obteniendo actividad para usuario 1
2025-11-27 09:22:37,324 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:37,324 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:37,324 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:37,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:37,325 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:37,325 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:37,325 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:37,325 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/usuarios/1/sesiones/
2025-11-27 09:22:37,329 - app.services.superadmin_usuario_service - INFO - Obteniendo sesiones para usuario 1
2025-11-27 09:22:37,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/usuarios/1/actividad/ 200 24.8ms
2025-11-27 09:22:37,338 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/usuarios/1/sesiones/ 200 23.0ms
2025-11-27 09:22:57,956 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/auditoria/autenticacion/
2025-11-27 09:22:57,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/auditoria/autenticacion/ 200 0.9ms
2025-11-27 09:22:57,958 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/auditoria/autenticacion/
2025-11-27 09:22:57,958 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/auditoria/autenticacion/ 200 0.9ms
2025-11-27 09:22:57,960 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/
2025-11-27 09:22:57,960 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:57,960 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:57,960 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:57,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:57,961 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:57,961 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:57,961 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:57,961 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/
2025-11-27 09:22:57,965 - app.api.v1.endpoints.superadmin_auditoria - INFO - Superadmin 1 solicitando logs de autenticación - cliente_id: 2, page: 1
2025-11-27 09:22:57,965 - app.services.superadmin_auditoria_service - INFO - Obteniendo logs de autenticación - cliente_id: 2, page: 1
2025-11-27 09:22:57,966 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:57,971 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:57,975 - app.api.v1.endpoints.superadmin_auditoria - INFO - Logs de autenticación recuperados - Total: 9, Página: 1
2025-11-27 09:22:57,976 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/ 200 16.2ms
2025-11-27 09:22:57,978 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/
2025-11-27 09:22:57,978 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:22:57,978 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:22:57,979 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:22:57,979 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:22:57,979 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:22:57,979 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:22:57,979 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:22:57,979 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/
2025-11-27 09:22:57,983 - app.api.v1.endpoints.superadmin_auditoria - INFO - Superadmin 1 solicitando logs de autenticación - cliente_id: 2, page: 1
2025-11-27 09:22:57,983 - app.services.superadmin_auditoria_service - INFO - Obteniendo logs de autenticación - cliente_id: 2, page: 1
2025-11-27 09:22:57,984 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:57,985 - app.core.multi_db - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-27 09:22:57,986 - app.api.v1.endpoints.superadmin_auditoria - INFO - Logs de autenticación recuperados - Total: 9, Página: 1
2025-11-27 09:22:57,987 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/ 200 9.1ms
2025-11-27 09:23:00,468 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/auditoria/autenticacion/1008/
2025-11-27 09:23:00,468 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/auditoria/autenticacion/1008/ 200 0.7ms
2025-11-27 09:23:00,470 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/1008/
2025-11-27 09:23:00,471 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:23:00,471 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:23:00,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:23:00,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:23:00,471 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:23:00,471 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:23:00,472 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:23:00,472 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/1008/
2025-11-27 09:23:00,476 - app.services.superadmin_auditoria_service - INFO - Obteniendo log de autenticación ID 1008
2025-11-27 09:23:00,480 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/1008/ 200 10.2ms
2025-11-27 09:23:35,124 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/auditoria/autenticacion/1004/
2025-11-27 09:23:35,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/auditoria/autenticacion/1004/ 200 0.6ms
2025-11-27 09:23:35,127 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/1004/
2025-11-27 09:23:35,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:23:35,127 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:23:35,127 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:23:35,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:23:35,128 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:23:35,128 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:23:35,128 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:23:35,128 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/1004/
2025-11-27 09:23:35,132 - app.services.superadmin_auditoria_service - INFO - Obteniendo log de autenticación ID 1004
2025-11-27 09:23:35,134 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/1004/ 200 7.5ms
2025-11-27 09:23:49,370 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-27 09:23:49,371 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-27 09:23:49,371 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.5ms
2025-11-27 09:23:49,372 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.0ms
2025-11-27 09:23:49,375 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-27 09:23:49,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:23:49,376 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:23:49,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:23:49,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:23:49,376 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:23:49,377 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:23:49,377 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:23:49,377 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-27 09:23:49,383 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-27 09:23:49,383 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-27 09:23:49,384 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-27 09:23:49,385 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-27 09:23:49,386 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.1ms
2025-11-27 09:23:49,388 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-27 09:23:49,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:23:49,389 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:23:49,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:23:49,389 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:23:49,390 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:23:49,390 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:23:49,390 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:23:49,390 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-27 09:23:49,395 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-27 09:23:49,395 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-27 09:23:49,397 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-27 09:23:49,398 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-27 09:23:49,399 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.5ms
2025-11-27 09:23:53,747 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-27 09:23:53,748 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:23:53,748 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:23:53,749 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:23:53,749 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:23:53,749 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:23:53,749 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:23:53,749 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:23:53,750 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-27 09:23:53,754 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-27 09:23:53,754 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-27 09:23:53,756 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-27 09:23:53,757 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-27 09:23:53,757 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.7ms
2025-11-27 09:23:53,759 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-27 09:23:53,760 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-27 09:23:53,760 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-27 09:23:53,760 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-27 09:23:53,760 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-27 09:23:53,760 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-27 09:23:53,761 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-27 09:23:53,761 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-27 09:23:53,761 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-27 09:23:53,765 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-27 09:23:53,766 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-27 09:23:53,767 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-27 09:23:53,768 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-27 09:23:53,768 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.2ms
2025-11-28 18:07:27,558 - app.middleware.tenant_middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'api', 'static', 'backend', 'www', 'cdn', 'assets'}
2025-11-28 18:07:57,503 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-28 18:07:57,504 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-28 18:07:57,506 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-28 18:07:57,507 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:07:57,507 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:07:57,507 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:07:57,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:07:57,508 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:07:57,508 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:07:57,508 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:07:57,508 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-28 18:07:57,734 - app.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-28 18:07:57,740 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-28 18:07:57,756 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-28 18:07:57,765 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-28 18:07:57,766 - app.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14394, Rotación: True
2025-11-28 18:07:57,774 - app.db.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-28 18:07:57,774 - app.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-28 18:07:57,775 - app.api.v1.endpoints.auth - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-28 18:07:57,775 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14394
2025-11-28 18:07:57,775 - app.api.v1.endpoints.auth - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-28 18:07:57,796 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-28 18:07:57,797 - app.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-28 18:07:57,798 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 291.3ms
2025-11-28 18:07:57,802 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-28 18:07:57,803 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-11-28 18:07:57,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-28 18:07:57,805 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:07:57,805 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:07:57,805 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:07:57,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:07:57,806 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:07:57,806 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:07:57,806 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:07:57,806 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-28 18:07:57,809 - app.api.v1.endpoints.auth - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-28 18:07:57,809 - app.api.v1.endpoints.auth - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-28 18:07:57,810 - app.services.usuario_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-28 18:07:57,821 - app.services.usuario_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-28 18:07:57,821 - app.api.v1.endpoints.auth - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-28 18:07:57,822 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 17.5ms
2025-11-28 18:07:57,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-28 18:07:57,828 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-28 18:07:57,830 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-28 18:07:57,831 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:07:57,831 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:07:57,831 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:07:57,831 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:07:57,831 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:07:57,832 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:07:57,832 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:07:57,832 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-28 18:07:57,850 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-28 18:07:57,851 - app.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-28 18:07:57,853 - app.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-28 18:07:57,853 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 23.0ms
2025-11-28 18:07:57,887 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-28 18:07:57,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-28 18:07:57,888 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.4ms
2025-11-28 18:07:57,890 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.2ms
2025-11-28 18:07:57,892 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-28 18:07:57,892 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:07:57,893 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:07:57,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:07:57,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:07:57,893 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:07:57,893 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:07:57,894 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:07:57,894 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-28 18:07:57,897 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-28 18:07:57,897 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-28 18:07:57,948 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-28 18:07:57,949 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 56.7ms
2025-11-28 18:07:57,950 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-28 18:07:57,951 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:07:57,951 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:07:57,951 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:07:57,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:07:57,952 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:07:57,952 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:07:57,952 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:07:57,952 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-28 18:07:57,958 - app.api.v1.endpoints.menus - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-28 18:07:57,958 - app.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-28 18:07:57,959 - app.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-28 18:07:57,960 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.3ms
2025-11-28 18:08:33,685 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-28 18:08:33,686 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-28 18:08:33,687 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-28 18:08:33,688 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.3ms
2025-11-28 18:08:33,690 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-28 18:08:33,691 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:33,691 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:33,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:33,691 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:33,692 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:33,692 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:33,692 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:33,693 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-28 18:08:33,739 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-28 18:08:33,740 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-28 18:08:33,753 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-28 18:08:33,754 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 64.2ms
2025-11-28 18:08:33,756 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-28 18:08:33,756 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:33,757 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:33,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:33,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:33,757 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:33,758 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:33,758 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:33,758 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-28 18:08:33,762 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-28 18:08:33,762 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-28 18:08:33,764 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-28 18:08:33,765 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.9ms
2025-11-28 18:08:35,017 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-28 18:08:35,017 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-28 18:08:35,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.0ms
2025-11-28 18:08:35,018 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-28 18:08:35,021 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-28 18:08:35,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:35,021 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:35,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:35,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:35,022 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:35,022 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:35,022 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:35,022 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-28 18:08:35,029 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-28 18:08:35,029 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-28 18:08:35,051 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-28 18:08:35,053 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-28 18:08:35,054 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 33.5ms
2025-11-28 18:08:35,056 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-28 18:08:35,056 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:35,056 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:35,057 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:35,057 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:35,057 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:35,057 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:35,058 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:35,058 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-28 18:08:35,062 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-28 18:08:35,062 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-28 18:08:35,063 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-28 18:08:35,064 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-28 18:08:35,065 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.9ms
2025-11-28 18:08:37,330 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-28 18:08:37,331 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:37,331 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:37,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:37,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:37,331 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:37,332 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:37,332 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:37,332 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-28 18:08:37,336 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-28 18:08:37,336 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-28 18:08:37,339 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-28 18:08:37,340 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-28 18:08:37,341 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.8ms
2025-11-28 18:08:37,344 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-28 18:08:37,344 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:37,345 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:37,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:37,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:37,345 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:37,345 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:37,346 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:37,346 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-28 18:08:37,350 - app.api.v1.endpoints.modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-28 18:08:37,351 - app.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-28 18:08:37,352 - app.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-28 18:08:37,353 - app.api.v1.endpoints.modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-28 18:08:37,354 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.1ms
2025-11-28 18:08:37,849 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-28 18:08:37,850 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:37,850 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:37,850 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:37,850 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:37,851 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:37,851 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:37,851 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:37,851 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-28 18:08:37,856 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-28 18:08:37,856 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-28 18:08:37,858 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-28 18:08:37,859 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.6ms
2025-11-28 18:08:37,861 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-28 18:08:37,862 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:08:37,862 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-28 18:08:37,862 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-28 18:08:37,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:08:37,863 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-28 18:08:37,863 - app.middleware.tenant_middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-28 18:08:37,863 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-28 18:08:37,864 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-28 18:08:37,868 - app.api.v1.endpoints.clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-28 18:08:37,868 - app.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-28 18:08:37,870 - app.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-28 18:08:37,870 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.0ms
2025-11-28 18:10:10,486 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-28 18:10:10,486 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-28 18:10:10,489 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-28 18:10:10,489 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-28 18:10:10,489 - app.middleware.tenant_middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': global.app.local:5173
2025-11-28 18:10:10,489 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-28 18:10:10,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-28 18:10:10,490 - app.middleware.tenant_middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-28 18:10:10,511 - app.middleware.tenant_middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', Código='GLOBAL004', ID=5
2025-11-28 18:10:10,519 - app.core.multi_db - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-28 18:10:10,519 - app.middleware.tenant_middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-28 18:10:10,519 - app.middleware.tenant_middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-28 18:10:10,526 - app.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-28 18:10:10,526 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-28 18:10:10,555 - app.db.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-28 18:10:10,556 - app.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_invalid_or_revoked, cliente_id=1, usuario_id=None, exito=False
2025-11-28 18:10:10,556 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 67.7ms
2025-11-29 00:31:56,480 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'cdn', 'static', 'backend', 'api', 'assets', 'www'}
2025-11-29 00:32:14,256 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'backend', 'admin', 'cdn', 'static', 'api', 'www'}
2025-11-29 00:32:37,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 00:32:37,436 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:32:37,437 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 00:32:37,437 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 00:32:37,438 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:32:37,438 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 00:32:37,438 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 00:32:37,438 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:32:37,439 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 00:32:37,440 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 4.5ms
2025-11-29 00:32:37,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 00:32:37,652 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:32:37,652 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 00:32:37,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 00:32:37,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:32:37,653 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 00:32:37,653 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 00:32:37,654 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:32:37,654 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 00:32:37,892 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 240.2ms
2025-11-29 00:32:52,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 00:32:52,418 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:32:52,418 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 00:32:52,418 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 00:32:52,419 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:32:52,419 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 00:32:52,419 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 00:32:52,419 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:32:52,419 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 00:32:52,508 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 00:32:52,508 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 00:32:52,508 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 00:32:52,752 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:32:52,753 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 00:32:52,753 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 00:32:52,754 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:32:52,767 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:32:52,768 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14395, Rotación: False
2025-11-29 00:32:52,768 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14395
2025-11-29 00:32:52,768 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 00:32:52,773 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:32:52,774 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 00:32:52,775 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 357.1ms
2025-11-29 00:33:07,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/test
2025-11-29 00:33:07,149 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:07,149 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 00:33:07,149 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 00:33:07,149 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:07,150 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 00:33:07,150 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 00:33:07,150 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:07,150 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/test
2025-11-29 00:33:07,151 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/test 200 2.9ms
2025-11-29 00:33:28,550 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 00:33:28,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-29 00:33:28,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 00:33:28,555 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:28,555 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:28,555 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:28,556 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:28,556 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:28,556 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:28,557 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:28,557 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 00:33:28,566 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 00:33:28,572 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 00:33:28,573 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:33:28,580 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:33:28,581 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14396, Rotación: True
2025-11-29 00:33:28,586 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 00:33:28,587 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 00:33:28,587 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 00:33:28,588 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14396
2025-11-29 00:33:28,588 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 00:33:28,592 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:33:28,593 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 00:33:28,593 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 39.3ms
2025-11-29 00:33:28,598 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-29 00:33:28,598 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-11-29 00:33:28,600 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 00:33:28,600 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:28,601 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:28,601 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:28,601 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:28,601 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:28,601 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:28,602 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:28,602 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 00:33:28,605 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 00:33:28,605 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 00:33:28,605 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 00:33:28,623 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 00:33:28,623 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 00:33:28,624 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 23.7ms
2025-11-29 00:33:28,628 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-29 00:33:28,628 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.4ms
2025-11-29 00:33:28,631 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 00:33:28,631 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:28,632 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:28,632 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:28,632 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:28,632 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:28,632 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:28,632 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:28,633 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 00:33:28,652 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 00:33:28,653 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 00:33:28,655 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 00:33:28,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 24.8ms
2025-11-29 00:33:28,666 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 00:33:28,667 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.1ms
2025-11-29 00:33:28,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 00:33:28,670 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 00:33:28,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 00:33:28,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.5ms
2025-11-29 00:33:28,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 2.2ms
2025-11-29 00:33:28,673 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:33:28,673 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.9ms
2025-11-29 00:33:28,675 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:28,675 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:28,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:28,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:28,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:28,675 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:28,676 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:28,676 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:33:28,680 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:33:28,681 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:33:28,725 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:33:28,727 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:33:28,727 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 54.2ms
2025-11-29 00:33:28,727 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:28,728 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:28,728 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:28,728 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:28,728 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:28,728 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:28,728 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:28,729 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:33:28,733 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:33:28,733 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:33:28,747 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:33:28,749 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 22.7ms
2025-11-29 00:33:28,750 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:33:28,750 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:28,751 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:28,751 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:28,751 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:28,751 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:28,752 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:28,752 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:28,752 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:33:28,756 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:33:28,757 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:33:28,758 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:33:28,759 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:33:28,760 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:28,760 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:28,760 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:28,760 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:28,760 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:28,760 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:28,761 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:28,761 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:33:28,766 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:33:28,766 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:33:28,768 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:33:28,769 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.6ms
2025-11-29 00:33:28,771 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.8ms
2025-11-29 00:33:31,135 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 00:33:31,136 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.2ms
2025-11-29 00:33:31,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 00:33:31,138 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.3ms
2025-11-29 00:33:31,140 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 00:33:31,140 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:31,141 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:31,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:31,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:31,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:31,141 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:31,142 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:31,142 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 00:33:31,147 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 00:33:31,147 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 00:33:31,153 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 00:33:31,155 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 00:33:31,156 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 15.9ms
2025-11-29 00:33:31,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 00:33:31,158 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:31,158 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:31,159 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:31,159 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:31,159 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:31,159 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:31,159 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:31,159 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 00:33:31,163 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 00:33:31,163 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 00:33:31,164 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 00:33:31,165 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 00:33:31,166 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.8ms
2025-11-29 00:33:32,195 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:33:32,195 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:32,195 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:32,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:32,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:32,196 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:32,196 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:32,196 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:32,196 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:33:32,200 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:33:32,201 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:33:32,203 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:33:32,204 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.3ms
2025-11-29 00:33:32,206 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:33:32,206 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:32,207 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:32,207 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:32,207 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:32,207 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:32,208 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:32,208 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:32,208 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:33:32,213 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:33:32,213 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:33:32,215 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:33:32,216 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.0ms
2025-11-29 00:33:33,111 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 00:33:33,112 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:33,112 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:33,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:33,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:33,113 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:33,113 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:33,113 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:33,113 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 00:33:33,118 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 00:33:33,118 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 00:33:33,119 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 00:33:33,120 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 00:33:33,121 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.6ms
2025-11-29 00:33:33,123 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 00:33:33,123 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:33,123 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:33,123 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:33,124 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:33,124 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:33,124 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:33,124 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:33,124 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 00:33:33,128 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 00:33:33,129 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 00:33:33,130 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 00:33:33,131 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 00:33:33,131 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.7ms
2025-11-29 00:33:34,646 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:33:34,647 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:34,647 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:34,647 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:34,648 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:34,648 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:34,648 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:34,648 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:34,648 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:33:34,652 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:33:34,652 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:33:34,655 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:33:34,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.1ms
2025-11-29 00:33:34,657 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:33:34,658 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:34,658 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:34,658 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:34,659 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:34,659 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:34,659 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:34,659 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:34,660 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:33:34,664 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:33:34,664 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:33:34,666 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:33:34,667 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.4ms
2025-11-29 00:33:39,749 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 00:33:39,750 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-29 00:33:39,752 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 00:33:39,753 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:39,753 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:39,753 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:39,753 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:39,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:39,757 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:39,764 - app.core.tenant.routing - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-29 00:33:39,765 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:39,765 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-29 00:33:39,768 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:39,793 - app.modules.auth.application.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-29 00:33:39,793 - app.core.auth - WARNING - [REFRESH] Token JWT válido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-29 00:33:39,793 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:39,800 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:33:39,801 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_invalid_or_revoked, cliente_id=1, usuario_id=None, exito=False
2025-11-29 00:33:39,801 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 49.1ms
2025-11-29 00:33:51,395 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-29 00:33:51,396 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-29 00:33:51,397 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 00:33:51,398 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:51,398 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:51,398 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:51,398 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:51,398 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:51,399 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:51,399 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:51,400 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-29 00:33:51,402 - app.modules.auth.presentation.endpoints - INFO - Cliente 2 resuelto y validado para login.
2025-11-29 00:33:51,402 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-29 00:33:51,402 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-29 00:33:51,402 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,616 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,618 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,624 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-29 00:33:51,624 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-29 00:33:51,624 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,628 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,629 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-29 00:33:51,629 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,637 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:33:51,638 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 2039, Rotación: False
2025-11-29 00:33:51,638 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 2039
2025-11-29 00:33:51,638 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-29 00:33:51,638 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,642 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:33:51,642 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=2, usuario_id=1, exito=True
2025-11-29 00:33:51,643 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 245.3ms
2025-11-29 00:33:51,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-29 00:33:51,653 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.7ms
2025-11-29 00:33:51,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 00:33:51,655 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:51,655 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:51,656 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:51,656 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:51,656 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:51,657 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:51,657 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:51,657 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-29 00:33:51,658 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,661 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,667 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,673 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,678 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-29 00:33:51,678 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-29 00:33:51,679 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=2
2025-11-29 00:33:51,680 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 00:33:51,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 26.4ms
2025-11-29 00:33:51,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-29 00:33:51,681 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 00:33:51,682 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-29 00:33:51,685 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:33:51,686 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:51,686 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:51,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:51,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:51,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:51,687 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:51,688 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:51,688 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-29 00:33:51,688 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,689 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,691 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,692 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,693 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-29 00:33:51,693 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:33:51,693 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,753 - app.modules.menus.application.services.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-29 00:33:51,753 - app.modules.menus.application.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-29 00:33:51,754 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 69.0ms
2025-11-29 00:33:51,756 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:33:51,756 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:51,756 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:51,757 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:51,757 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:51,757 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:51,758 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:51,758 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:51,758 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-29 00:33:51,759 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,760 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,761 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,762 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,762 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-29 00:33:51,763 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:33:51,763 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:51,764 - app.modules.menus.application.services.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-29 00:33:51,764 - app.modules.menus.application.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-29 00:33:51,765 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.1ms
2025-11-29 00:33:53,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-29 00:33:53,231 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-29 00:33:53,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.8ms
2025-11-29 00:33:53,232 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:33:53,233 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.7ms
2025-11-29 00:33:53,234 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:53,234 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:53,234 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:53,234 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:53,235 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:53,236 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:53,236 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:53,236 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-29 00:33:53,238 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,239 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,240 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,241 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,242 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-29 00:33:53,242 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:33:53,243 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,244 - app.modules.menus.application.services.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-29 00:33:53,245 - app.modules.menus.application.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-29 00:33:53,246 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-29 00:33:53,246 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:53,247 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:53,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:53,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:53,247 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:53,248 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:53,248 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:53,249 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-29 00:33:53,249 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,250 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,251 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,252 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,253 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,255 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,256 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-29 00:33:53,256 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 00:33:53,257 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-29 00:33:53,257 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,261 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-29 00:33:53,261 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,264 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-29 00:33:53,264 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:53,265 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:53,265 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:53,265 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-29 00:33:53,265 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-29 00:33:53,266 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 33.3ms
2025-11-29 00:33:53,267 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 20.9ms
2025-11-29 00:33:53,268 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:33:53,269 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:53,269 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:53,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:53,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:53,270 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:53,271 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:53,271 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:53,271 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-29 00:33:53,272 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,273 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,274 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,275 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,276 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-29 00:33:53,276 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:33:53,276 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,278 - app.modules.menus.application.services.menu_helper - INFO - Árbol de menú construido con 5 items raíz.
2025-11-29 00:33:53,278 - app.modules.menus.application.services.menu_service - INFO - Árbol de menú construido para usuario 1 con 5 items raíz.
2025-11-29 00:33:53,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-29 00:33:53,279 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:53,279 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:53,279 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:53,279 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:53,280 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:53,281 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:53,281 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:53,281 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-29 00:33:53,282 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,283 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,284 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,285 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,286 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,287 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,288 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-29 00:33:53,288 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 00:33:53,288 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-29 00:33:53,288 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,290 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-29 00:33:53,290 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:53,292 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la página 1 de 3 totales
2025-11-29 00:33:53,292 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:53,292 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:53,292 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:53,292 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, Página: 1/1, Resultados: 3
2025-11-29 00:33:53,293 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-29 00:33:53,293 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 25.0ms
2025-11-29 00:33:53,294 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 15.7ms
2025-11-29 00:33:54,244 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-29 00:33:54,245 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.9ms
2025-11-29 00:33:54,245 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-29 00:33:54,246 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.9ms
2025-11-29 00:33:54,247 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-29 00:33:54,248 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:54,248 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:54,249 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:54,249 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:54,249 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:54,252 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:54,253 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:54,253 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-29 00:33:54,254 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,256 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,257 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,258 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,260 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,261 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,262 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-29 00:33:54,262 - app.modules.menus.application.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-29 00:33:54,262 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,266 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,269 - app.modules.menus.application.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-29 00:33:54,270 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-29 00:33:54,270 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 22.9ms
2025-11-29 00:33:54,272 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-29 00:33:54,272 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:54,273 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:54,273 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:54,273 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:54,273 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:54,274 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:54,274 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:54,274 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-29 00:33:54,275 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,276 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,277 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,278 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,279 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,280 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,280 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - Paginación: skip=0, limit=10, Búsqueda: 'None'
2025-11-29 00:33:54,281 - app.modules.menus.application.services.area_service - INFO - Obteniendo áreas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-29 00:33:54,281 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,282 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:54,284 - app.modules.menus.application.services.area_service - INFO - Paginación completada para cliente 2: 2 áreas de 2 totales
2025-11-29 00:33:54,284 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de áreas recuperada para cliente 2 - Total: 2, Página: 1
2025-11-29 00:33:54,285 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 12.7ms
2025-11-29 00:33:54,986 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-29 00:33:54,987 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-29 00:33:54,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.6ms
2025-11-29 00:33:54,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.5ms
2025-11-29 00:33:54,990 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-29 00:33:54,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-29 00:33:54,992 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.8ms
2025-11-29 00:33:54,992 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.7ms
2025-11-29 00:33:54,993 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-29 00:33:54,993 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-29 00:33:54,995 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:54,995 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:54,995 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:54,995 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:54,995 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:54,997 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:54,997 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:54,997 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-29 00:33:54,998 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:54,998 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:54,998 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:54,998 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:54,998 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:54,999 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:54,999 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:55,000 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-29 00:33:55,000 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,001 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,002 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,003 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,004 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,005 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,006 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-29 00:33:55,006 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 00:33:55,006 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,011 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,018 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:55,018 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:55,018 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:55,018 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-29 00:33:55,019 - app.modules.users.application.services.user_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-29 00:33:55,019 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-29 00:33:55,020 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,021 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,021 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,022 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,023 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,024 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,025 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-29 00:33:55,025 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,027 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-29 00:33:55,027 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-29 00:33:55,028 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 35.3ms
2025-11-29 00:33:55,028 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 35.3ms
2025-11-29 00:33:55,030 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-29 00:33:55,031 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:55,031 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:55,032 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:55,032 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:55,032 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:55,033 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:55,033 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:55,033 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-29 00:33:55,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-29 00:33:55,034 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,035 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,036 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,037 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,038 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,038 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,039 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - Paginación: page=1, limit=10, Búsqueda: 'None'
2025-11-29 00:33:55,040 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 00:33:55,040 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,041 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,044 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:55,044 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:55,044 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 00:33:55,044 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios únicos de 3 filas crudas
2025-11-29 00:33:55,045 - app.modules.users.application.services.user_service - INFO - Obtención paginada de usuarios completada exitosamente
2025-11-29 00:33:55,045 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, Página: 1
2025-11-29 00:33:55,045 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:55,046 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:55,046 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:55,046 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:55,046 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:55,047 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:55,047 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:55,048 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-29 00:33:55,048 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,049 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,050 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,051 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,052 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,053 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,053 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-29 00:33:55,054 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:55,054 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-29 00:33:55,055 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-29 00:33:55,055 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 25.1ms
2025-11-29 00:33:55,056 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 22.5ms
2025-11-29 00:33:56,817 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-29 00:33:56,817 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-29 00:33:56,818 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-29 00:33:56,819 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:56,819 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': acme.app.local:5173
2025-11-29 00:33:56,819 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 00:33:56,819 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:56,819 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 00:33:56,820 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', Código='ACME001', ID=2
2025-11-29 00:33:56,821 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 00:33:56,821 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-29 00:33:56,821 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:56,823 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:56,827 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 00:33:56,827 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-29 00:33:56,827 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-29 00:33:56,827 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 00:33:56,830 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:33:56,831 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=2, usuario_id=1, exito=True
2025-11-29 00:33:56,831 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 13.0ms
2025-11-29 00:33:59,266 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 00:33:59,267 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:59,267 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:59,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:59,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:59,269 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:59,269 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:59,269 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:59,269 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 00:33:59,274 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 00:33:59,274 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 00:33:59,276 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 00:33:59,277 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 00:33:59,278 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.1ms
2025-11-29 00:33:59,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 00:33:59,280 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:33:59,281 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:33:59,281 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:33:59,281 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:33:59,281 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:33:59,281 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:33:59,281 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:33:59,282 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 00:33:59,286 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 00:33:59,286 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 00:33:59,287 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 00:33:59,288 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 00:33:59,289 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.3ms
2025-11-29 00:34:00,146 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 00:34:00,146 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:00,147 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:00,147 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:00,147 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:00,147 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:00,148 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:00,148 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:00,148 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 00:34:00,149 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-29 00:34:00,150 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4.1ms
2025-11-29 00:34:07,002 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-29 00:34:07,003 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-29 00:34:07,005 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 00:34:07,005 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:07,005 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:07,006 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:07,006 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:07,006 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:07,006 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:07,006 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:07,006 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 00:34:07,009 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 00:34:07,009 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 00:34:07,009 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 00:34:07,219 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:34:07,219 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 00:34:07,220 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 00:34:07,220 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:34:07,222 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:07,222 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14397, Rotación: False
2025-11-29 00:34:07,222 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14397
2025-11-29 00:34:07,222 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 00:34:07,224 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:07,224 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 00:34:07,225 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 219.9ms
2025-11-29 00:34:07,233 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 00:34:07,234 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:07,234 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:07,234 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:07,235 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:07,235 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:07,235 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:07,235 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:07,235 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 00:34:07,240 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 00:34:07,240 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 00:34:07,241 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 00:34:07,242 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 8.5ms
2025-11-29 00:34:07,255 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:07,255 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:07,255 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:07,256 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:07,256 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:07,256 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:07,256 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:07,256 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:07,256 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:07,261 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:07,262 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:07,264 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:07,265 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.8ms
2025-11-29 00:34:07,315 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:07,315 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:07,315 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:07,316 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:07,316 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:07,316 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:07,316 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:07,316 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:07,317 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:07,320 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:07,320 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:07,321 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:07,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.8ms
2025-11-29 00:34:08,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:08,564 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:08,564 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:08,565 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:08,565 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:08,565 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:08,565 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:08,565 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:08,565 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:08,569 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:08,569 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:08,571 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:08,572 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.6ms
2025-11-29 00:34:08,574 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:08,575 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:08,575 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:08,575 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:08,575 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:08,575 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:08,576 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:08,576 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:08,576 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:08,580 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:08,580 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:08,582 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:08,583 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.9ms
2025-11-29 00:34:09,498 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 00:34:09,499 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:09,499 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:09,499 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:09,499 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:09,499 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:09,500 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:09,500 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:09,500 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 00:34:09,502 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 00:34:09,503 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 00:34:09,504 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:34:09,507 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:09,508 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14398, Rotación: True
2025-11-29 00:34:09,509 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 00:34:09,509 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 00:34:09,510 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 00:34:09,510 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14398
2025-11-29 00:34:09,510 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 00:34:09,512 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:09,513 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 00:34:09,513 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 14.9ms
2025-11-29 00:34:09,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 00:34:09,518 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:09,518 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:09,518 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:09,518 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:09,518 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:09,518 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:09,519 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:09,519 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 00:34:09,520 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 00:34:09,520 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 00:34:09,520 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 00:34:09,522 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 00:34:09,523 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 00:34:09,523 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.1ms
2025-11-29 00:34:09,527 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 00:34:09,528 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:09,528 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:09,528 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:09,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:09,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:09,529 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:09,529 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:09,529 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 00:34:09,533 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 00:34:09,533 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 00:34:09,534 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 00:34:09,535 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 7.1ms
2025-11-29 00:34:09,539 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:09,540 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:09,541 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:09,541 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:09,541 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:09,541 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:09,541 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:09,541 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:09,542 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:09,542 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:09,547 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:09,547 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:09,548 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:09,549 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:09,549 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:09,549 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:09,549 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:09,550 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:09,550 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:09,550 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:09,550 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:09,553 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:09,553 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:09,555 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:09,555 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.9ms
2025-11-29 00:34:09,556 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.8ms
2025-11-29 00:34:09,558 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:09,559 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:09,559 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:09,559 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:09,559 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:09,560 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:09,560 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:09,560 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:09,560 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:09,560 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:09,564 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:09,564 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:09,565 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:09,566 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:09,566 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:09,567 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:09,567 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:09,567 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:09,567 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:09,567 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:09,567 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:09,571 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:09,571 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:09,573 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:09,574 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.3ms
2025-11-29 00:34:09,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.4ms
2025-11-29 00:34:10,307 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 00:34:10,307 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:10,308 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:10,308 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:10,308 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:10,308 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:10,308 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:10,308 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:10,309 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 00:34:10,311 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 00:34:10,313 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 00:34:10,314 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:34:10,316 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:10,317 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14399, Rotación: True
2025-11-29 00:34:10,318 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 00:34:10,319 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 00:34:10,319 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 00:34:10,319 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14399
2025-11-29 00:34:10,319 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 00:34:10,321 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:10,322 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 00:34:10,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 15.7ms
2025-11-29 00:34:10,328 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 00:34:10,329 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:10,329 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:10,329 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:10,329 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:10,330 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:10,330 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:10,330 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:10,330 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 00:34:10,331 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 00:34:10,332 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 00:34:10,332 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 00:34:10,334 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 00:34:10,334 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 00:34:10,335 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.3ms
2025-11-29 00:34:10,338 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 00:34:10,339 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:10,339 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:10,339 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:10,339 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:10,340 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:10,340 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:10,340 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:10,340 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 00:34:10,344 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 00:34:10,344 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 00:34:10,345 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 00:34:10,346 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 7.4ms
2025-11-29 00:34:10,351 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:10,352 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:10,352 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:10,352 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:10,353 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:10,353 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:10,353 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:10,353 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:10,353 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:10,353 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:10,357 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:10,357 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:10,358 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:10,359 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:10,359 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:10,359 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:10,359 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:10,359 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:10,359 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:10,360 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:10,360 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:10,363 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:10,363 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:10,365 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:10,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.2ms
2025-11-29 00:34:10,367 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.9ms
2025-11-29 00:34:10,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:10,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:10,370 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:10,370 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:10,370 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:10,370 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:10,371 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:10,371 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:10,371 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:10,371 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:10,375 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:10,375 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:10,376 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:10,377 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:10,377 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:10,377 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:10,377 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:10,377 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:10,378 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:10,378 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:10,378 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:10,381 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:10,381 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:10,383 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:10,384 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 15.0ms
2025-11-29 00:34:10,384 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.9ms
2025-11-29 00:34:16,752 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 00:34:16,753 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:16,753 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:16,753 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:16,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:16,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:16,754 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:16,754 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:16,754 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 00:34:16,757 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 00:34:16,758 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 00:34:16,759 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 00:34:16,764 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:16,765 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14400, Rotación: True
2025-11-29 00:34:16,768 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 00:34:16,768 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 00:34:16,768 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 00:34:16,769 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14400
2025-11-29 00:34:16,769 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 00:34:16,772 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 00:34:16,773 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 00:34:16,774 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 21.5ms
2025-11-29 00:34:16,778 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 00:34:16,779 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:16,779 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:16,779 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:16,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:16,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:16,780 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:16,780 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:16,780 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 00:34:16,782 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 00:34:16,782 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 00:34:16,783 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 00:34:16,785 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 00:34:16,785 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 00:34:16,786 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 7.6ms
2025-11-29 00:34:16,790 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 00:34:16,791 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:16,791 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:16,791 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:16,791 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:16,791 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:16,792 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:16,792 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:16,792 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 00:34:16,797 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 00:34:16,798 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 00:34:16,799 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 00:34:16,800 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 10.4ms
2025-11-29 00:34:16,808 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:16,809 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:16,810 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:16,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:16,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:16,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:16,810 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:16,811 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:16,811 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:16,811 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:16,817 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:16,817 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:16,819 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:16,819 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:16,819 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:16,820 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:16,820 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:16,820 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:16,820 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:16,820 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:16,820 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:16,825 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:16,825 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:16,827 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:16,828 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.3ms
2025-11-29 00:34:16,828 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 17.2ms
2025-11-29 00:34:16,830 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 00:34:16,831 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:16,831 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:16,832 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:16,832 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:16,832 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:16,832 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:16,832 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:16,832 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 00:34:16,833 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 00:34:16,837 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 00:34:16,837 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 00:34:16,838 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 00:34:16,839 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 00:34:16,839 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 00:34:16,839 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 00:34:16,839 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 00:34:16,840 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 00:34:16,840 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 00:34:16,840 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 00:34:16,840 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 00:34:16,844 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 00:34:16,844 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 00:34:16,846 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 00:34:16,846 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 16.3ms
2025-11-29 00:34:16,847 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.4ms
2025-11-29 00:49:38,253 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'static', 'cdn', 'api', 'backend', 'admin', 'assets'}
2025-11-29 08:50:06,530 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'www', 'backend', 'api', 'static', 'assets', 'admin'}
2025-11-29 08:52:02,345 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 08:52:02,346 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 08:52:02,346 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 08:52:02,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 08:52:02,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 08:52:02,346 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 08:52:02,347 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 08:52:02,347 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 08:52:02,347 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 08:52:02,353 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 7.4ms
2025-11-29 08:52:02,521 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 08:52:02,522 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 08:52:02,522 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 08:52:02,522 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 08:52:02,523 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 08:52:02,523 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 08:52:02,523 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 08:52:02,523 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 08:52:02,523 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 08:52:02,752 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 230.8ms
2025-11-29 08:52:44,861 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 08:52:44,861 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 08:52:44,861 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 08:52:44,862 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 08:52:44,862 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 08:52:44,862 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 08:52:44,862 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 08:52:44,862 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 08:52:44,862 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 08:52:44,863 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.2ms
2025-11-29 08:52:44,931 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 08:52:44,932 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 08:52:44,932 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 08:52:44,932 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 08:52:44,932 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 08:52:44,933 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 08:52:44,933 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 08:52:44,933 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 08:52:44,933 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 08:52:44,937 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 5.5ms
2025-11-29 08:55:20,673 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 08:55:20,674 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 08:55:20,674 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 08:55:20,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 08:55:20,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 08:55:20,674 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 08:55:20,674 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 08:55:20,675 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 08:55:20,675 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 08:55:20,675 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.3ms
2025-11-29 08:55:20,761 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 08:55:20,761 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 08:55:20,762 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 08:55:20,762 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 08:55:20,762 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 08:55:20,762 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 08:55:20,763 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 08:55:20,763 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 08:55:20,763 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 08:55:20,767 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 6.6ms
2025-11-29 09:08:05,877 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 09:08:05,877 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:08:05,878 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:08:05,878 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:08:05,878 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:08:05,878 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:08:05,878 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:08:05,878 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:08:05,879 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 09:08:05,879 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.6ms
2025-11-29 09:08:05,974 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 09:08:05,975 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:08:05,975 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:08:05,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:08:05,975 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:08:05,975 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:08:05,975 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:08:05,976 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:08:05,976 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 09:08:05,980 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 5.9ms
2025-11-29 09:10:47,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 09:10:47,888 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:10:47,889 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:10:47,889 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:10:47,889 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:10:47,889 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:10:47,889 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:10:47,890 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:10:47,890 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 09:10:47,890 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.3ms
2025-11-29 09:10:47,971 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 09:10:47,971 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:10:47,971 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:10:47,972 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:10:47,972 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:10:47,972 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:10:47,972 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:10:47,972 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:10:47,972 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 09:10:47,977 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 6.2ms
2025-11-29 09:20:48,584 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 09:20:48,584 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:20:48,584 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:20:48,585 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:20:48,585 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:20:48,585 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:20:48,585 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:20:48,585 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:20:48,586 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 09:20:48,586 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.4ms
2025-11-29 09:20:48,675 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 09:20:48,675 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:20:48,675 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:20:48,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:20:48,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:20:48,676 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:20:48,676 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:20:48,676 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:20:48,676 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 09:20:48,681 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 6.2ms
2025-11-29 09:21:57,787 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 09:21:57,788 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:21:57,788 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:21:57,788 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:21:57,788 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:21:57,788 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:21:57,788 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:21:57,788 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:21:57,788 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 09:21:57,789 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.9ms
2025-11-29 09:21:57,882 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 09:21:57,882 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:21:57,882 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:21:57,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:21:57,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:21:57,883 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:21:57,883 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:21:57,883 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:21:57,884 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 09:21:57,889 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 7.3ms
2025-11-29 09:22:23,116 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 09:22:23,117 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:22:23,118 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:22:23,121 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:22:23,125 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:22:23,126 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:22:23,126 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:22:23,127 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:22:23,127 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 09:22:23,128 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 12.1ms
2025-11-29 09:22:23,225 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 09:22:23,226 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:22:23,226 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:22:23,226 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:22:23,226 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:22:23,227 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:22:23,227 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:22:23,227 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:22:23,227 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 09:22:23,232 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 6.7ms
2025-11-29 09:22:55,888 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 09:22:55,889 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:22:55,889 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:22:55,889 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:22:55,889 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:22:55,889 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:22:55,890 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:22:55,890 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:22:55,890 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 09:22:55,891 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.9ms
2025-11-29 09:22:55,980 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 09:22:55,981 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:22:55,981 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:22:55,981 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:22:55,981 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:22:55,981 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:22:55,982 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:22:55,982 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:22:55,982 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 09:22:55,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 7.5ms
2025-11-29 09:38:14,817 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'www', 'api', 'assets', 'static', 'cdn', 'admin'}
2025-11-29 09:38:51,446 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'cdn', 'www', 'assets', 'static', 'api', 'admin'}
2025-11-29 09:39:17,588 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 09:39:17,589 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:17,589 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:39:17,590 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:39:17,590 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:17,590 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:39:17,590 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:39:17,590 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:17,590 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 09:39:17,591 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.8ms
2025-11-29 09:39:17,686 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 09:39:17,686 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:17,686 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 09:39:17,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 09:39:17,687 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:17,687 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 09:39:17,687 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 09:39:17,687 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:17,687 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 09:39:17,919 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 233.2ms
2025-11-29 09:39:26,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 09:39:26,805 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.9ms
2025-11-29 09:39:26,808 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 09:39:26,809 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:26,809 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:26,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:26,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:26,810 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:26,810 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:26,811 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:26,811 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 09:39:26,993 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 09:39:26,998 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 09:39:27,008 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 09:39:27,015 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 09:39:27,016 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14401, Rotación: True
2025-11-29 09:39:27,023 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 09:39:27,024 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 09:39:27,024 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 09:39:27,024 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14401
2025-11-29 09:39:27,024 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 09:39:27,038 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 09:39:27,039 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 09:39:27,040 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 231.6ms
2025-11-29 09:39:27,045 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-29 09:39:27,045 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-11-29 09:39:27,046 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 09:39:27,047 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:27,047 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:27,047 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:27,047 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:27,047 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:27,048 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:27,048 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:27,048 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 09:39:27,050 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 09:39:27,050 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 09:39:27,051 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 09:39:27,064 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 09:39:27,064 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 09:39:27,065 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 18.8ms
2025-11-29 09:39:27,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-29 09:39:27,071 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-29 09:39:27,072 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 09:39:27,073 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:27,073 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:27,073 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:27,073 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:27,074 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:27,074 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:27,074 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:27,074 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 09:39:27,090 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 09:39:27,090 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 09:39:27,092 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 09:39:27,092 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 19.8ms
2025-11-29 09:39:35,401 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-29 09:39:35,401 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.6ms
2025-11-29 09:39:35,404 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 09:39:35,404 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:35,404 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:35,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:35,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:35,405 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:35,405 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:35,405 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:35,405 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 09:39:35,411 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 09:39:35,412 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 09:39:35,412 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 09:39:35,648 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 09:39:35,648 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 09:39:35,648 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 09:39:35,649 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 09:39:35,650 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 09:39:35,650 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14402, Rotación: False
2025-11-29 09:39:35,651 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14402
2025-11-29 09:39:35,651 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 09:39:35,654 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 09:39:35,654 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 09:39:35,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 251.5ms
2025-11-29 09:39:35,666 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 09:39:35,667 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:35,667 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:35,667 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:35,667 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:35,667 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:35,668 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:35,668 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:35,668 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 09:39:35,672 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 09:39:35,672 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 09:39:35,673 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 09:39:35,674 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 7.7ms
2025-11-29 09:39:35,700 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 09:39:35,700 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 09:39:35,701 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-29 09:39:35,701 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.6ms
2025-11-29 09:39:35,703 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 09:39:35,704 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:35,704 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:35,704 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:35,704 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:35,705 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:35,705 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:35,705 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:35,705 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 09:39:35,710 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 09:39:35,710 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 09:39:35,752 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 09:39:35,753 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 49.2ms
2025-11-29 09:39:35,754 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 09:39:35,755 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:35,755 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:35,755 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:35,755 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:35,756 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:35,756 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:35,756 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:35,756 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 09:39:35,759 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 09:39:35,760 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 09:39:35,761 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 09:39:35,761 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.6ms
2025-11-29 09:39:37,079 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 09:39:37,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 09:39:37,081 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.4ms
2025-11-29 09:39:37,081 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-29 09:39:37,084 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 09:39:37,084 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:37,085 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:37,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:37,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:37,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:37,085 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:37,086 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:37,086 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 09:39:37,090 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 09:39:37,090 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 09:39:37,095 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 09:39:37,097 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 12.7ms
2025-11-29 09:39:37,099 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 09:39:37,100 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:37,100 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:37,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:37,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:37,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:37,100 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:37,101 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:37,101 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 09:39:37,105 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 09:39:37,105 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 09:39:37,107 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 09:39:37,107 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.3ms
2025-11-29 09:39:38,497 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 09:39:38,498 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.8ms
2025-11-29 09:39:38,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 09:39:38,501 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:38,502 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:38,502 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:38,502 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:38,502 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:38,502 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:38,502 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:38,503 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 09:39:38,507 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 09:39:38,508 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 09:39:38,514 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 09:39:38,516 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 09:39:38,517 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 15.9ms
2025-11-29 09:39:38,519 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 09:39:38,519 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:38,519 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:38,520 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:38,520 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:38,520 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:38,520 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:38,520 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:38,520 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 09:39:38,524 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 09:39:38,524 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 09:39:38,525 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 09:39:38,526 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 09:39:38,526 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.5ms
2025-11-29 09:39:40,277 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 09:39:40,277 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:40,278 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:40,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:40,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:40,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:40,278 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:40,278 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:40,279 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 09:39:40,283 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 09:39:40,284 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 09:39:40,286 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 09:39:40,288 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.9ms
2025-11-29 09:39:40,290 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 09:39:40,290 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:40,290 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:40,291 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:40,291 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:40,291 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:40,291 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:40,291 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:40,292 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 09:39:40,296 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 09:39:40,296 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 09:39:40,298 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 09:39:40,299 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.4ms
2025-11-29 09:39:46,276 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-29 09:39:46,277 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 1.3ms
2025-11-29 09:39:46,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-29 09:39:46,278 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-29 09:39:46,280 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-29 09:39:46,280 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 2.2ms
2025-11-29 09:39:46,280 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 2.1ms
2025-11-29 09:39:46,281 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 1.6ms
2025-11-29 09:39:46,284 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-29 09:39:46,284 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:46,285 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:46,285 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:46,285 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:46,285 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:46,286 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:46,286 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:46,286 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-29 09:39:46,291 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-29 09:39:46,292 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-29 09:39:46,293 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:46,293 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:46,293 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:46,293 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:46,293 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:46,293 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:46,294 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:46,294 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-29 09:39:46,297 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-29 09:39:46,297 - app.modules.tenant.application.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-29 09:39:46,309 - app.modules.tenant.application.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-29 09:39:46,309 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 25.6ms
2025-11-29 09:39:46,310 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 17.7ms
2025-11-29 09:39:46,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-29 09:39:46,312 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:46,312 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:46,313 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:46,313 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:46,313 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:46,313 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:46,313 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:46,313 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-29 09:39:46,316 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-29 09:39:46,317 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-29 09:39:46,318 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:46,318 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:46,318 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:46,318 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:46,318 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:46,319 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:46,319 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:46,319 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-29 09:39:46,322 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-29 09:39:46,322 - app.modules.tenant.application.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-29 09:39:46,325 - app.modules.tenant.application.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-29 09:39:46,325 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 13.6ms
2025-11-29 09:39:46,326 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 8.8ms
2025-11-29 09:39:47,521 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/clientes/2/modulos/
2025-11-29 09:39:47,522 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/clientes/2/modulos/
2025-11-29 09:39:47,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/clientes/2/modulos/ 200 0.9ms
2025-11-29 09:39:47,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/clientes/2/modulos/ 200 0.6ms
2025-11-29 09:39:47,524 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/clientes/2/modulos/
2025-11-29 09:39:47,524 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:47,525 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:47,525 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:47,525 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:47,525 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:47,525 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:47,525 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:47,526 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/clientes/2/modulos/
2025-11-29 09:39:47,529 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /clientes/2/modulos/ recibida
2025-11-29 09:39:47,530 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo módulos para cliente ID: 2
2025-11-29 09:39:47,534 - app.modules.tenant.presentation.endpoints_modulos - INFO - Módulos para cliente 2 recuperados: 5 módulos
2025-11-29 09:39:47,535 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/clientes/2/modulos/ 200 10.7ms
2025-11-29 09:39:47,537 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/clientes/2/modulos/
2025-11-29 09:39:47,537 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:47,537 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:47,537 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:47,537 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:47,538 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:47,538 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:47,538 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:47,538 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/clientes/2/modulos/
2025-11-29 09:39:47,542 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /clientes/2/modulos/ recibida
2025-11-29 09:39:47,542 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo módulos para cliente ID: 2
2025-11-29 09:39:47,544 - app.modules.tenant.presentation.endpoints_modulos - INFO - Módulos para cliente 2 recuperados: 5 módulos
2025-11-29 09:39:47,544 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/clientes/2/modulos/ 200 7.9ms
2025-11-29 09:39:48,087 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2/
2025-11-29 09:39:48,088 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2/ 200 1.0ms
2025-11-29 09:39:48,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 09:39:48,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/conexiones/clientes/2/
2025-11-29 09:39:48,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 09:39:48,091 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 2.0ms
2025-11-29 09:39:48,091 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/conexiones/clientes/2/ 200 1.8ms
2025-11-29 09:39:48,091 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.8ms
2025-11-29 09:39:48,093 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2/
2025-11-29 09:39:48,093 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:48,094 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:48,094 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:48,094 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:48,094 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:48,094 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:48,095 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:48,095 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2/
2025-11-29 09:39:48,098 - app.modules.tenant.presentation.endpoints_conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-29 09:39:48,098 - app.modules.tenant.application.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-29 09:39:48,101 - app.modules.tenant.presentation.endpoints_conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-29 09:39:48,102 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 09:39:48,102 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:48,102 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:48,102 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:48,103 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:48,103 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:48,103 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:48,103 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:48,103 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 09:39:48,106 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-29 09:39:48,106 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-29 09:39:48,107 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 09:39:48,108 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 09:39:48,109 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2/ 200 15.9ms
2025-11-29 09:39:48,110 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.9ms
2025-11-29 09:39:48,111 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/conexiones/clientes/2/
2025-11-29 09:39:48,112 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:48,112 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:48,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:48,112 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:48,113 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:48,113 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:48,113 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:48,113 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/conexiones/clientes/2/
2025-11-29 09:39:48,113 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 09:39:48,117 - app.modules.tenant.presentation.endpoints_conexiones - INFO - Solicitud GET /conexiones/clientes/2 recibida
2025-11-29 09:39:48,117 - app.modules.tenant.application.services.conexion_service - INFO - Obteniendo conexiones para cliente ID: 2
2025-11-29 09:39:48,118 - app.modules.tenant.presentation.endpoints_conexiones - INFO - Conexiones recuperadas para cliente 2: 2 conexiones
2025-11-29 09:39:48,119 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:48,119 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:48,119 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:48,119 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:48,119 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:48,119 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:48,119 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:48,120 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 09:39:48,122 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 100, solo_activos: True
2025-11-29 09:39:48,123 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 100
2025-11-29 09:39:48,123 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 09:39:48,124 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 09:39:48,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/conexiones/clientes/2/ 200 13.8ms
2025-11-29 09:39:48,126 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 12.6ms
2025-11-29 09:39:48,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-29 09:39:48,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-29 09:39:48,988 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 0.8ms
2025-11-29 09:39:48,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 0.6ms
2025-11-29 09:39:48,990 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-29 09:39:48,991 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:48,991 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:48,991 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:48,991 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:48,991 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:48,991 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:48,991 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:48,992 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-29 09:39:48,996 - app.modules.superadmin.presentation.endpoints_usuarios - INFO - Superadmin 1 solicitando usuarios del cliente 2 - page: 1, limit: 10
2025-11-29 09:39:48,996 - app.modules.superadmin.application.services.superadmin_usuario_service - INFO - Obteniendo usuarios globales - cliente_id: 2, page: 1, limit: 10
2025-11-29 09:39:49,001 - app.core.tenant.routing - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-29 09:39:49,001 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,040 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,045 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,056 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,059 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,062 - app.modules.superadmin.presentation.endpoints_usuarios - INFO - Usuarios del cliente 2 recuperados - Total: 3, Página: 1
2025-11-29 09:39:49,063 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 72.4ms
2025-11-29 09:39:49,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-29 09:39:49,065 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:49,065 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:49,065 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:49,065 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:49,065 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:49,066 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:49,066 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:49,066 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/usuarios/clientes/2/usuarios/
2025-11-29 09:39:49,069 - app.modules.superadmin.presentation.endpoints_usuarios - INFO - Superadmin 1 solicitando usuarios del cliente 2 - page: 1, limit: 10
2025-11-29 09:39:49,070 - app.modules.superadmin.application.services.superadmin_usuario_service - INFO - Obteniendo usuarios globales - cliente_id: 2, page: 1, limit: 10
2025-11-29 09:39:49,071 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,072 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,072 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,074 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,077 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:49,080 - app.modules.superadmin.presentation.endpoints_usuarios - INFO - Usuarios del cliente 2 recuperados - Total: 3, Página: 1
2025-11-29 09:39:49,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/usuarios/clientes/2/usuarios/ 200 16.0ms
2025-11-29 09:39:50,365 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/auditoria/autenticacion/
2025-11-29 09:39:50,365 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/superadmin/auditoria/autenticacion/
2025-11-29 09:39:50,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/auditoria/autenticacion/ 200 1.0ms
2025-11-29 09:39:50,366 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/superadmin/auditoria/autenticacion/ 200 0.8ms
2025-11-29 09:39:50,368 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/
2025-11-29 09:39:50,368 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:50,368 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:50,369 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:50,369 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:50,369 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:50,369 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:50,369 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:50,369 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/
2025-11-29 09:39:50,374 - app.modules.superadmin.presentation.endpoints_auditoria - INFO - Superadmin 1 solicitando logs de autenticación - cliente_id: 2, page: 1
2025-11-29 09:39:50,374 - app.modules.superadmin.application.services.superadmin_auditoria_service - INFO - Obteniendo logs de autenticación - cliente_id: 2, page: 1
2025-11-29 09:39:50,375 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:50,377 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:50,382 - app.modules.superadmin.presentation.endpoints_auditoria - INFO - Logs de autenticación recuperados - Total: 11, Página: 1
2025-11-29 09:39:50,383 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/ 200 14.7ms
2025-11-29 09:39:50,384 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/superadmin/auditoria/autenticacion/
2025-11-29 09:39:50,385 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 09:39:50,385 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 09:39:50,385 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 09:39:50,385 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 09:39:50,385 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 09:39:50,386 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 09:39:50,386 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 09:39:50,386 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/superadmin/auditoria/autenticacion/
2025-11-29 09:39:50,389 - app.modules.superadmin.presentation.endpoints_auditoria - INFO - Superadmin 1 solicitando logs de autenticación - cliente_id: 2, page: 1
2025-11-29 09:39:50,390 - app.modules.superadmin.application.services.superadmin_auditoria_service - INFO - Obteniendo logs de autenticación - cliente_id: 2, page: 1
2025-11-29 09:39:50,391 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:50,392 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 09:39:50,393 - app.modules.superadmin.presentation.endpoints_auditoria - INFO - Logs de autenticación recuperados - Total: 11, Página: 1
2025-11-29 09:39:50,394 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/superadmin/auditoria/autenticacion/ 200 9.4ms
2025-11-29 09:42:30,190 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'api', 'backend', 'assets', 'static', 'admin', 'www'}
2025-11-29 21:29:48,906 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'www', 'api', 'static', 'cdn', 'assets', 'backend'}
2025-11-29 21:30:10,644 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 21:30:10,645 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.1ms
2025-11-29 21:30:10,648 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 21:30:10,648 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,649 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,649 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,649 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,649 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 21:30:10,819 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 21:30:10,822 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 21:30:10,830 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 21:30:10,836 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 21:30:10,836 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14403, Rotación: True
2025-11-29 21:30:10,839 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 21:30:10,840 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 21:30:10,840 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 21:30:10,840 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14403
2025-11-29 21:30:10,840 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 21:30:10,847 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 21:30:10,848 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 21:30:10,848 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 200.4ms
2025-11-29 21:30:10,852 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-29 21:30:10,853 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.4ms
2025-11-29 21:30:10,854 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 21:30:10,855 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,855 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,855 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,855 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,855 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,855 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,856 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,856 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 21:30:10,858 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 21:30:10,858 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 21:30:10,859 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 21:30:10,870 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 21:30:10,870 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 21:30:10,871 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 17.1ms
2025-11-29 21:30:10,875 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-29 21:30:10,875 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-29 21:30:10,877 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 21:30:10,878 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,878 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,878 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,878 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,878 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,878 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,878 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,879 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 21:30:10,893 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 21:30:10,894 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 21:30:10,895 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 21:30:10,896 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 18.7ms
2025-11-29 21:30:10,903 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 21:30:10,904 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-29 21:30:10,905 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-29 21:30:10,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-29 21:30:10,906 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 21:30:10,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 1.8ms
2025-11-29 21:30:10,907 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 1.7ms
2025-11-29 21:30:10,907 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 21:30:10,908 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/
2025-11-29 21:30:10,908 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/2/estadisticas/
2025-11-29 21:30:10,912 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 5.0ms
2025-11-29 21:30:10,912 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,912 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,912 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,913 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,913 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,913 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 21:30:10,916 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 21:30:10,916 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 21:30:10,953 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 21:30:10,955 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/ 200 46.5ms
2025-11-29 21:30:10,955 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/2/estadisticas/ 200 46.3ms
2025-11-29 21:30:10,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-29 21:30:10,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-29 21:30:10,957 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 49.5ms
2025-11-29 21:30:10,957 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,958 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,958 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,958 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,958 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,958 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,958 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,958 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-29 21:30:10,959 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,959 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,959 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,959 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,959 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,959 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,960 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,960 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-29 21:30:10,963 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-29 21:30:10,967 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-29 21:30:10,967 - app.modules.tenant.application.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-29 21:30:10,973 - app.modules.tenant.application.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-29 21:30:10,975 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 18.7ms
2025-11-29 21:30:10,976 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 18.8ms
2025-11-29 21:30:10,976 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 21:30:10,977 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,977 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,977 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,978 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,978 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,978 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,978 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,978 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 21:30:10,981 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 21:30:10,981 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menú filtrado para usuario_id: 1
2025-11-29 21:30:10,982 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menús permitidos para el usuario ID: 1.
2025-11-29 21:30:10,983 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/
2025-11-29 21:30:10,984 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,984 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,984 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,984 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,984 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,985 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,985 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,985 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/
2025-11-29 21:30:10,988 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2 recibida por usuario: superadmin
2025-11-29 21:30:10,988 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/2/estadisticas/
2025-11-29 21:30:10,989 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 13.1ms
2025-11-29 21:30:10,989 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:10,989 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:10,990 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:10,990 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:10,990 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:10,990 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:10,990 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:10,990 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/2/estadisticas/
2025-11-29 21:30:10,994 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/2/estadisticas recibida por usuario: superadmin
2025-11-29 21:30:10,994 - app.modules.tenant.application.services.cliente_service - INFO - Obteniendo estadísticas para cliente ID: 2
2025-11-29 21:30:10,996 - app.modules.tenant.application.services.cliente_service - INFO - Estadísticas obtenidas para cliente 2
2025-11-29 21:30:10,997 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/ 200 14.1ms
2025-11-29 21:30:10,998 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/2/estadisticas/ 200 9.8ms
2025-11-29 21:30:12,869 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 21:30:12,870 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 21:30:12,870 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.2ms
2025-11-29 21:30:12,871 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.2ms
2025-11-29 21:30:12,872 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:30:12,873 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:12,873 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:12,873 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:12,873 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:12,874 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:12,874 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:12,874 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:12,874 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:30:12,878 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:30:12,879 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:30:12,886 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:30:12,887 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.5ms
2025-11-29 21:30:12,889 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:30:12,889 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:12,889 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:12,889 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:12,890 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:12,890 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:12,890 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:12,890 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:12,890 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:30:12,894 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:30:12,894 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:30:12,896 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:30:12,897 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.9ms
2025-11-29 21:30:15,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 21:30:15,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 21:30:15,262 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.5ms
2025-11-29 21:30:15,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.5ms
2025-11-29 21:30:15,265 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 21:30:15,266 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:15,266 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:15,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:15,267 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:15,267 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:15,267 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:15,267 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:15,267 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 21:30:15,270 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 21:30:15,271 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 21:30:15,274 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 21:30:15,275 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 21:30:15,276 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.2ms
2025-11-29 21:30:15,277 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 21:30:15,278 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:15,278 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:15,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:15,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:15,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:15,279 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:15,279 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:15,279 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 21:30:15,283 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 21:30:15,283 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 21:30:15,284 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 21:30:15,285 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 21:30:15,285 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.1ms
2025-11-29 21:30:15,946 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:30:15,947 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:15,947 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:15,947 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:15,947 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:15,947 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:15,948 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:15,948 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:15,948 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:30:15,951 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:30:15,951 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:30:15,954 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:30:15,955 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.6ms
2025-11-29 21:30:15,957 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:30:15,957 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:30:15,957 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:30:15,957 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:30:15,957 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:30:15,958 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:30:15,958 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:30:15,958 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:30:15,958 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:30:15,961 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:30:15,962 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:30:15,963 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:30:15,964 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.4ms
2025-11-29 21:49:07,644 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 21:49:07,645 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 21:49:07,645 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-29 21:49:07,645 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.5ms
2025-11-29 21:49:07,647 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 21:49:07,648 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:07,648 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:07,648 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:07,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:07,649 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:07,649 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:07,649 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:07,649 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 21:49:07,650 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-29 21:49:07,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 401 3.0ms
2025-11-29 21:49:07,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 21:49:07,652 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:07,653 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:07,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:07,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:07,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:07,653 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:07,653 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:07,654 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 21:49:07,654 - app.api.deps - WARNING - Error de validación JWT: Signature has expired.
2025-11-29 21:49:07,655 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 21:49:07,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-29 21:49:07,655 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 401 3.5ms
2025-11-29 21:49:07,658 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 21:49:07,659 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:07,659 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:07,659 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:07,659 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:07,659 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:07,659 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:07,660 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:07,660 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 21:49:07,670 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 21:49:07,671 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 21:49:07,672 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 21:49:07,674 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 21:49:07,674 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14404, Rotación: True
2025-11-29 21:49:07,675 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 21:49:07,675 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 21:49:07,675 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 21:49:07,675 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14404
2025-11-29 21:49:07,676 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 21:49:07,677 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 21:49:07,677 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 21:49:07,678 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 19.9ms
2025-11-29 21:49:07,682 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 21:49:07,683 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:07,683 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:07,683 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:07,683 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:07,683 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:07,684 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:07,684 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:07,684 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 21:49:07,687 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 21:49:07,687 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 21:49:07,688 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 21:49:07,688 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 21:49:07,689 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 6.7ms
2025-11-29 21:49:07,691 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 21:49:07,691 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:07,691 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:07,692 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:07,692 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:07,692 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:07,692 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:07,692 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:07,692 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 21:49:07,695 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 21:49:07,695 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catálogo de módulos - skip: 0, limit: 20
2025-11-29 21:49:07,696 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de módulos en el sistema
2025-11-29 21:49:07,697 - app.modules.tenant.presentation.endpoints_modulos - INFO - Catálogo de módulos recuperado: 5 módulos de 5 totales
2025-11-29 21:49:07,697 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 6.6ms
2025-11-29 21:49:08,165 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 21:49:08,166 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-29 21:49:08,166 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 21:49:08,167 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-29 21:49:08,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:49:08,169 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:08,169 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:08,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:08,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:08,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:08,169 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:08,169 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:08,170 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:49:08,173 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:49:08,174 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:49:08,176 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:49:08,176 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.3ms
2025-11-29 21:49:08,178 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:49:08,178 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:08,179 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:08,179 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:08,179 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:08,179 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:08,179 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:08,179 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:08,179 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:49:08,183 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:49:08,183 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:49:08,185 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:49:08,185 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.4ms
2025-11-29 21:49:09,351 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:49:09,351 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:09,352 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:09,352 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:09,352 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:09,352 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:09,352 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:09,352 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:09,352 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:49:09,356 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:49:09,356 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:49:09,358 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:49:09,359 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.5ms
2025-11-29 21:49:09,361 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 21:49:09,362 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 21:49:09,362 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 21:49:09,362 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 21:49:09,362 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 21:49:09,363 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 21:49:09,363 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 21:49:09,363 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 21:49:09,363 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 21:49:09,367 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 21:49:09,367 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 21:49:09,369 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 21:49:09,370 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.4ms
2025-11-29 22:54:02,694 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'cdn', 'backend', 'www', 'admin', 'api', 'assets'}
2025-11-29 22:56:30,265 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'assets', 'backend', 'static', 'admin', 'www', 'api'}
2025-11-29 22:56:40,091 - app.infrastructure.database.connection_pool - WARNING - [CONNECTION_POOL] SQLAlchemy no instalado. Instalar con: pip install sqlalchemy. Connection pooling desactivado automáticamente.
2025-11-29 22:57:11,801 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'static', 'backend', 'api', 'assets', 'admin', 'www'}
2025-11-29 22:57:18,425 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 22:57:18,426 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 22:57:18,426 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 22:57:18,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 22:57:18,427 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 22:57:18,427 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 22:57:18,427 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 22:57:18,427 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 22:57:18,427 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 22:57:18,428 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.9ms
2025-11-29 22:57:18,499 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 22:57:18,499 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 22:57:18,499 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 22:57:18,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 22:57:18,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 22:57:18,500 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 22:57:18,500 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 22:57:18,500 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 22:57:18,500 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 22:57:18,715 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 216.0ms
2025-11-29 22:58:32,420 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-29 22:58:32,421 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-29 22:58:32,423 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-29 22:58:32,423 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 22:58:32,423 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 22:58:32,423 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 22:58:32,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 22:58:32,424 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 22:58:32,424 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 22:58:32,424 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 22:58:32,424 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-29 22:58:32,449 - app.core.auth - ERROR - Error decodificando token: Signature has expired.
2025-11-29 22:58:32,450 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 401 27.1ms
2025-11-29 22:58:32,453 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 22:58:32,454 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-29 22:58:32,455 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 22:58:32,455 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 22:58:32,455 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 22:58:32,456 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 22:58:32,456 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 22:58:32,456 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 22:58:32,456 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 22:58:32,456 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 22:58:32,456 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 22:58:32,520 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token válido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 22:58:32,524 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 22:58:32,531 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 22:58:32,537 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 22:58:32,538 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14405, Rotación: True
2025-11-29 22:58:32,542 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 22:58:32,543 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 22:58:32,543 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crítico)
2025-11-29 22:58:32,543 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14405
2025-11-29 22:58:32,543 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 22:58:32,550 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 22:58:32,550 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 22:58:32,551 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 96.2ms
2025-11-29 22:58:32,554 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-29 22:58:32,555 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 22:58:32,555 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 22:58:32,555 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 22:58:32,555 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 22:58:32,555 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 22:58:32,556 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 22:58:32,556 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 22:58:32,556 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-29 22:58:32,560 - app.infrastructure.database.queries - INFO - Actualización exitosa, filas afectadas: -1
2025-11-29 22:58:32,560 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 22:58:32,561 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 1, Usuario: 1 (superadmin)
2025-11-29 22:58:32,565 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 22:58:32,565 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=1, usuario_id=1, exito=True
2025-11-29 22:58:32,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 11.1ms
2025-11-29 22:58:33,732 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 22:58:33,733 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 22:58:33,733 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraído de 'origin': platform.app.local:5173
2025-11-29 22:58:33,733 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 22:58:33,733 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 22:58:33,733 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 22:58:33,733 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 22:58:33,733 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 22:58:33,734 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 22:58:33,735 - app.core.auth - WARNING - [REFRESH] No se proporcionó refresh token. Cliente: web
2025-11-29 22:58:33,735 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.4ms
2025-11-29 22:59:40,452 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 22:59:40,452 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 22:59:40,453 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 22:59:40,453 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 22:59:40,453 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 22:59:40,453 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 22:59:40,453 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 22:59:40,453 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 22:59:40,453 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 22:59:40,461 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 22:59:40,461 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 22:59:40,461 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 22:59:40,686 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 22:59:40,686 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 22:59:40,687 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 22:59:40,687 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 22:59:40,690 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 22:59:40,690 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14406, Rotación: False
2025-11-29 22:59:40,690 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14406
2025-11-29 22:59:40,691 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 22:59:40,694 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 22:59:40,694 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 22:59:40,695 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 243.2ms
2025-11-29 23:03:07,932 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:03:11,058 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'admin', 'backend', 'www', 'cdn', 'api', 'assets'}
2025-11-29 23:03:21,564 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 23:03:21,564 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:03:21,564 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:03:21,565 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:03:21,565 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:03:21,565 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:03:21,565 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:03:21,565 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:03:21,565 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 23:03:21,566 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 1.9ms
2025-11-29 23:03:21,650 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 23:03:21,651 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:03:21,651 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:03:21,651 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:03:21,651 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:03:21,651 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:03:21,651 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:03:21,651 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:03:21,652 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 23:03:21,886 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 236.2ms
2025-11-29 23:04:01,221 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 23:04:01,222 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:04:01,222 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:04:01,222 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:04:01,222 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:04:01,222 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectó subdominio válido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:04:01,222 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:04:01,223 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:04:01,223 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 23:04:01,265 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 23:04:01,265 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 23:04:01,265 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 23:04:01,496 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:04:01,496 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 23:04:01,496 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 23:04:01,497 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:04:01,503 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 23:04:01,503 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14407, Rotación: False
2025-11-29 23:04:01,503 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14407
2025-11-29 23:04:01,504 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 23:04:01,507 - app.infrastructure.database.queries - INFO - Inserción exitosa, filas afectadas: -1
2025-11-29 23:04:01,507 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:04:01,508 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 287.1ms
2025-11-29 23:14:25,115 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:14:32,238 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'cdn', 'assets', 'api', 'static', 'backend', 'www'}
2025-11-29 23:15:29,296 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.
2025-11-29 23:17:11,262 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'backend', 'admin', 'cdn', 'static', 'assets', 'api'}
2025-11-29 23:17:17,604 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.
2025-11-29 23:17:56,256 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'static', 'backend', 'assets', 'admin', 'www', 'cdn'}
2025-11-29 23:19:01,928 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:19:02,767 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:19:02,769 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:19:02,769 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:19:02,770 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:19:02,770 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:19:02,770 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:19:03,036 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:19:03,036 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:19:03,131 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:19:03,131 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:19:03,132 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:19:03,292 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:19:03,293 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:19:03,398 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'static', 'cdn', 'api', 'assets', 'www', 'admin'}
2025-11-29 23:20:01,973 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 23:20:01,973 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:20:01,973 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:20:01,973 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:20:01,974 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:20:01,974 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:20:01,974 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:20:01,974 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:20:01,974 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 23:20:01,975 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.5ms
2025-11-29 23:20:02,058 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 23:20:02,058 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:20:02,058 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:20:02,059 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:20:02,059 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:20:02,059 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:20:02,059 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:20:02,059 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:20:02,060 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 23:20:02,238 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 180.5ms
2025-11-29 23:20:19,070 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 23:20:19,070 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:20:19,071 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:20:19,071 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:20:19,071 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:20:19,071 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:20:19,071 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:20:19,071 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:20:19,071 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 23:20:19,119 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 23:20:19,119 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 23:20:19,120 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 23:20:19,352 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:20:19,352 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 23:20:19,352 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 23:20:19,353 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:20:19,358 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:20:19,358 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14408, RotaciÃ³n: False
2025-11-29 23:20:19,358 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14408
2025-11-29 23:20:19,358 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 23:20:19,362 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:20:19,363 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:20:19,364 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 293.6ms
2025-11-29 23:22:12,802 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-29 23:22:12,802 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-29 23:22:12,804 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 23:22:12,804 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:12,804 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:12,804 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:12,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:12,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:12,805 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:12,805 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:12,805 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 23:22:12,817 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 23:22:12,818 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 23:22:12,818 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 23:22:13,034 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:22:13,035 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 23:22:13,035 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 23:22:13,035 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:22:13,038 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:22:13,038 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14409, RotaciÃ³n: False
2025-11-29 23:22:13,039 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14409
2025-11-29 23:22:13,039 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 23:22:13,042 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:22:13,043 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:22:13,043 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 239.4ms
2025-11-29 23:22:13,052 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-29 23:22:13,053 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-29 23:22:13,055 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:22:13,055 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:13,055 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:13,055 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:13,055 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:13,056 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:13,056 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:13,056 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:13,056 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 23:22:13,075 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 23:22:13,075 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 23:22:13,077 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 23:22:13,077 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 22.6ms
2025-11-29 23:22:13,080 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 23:22:13,080 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-29 23:22:13,082 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 23:22:13,083 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-29 23:22:13,084 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:22:13,085 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:13,085 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:13,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:13,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:13,085 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:13,086 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:13,086 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:13,086 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 23:22:13,090 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 23:22:13,090 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:22:13,135 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-29 23:22:13,136 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 51.8ms
2025-11-29 23:22:13,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:22:13,138 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:13,138 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:13,138 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:13,138 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:13,138 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:13,138 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:13,139 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:13,139 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 23:22:13,142 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 23:22:13,142 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:22:13,143 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-29 23:22:13,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-29 23:22:20,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 23:22:20,072 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-29 23:22:20,073 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 23:22:20,074 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.7ms
2025-11-29 23:22:20,076 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:22:20,076 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:20,076 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:20,076 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:20,076 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:20,076 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:20,077 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:20,077 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:20,077 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:22:20,095 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:22:20,096 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:22:20,101 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:22:20,101 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 25.8ms
2025-11-29 23:22:20,103 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:22:20,104 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:20,104 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:20,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:20,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:20,104 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:20,105 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:20,105 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:20,105 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:22:20,108 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:22:20,109 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:22:20,110 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:22:20,111 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.5ms
2025-11-29 23:22:24,183 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 23:22:24,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-29 23:22:24,184 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 23:22:24,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-29 23:22:24,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:22:24,186 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:24,186 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:24,186 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:24,186 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:24,186 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:24,186 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:24,187 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:24,187 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:22:24,190 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:22:24,191 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:22:24,194 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:22:24,196 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:22:24,196 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.0ms
2025-11-29 23:22:24,198 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:22:24,198 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:24,199 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:24,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:24,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:24,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:24,199 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:24,199 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:24,199 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:22:24,202 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:22:24,203 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:22:24,204 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:22:24,204 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:22:24,205 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 6.8ms
2025-11-29 23:22:27,373 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:22:27,373 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:27,374 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:27,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:27,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:27,374 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:27,374 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:27,374 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:27,375 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:22:27,378 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:22:27,378 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:22:27,380 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:22:27,381 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.8ms
2025-11-29 23:22:27,382 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:27,383 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:22:27,387 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:22:27,387 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:22:27,389 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:22:27,389 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.2ms
2025-11-29 23:22:29,425 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:22:29,425 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:29,426 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:29,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:29,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:29,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:29,426 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:29,426 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:29,426 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:22:29,430 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:22:29,430 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:22:29,432 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:22:29,433 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.2ms
2025-11-29 23:22:29,435 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:22:29,435 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:29,435 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:29,435 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:29,436 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:29,436 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:29,436 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:29,436 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:29,436 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:22:29,439 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:22:29,439 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:22:29,441 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:22:29,442 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 6.8ms
2025-11-29 23:22:30,189 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:22:30,189 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:30,190 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:30,190 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:30,190 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:30,190 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:30,190 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:30,190 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:30,190 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:22:30,194 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:22:30,194 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:22:30,196 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:22:30,197 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:22:30,198 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.9ms
2025-11-29 23:22:30,200 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:22:30,200 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:22:30,200 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:22:30,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:22:30,201 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:22:30,201 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:22:30,201 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:22:30,201 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:22:30,201 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:22:30,205 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:22:30,205 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:22:30,206 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:22:30,207 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:22:30,208 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.3ms
2025-11-29 23:29:02,458 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:29:02,469 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:29:02,469 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-29 23:29:03,434 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:29:03,436 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:29:03,436 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:29:03,436 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:29:03,437 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:29:03,437 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:29:03,790 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:29:03,790 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:29:03,895 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:29:03,895 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:29:03,895 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:29:04,109 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:29:04,109 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:29:04,214 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'admin', 'cdn', 'static', 'assets', 'api', 'www'}
2025-11-29 23:32:27,179 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:32:27,190 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:32:27,190 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-29 23:32:27,950 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:32:27,952 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:32:27,952 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:32:27,953 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:32:27,953 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:32:27,953 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:32:28,227 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:32:28,227 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:32:28,302 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:32:28,302 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:32:28,302 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:32:28,462 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:32:28,463 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:32:28,566 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'static', 'assets', 'backend', 'admin', 'www', 'api'}
2025-11-29 23:32:42,672 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:32:42,684 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:32:42,684 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-29 23:32:43,517 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:32:43,520 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:32:43,520 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:32:43,520 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:32:43,520 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:32:43,521 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:32:43,799 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:32:43,799 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:32:43,870 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:32:43,871 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:32:43,871 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:32:44,024 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:32:44,025 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:32:44,124 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'backend', 'api', 'cdn', 'www', 'admin', 'static'}
2025-11-29 23:32:49,482 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-29 23:32:49,482 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:32:49,483 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:32:49,483 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:32:49,483 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:32:49,483 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:32:49,483 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:32:49,483 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:32:49,484 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-29 23:32:49,484 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.4ms
2025-11-29 23:32:49,549 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-29 23:32:49,550 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:32:49,550 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-29 23:32:49,550 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-29 23:32:49,550 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:32:49,550 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-29 23:32:49,550 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-29 23:32:49,551 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:32:49,551 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-29 23:32:49,759 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 209.9ms
2025-11-29 23:32:53,138 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-29 23:32:53,138 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-29 23:32:53,140 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-29 23:32:53,140 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:32:53,140 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:32:53,140 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:32:53,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:32:53,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:32:53,141 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:32:53,141 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:32:53,141 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-29 23:32:53,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ N/A 4.3ms
2025-11-29 23:32:53,145 - app.core.exceptions - ERROR - Error no manejado: No module named 'app.db'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 355, in get_current_user
    |     from app.db.connection import DatabaseConnection
    | ModuleNotFoundError: No module named 'app.db'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 355, in get_current_user
    from app.db.connection import DatabaseConnection
ModuleNotFoundError: No module named 'app.db'
2025-11-29 23:33:01,954 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:33:01,964 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:33:01,964 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-29 23:33:05,799 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:33:05,801 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:33:05,801 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:33:05,801 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:33:05,801 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:33:05,802 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:33:06,067 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:33:06,067 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:33:06,138 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:33:06,138 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:33:06,138 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:33:06,296 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:33:06,297 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:33:06,399 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'static', 'backend', 'api', 'admin', 'cdn', 'assets'}
2025-11-29 23:33:17,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 23:33:17,149 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-29 23:33:17,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 23:33:17,152 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:17,152 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:17,152 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:17,152 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:17,152 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:17,153 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:17,153 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:17,153 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 23:33:17,196 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 23:33:17,198 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 23:33:17,202 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:33:17,209 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:17,210 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14410, RotaciÃ³n: True
2025-11-29 23:33:17,215 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:17,215 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 23:33:17,215 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-29 23:33:17,215 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14410
2025-11-29 23:33:17,216 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 23:33:17,220 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:17,221 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:33:17,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 70.1ms
2025-11-29 23:33:17,227 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-29 23:33:17,228 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 1.4ms
2025-11-29 23:33:17,230 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 23:33:17,230 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:17,231 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:17,231 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:17,231 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:17,231 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:17,231 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:17,231 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:17,231 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 23:33:17,234 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 23:33:17,234 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 23:33:17,235 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 23:33:17,249 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 23:33:17,249 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 23:33:17,250 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 20.0ms
2025-11-29 23:33:17,257 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-29 23:33:17,258 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.4ms
2025-11-29 23:33:17,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:33:17,260 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:17,261 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:17,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:17,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:17,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:17,261 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:17,262 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:17,262 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 23:33:17,280 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 23:33:17,280 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 23:33:17,282 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 23:33:17,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 23.0ms
2025-11-29 23:33:23,893 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 23:33:23,893 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:23,893 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:23,893 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:23,893 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:23,893 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:23,894 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:23,894 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:23,894 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 23:33:23,899 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 23:33:23,903 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 23:33:23,908 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:33:23,916 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:23,917 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14411, RotaciÃ³n: True
2025-11-29 23:33:23,921 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:23,921 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 23:33:23,922 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-29 23:33:23,922 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14411
2025-11-29 23:33:23,922 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 23:33:23,926 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:23,926 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:33:23,926 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 34.0ms
2025-11-29 23:33:23,930 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 23:33:23,930 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:23,930 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:23,930 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:23,931 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:23,931 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:23,931 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:23,931 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:23,931 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 23:33:23,934 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 23:33:23,934 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 23:33:23,935 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 23:33:23,946 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 23:33:23,946 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 23:33:23,946 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 16.7ms
2025-11-29 23:33:23,951 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:33:23,952 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:23,952 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:23,952 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:23,952 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:23,952 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:23,953 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:23,953 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:23,953 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 23:33:23,965 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 23:33:23,966 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 23:33:23,968 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 23:33:23,968 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 17.3ms
2025-11-29 23:33:26,980 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 23:33:26,980 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:26,980 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:26,980 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:26,981 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:26,981 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:26,981 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:26,981 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:26,981 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 23:33:26,988 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 23:33:26,989 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 23:33:26,990 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:33:26,996 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:26,996 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14412, RotaciÃ³n: True
2025-11-29 23:33:27,000 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:27,001 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 23:33:27,001 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-29 23:33:27,001 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14412
2025-11-29 23:33:27,001 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 23:33:27,004 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:27,004 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:33:27,005 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 25.2ms
2025-11-29 23:33:27,009 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 23:33:27,010 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:27,010 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:27,010 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:27,010 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:27,010 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:27,011 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:27,011 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:27,011 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 23:33:27,012 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 23:33:27,012 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 23:33:27,012 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 23:33:27,014 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 23:33:27,014 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 23:33:27,015 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 5.6ms
2025-11-29 23:33:27,019 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:33:27,020 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:27,020 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:27,020 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:27,020 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:27,020 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:27,021 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:27,021 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:27,021 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 23:33:27,024 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 23:33:27,024 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 23:33:27,025 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 23:33:27,025 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 6.3ms
2025-11-29 23:33:34,795 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-29 23:33:34,796 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-29 23:33:34,797 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:34,798 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 23:33:34,804 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 23:33:34,804 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 23:33:34,804 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 23:33:35,032 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:33:35,032 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 23:33:35,032 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 23:33:35,033 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:33:35,034 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:35,034 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14413, RotaciÃ³n: False
2025-11-29 23:33:35,034 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14413
2025-11-29 23:33:35,035 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 23:33:35,038 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:33:35,038 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:33:35,039 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 241.4ms
2025-11-29 23:33:35,049 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:33:35,049 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:35,049 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:35,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:35,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:35,050 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:35,050 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:35,050 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:35,050 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 23:33:35,053 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 23:33:35,054 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 23:33:35,054 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 23:33:35,055 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 6.3ms
2025-11-29 23:33:35,071 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 23:33:35,072 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-29 23:33:35,073 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 23:33:35,074 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.7ms
2025-11-29 23:33:35,075 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:33:35,076 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:35,076 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:35,076 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:35,076 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:35,077 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:35,077 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:35,077 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:35,077 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 23:33:35,082 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 23:33:35,082 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:33:35,126 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-29 23:33:35,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 52.7ms
2025-11-29 23:33:35,130 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:33:35,131 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:35,131 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:35,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:35,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:35,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:35,131 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:35,131 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:35,132 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 23:33:35,135 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 23:33:35,135 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:33:35,136 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-29 23:33:35,136 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.3ms
2025-11-29 23:33:37,195 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 23:33:37,196 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-29 23:33:37,196 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.1ms
2025-11-29 23:33:37,197 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.8ms
2025-11-29 23:33:37,199 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:33:37,199 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:37,199 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:37,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:37,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:37,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:37,201 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:37,201 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:37,201 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:33:37,205 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:33:37,205 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:33:37,210 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:33:37,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.7ms
2025-11-29 23:33:37,212 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:33:37,213 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:37,213 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:37,213 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:37,213 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:37,213 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:37,213 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:37,213 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:37,214 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:33:37,217 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:33:37,218 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:33:37,220 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:33:37,221 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.5ms
2025-11-29 23:33:38,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 23:33:38,146 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-29 23:33:38,146 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-29 23:33:38,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-29 23:33:38,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:33:38,148 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:38,149 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:38,149 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:38,149 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:38,149 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:38,149 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:38,149 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:38,149 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:33:38,153 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:33:38,153 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:33:38,156 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:33:38,157 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:33:38,158 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.6ms
2025-11-29 23:33:38,160 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:33:38,160 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:38,161 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:38,161 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:38,161 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:38,161 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:38,161 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:38,161 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:38,161 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:33:38,165 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:33:38,165 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:33:38,166 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:33:38,168 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:33:38,168 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.6ms
2025-11-29 23:33:40,448 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:33:40,448 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:40,448 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:40,449 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:40,449 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:40,449 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:40,449 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:40,449 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:40,449 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:33:40,453 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:33:40,453 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:33:40,455 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:33:40,456 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.3ms
2025-11-29 23:33:40,458 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:33:40,458 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:40,459 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:40,459 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:40,459 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:40,459 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:40,459 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:40,459 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:40,460 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:33:40,463 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:33:40,464 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:33:40,465 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:33:40,466 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.4ms
2025-11-29 23:33:43,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-29 23:33:43,188 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:33:43,188 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:33:43,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:33:43,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:33:43,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:33:43,189 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:33:43,189 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:33:43,189 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-29 23:33:43,190 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ N/A 2.2ms
2025-11-29 23:33:43,190 - app.core.exceptions - ERROR - Error no manejado: No module named 'app.db'
  + Exception Group Traceback (most recent call last):
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 186, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 815, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     )
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    |     with collapse_excgroups():
    |          ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 293, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    |     raise app_exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 355, in get_current_user
    |     from app.db.connection import DatabaseConnection
    | ModuleNotFoundError: No module named 'app.db'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 223, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 214, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\main.py", line 191, in cors_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\tenant\middleware.py", line 293, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 163, in call_next
    raise app_exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\core\auth.py", line 355, in get_current_user
    from app.db.connection import DatabaseConnection
ModuleNotFoundError: No module named 'app.db'
2025-11-29 23:35:11,654 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:35:11,666 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:35:11,667 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-29 23:35:12,415 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:35:12,416 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:35:12,416 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:35:12,417 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:35:12,417 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:35:12,417 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:35:12,695 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:35:12,695 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:35:12,763 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:35:12,764 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:35:12,764 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:35:12,918 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:35:12,919 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:35:13,019 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'api', 'www', 'admin', 'assets', 'cdn', 'backend'}
2025-11-29 23:35:15,361 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:35:15,372 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:35:15,372 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-29 23:35:17,081 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:35:17,083 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:35:17,083 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:35:17,083 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:35:17,084 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:35:17,084 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:35:17,353 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:35:17,353 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:35:17,426 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:35:17,426 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:35:17,426 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:35:17,585 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:35:17,586 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:35:17,689 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'admin', 'cdn', 'www', 'api', 'assets', 'static'}
2025-11-29 23:35:22,568 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 23:35:22,569 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:22,569 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:22,569 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:22,569 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:22,569 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:22,569 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:22,570 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:22,570 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-29 23:35:22,613 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-29 23:35:22,615 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-29 23:35:22,619 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:35:22,627 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:22,628 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14414, RotaciÃ³n: True
2025-11-29 23:35:22,631 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:22,631 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 23:35:22,632 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-29 23:35:22,632 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14414
2025-11-29 23:35:22,632 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-29 23:35:22,636 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:22,636 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:35:22,637 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 68.8ms
2025-11-29 23:35:22,642 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-29 23:35:22,642 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:22,642 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:22,642 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:22,643 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:22,643 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:22,643 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:22,643 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:22,643 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-29 23:35:22,645 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-29 23:35:22,646 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-29 23:35:22,646 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-29 23:35:22,659 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-29 23:35:22,659 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-29 23:35:22,660 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 18.2ms
2025-11-29 23:35:22,665 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:35:22,666 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:22,666 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:22,666 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:22,666 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:22,666 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:22,666 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:22,666 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:22,667 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 23:35:22,682 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 23:35:22,682 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 23:35:22,684 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 23:35:22,684 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 19.2ms
2025-11-29 23:35:31,089 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 23:35:31,089 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:31,089 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:31,090 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:31,090 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:31,090 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:31,090 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:31,090 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:31,090 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-29 23:35:31,098 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-29 23:35:31,098 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-29 23:35:31,098 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-29 23:35:31,328 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:35:31,328 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-29 23:35:31,328 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-29 23:35:31,329 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-29 23:35:31,332 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:31,333 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14415, RotaciÃ³n: False
2025-11-29 23:35:31,333 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14415
2025-11-29 23:35:31,333 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-29 23:35:31,336 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:31,337 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:35:31,337 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 248.7ms
2025-11-29 23:35:31,345 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:35:31,346 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:31,346 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:31,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:31,346 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:31,347 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:31,347 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:31,347 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:31,347 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-29 23:35:31,366 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-29 23:35:31,367 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-29 23:35:31,368 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-29 23:35:31,369 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 23.8ms
2025-11-29 23:35:31,369 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:35:31,370 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:31,370 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:31,370 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:31,370 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:31,370 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:31,370 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:31,371 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:31,371 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 23:35:31,374 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 23:35:31,374 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:35:31,411 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-29 23:35:31,412 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 43.0ms
2025-11-29 23:35:31,414 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:35:31,415 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:31,415 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:31,415 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:31,416 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:31,416 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:31,416 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:31,416 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:31,416 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-29 23:35:31,419 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-29 23:35:31,419 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:35:31,420 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-29 23:35:31,420 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.4ms
2025-11-29 23:35:32,785 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:35:32,785 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:32,786 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:32,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:32,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:32,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:32,786 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:32,786 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:32,786 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:35:32,804 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:35:32,805 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:35:32,809 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:35:32,810 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 25.1ms
2025-11-29 23:35:32,812 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:35:32,812 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:32,812 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:32,812 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:32,812 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:32,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:32,813 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:32,813 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:32,813 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:35:32,817 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:35:32,818 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:35:32,819 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:35:32,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.5ms
2025-11-29 23:35:33,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:35:33,727 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:33,727 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:33,727 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:33,727 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:33,727 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:33,727 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:33,727 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:33,728 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:35:33,745 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:35:33,746 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:35:33,748 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:35:33,750 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:35:33,751 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 25.1ms
2025-11-29 23:35:33,753 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-29 23:35:33,753 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:33,754 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:33,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:33,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:33,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:33,754 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:33,754 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:33,754 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-29 23:35:33,757 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-29 23:35:33,758 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-29 23:35:33,759 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-29 23:35:33,759 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-29 23:35:33,760 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 6.6ms
2025-11-29 23:35:35,243 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:35:35,244 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:35,244 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:35,244 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:35,244 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:35,245 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:35,245 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:35,245 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:35,245 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:35:35,249 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:35:35,249 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:35:35,256 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:35:35,256 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.1ms
2025-11-29 23:35:35,258 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-29 23:35:35,259 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:35,259 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:35,259 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:35,259 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:35,259 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:35,259 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:35,259 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:35,260 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-29 23:35:35,263 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-29 23:35:35,263 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-29 23:35:35,265 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-29 23:35:35,265 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.3ms
2025-11-29 23:35:38,205 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-29 23:35:38,205 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:38,206 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-29 23:35:38,206 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-29 23:35:38,206 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:38,206 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-29 23:35:38,206 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-29 23:35:38,206 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-29 23:35:38,206 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-29 23:35:38,212 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:38,212 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-29 23:35:38,212 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 1, Usuario: 1 (superadmin)
2025-11-29 23:35:38,216 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:38,216 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=1, usuario_id=1, exito=True
2025-11-29 23:35:38,217 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 11.8ms
2025-11-29 23:35:48,444 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-29 23:35:48,445 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-29 23:35:48,447 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-29 23:35:48,447 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:48,448 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:48,448 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:48,448 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:48,448 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:48,454 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:52,548 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexiÃ³n ya que el equipo de destino denegÃ³ expresamente dicha conexiÃ³n.. Cache desactivado automÃ¡ticamente (usando fallback en memoria).
2025-11-29 23:35:52,548 - app.infrastructure.cache.redis_cache - INFO - â¹ï¸ MÃ³dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-11-29 23:35:52,561 - app.core.tenant.routing - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-29 23:35:52,561 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:52,561 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-29 23:35:52,562 - app.core.auth - WARNING - [REFRESH] No se proporcionÃ³ refresh token. Cliente: web
2025-11-29 23:35:52,563 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 4116.2ms
2025-11-29 23:35:59,186 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-29 23:35:59,187 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-29 23:35:59,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-29 23:35:59,188 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,188 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,190 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,190 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,190 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-29 23:35:59,196 - app.modules.auth.presentation.endpoints - INFO - Cliente 2 resuelto y validado para login.
2025-11-29 23:35:59,196 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-29 23:35:59,196 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-29 23:35:59,196 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,432 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,436 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,442 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-29 23:35:59,442 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-29 23:35:59,442 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,445 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,446 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-29 23:35:59,446 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,450 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:59,450 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 2040, RotaciÃ³n: False
2025-11-29 23:35:59,450 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 2040
2025-11-29 23:35:59,450 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-29 23:35:59,450 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,454 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:35:59,454 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=2, usuario_id=1, exito=True
2025-11-29 23:35:59,455 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 267.1ms
2025-11-29 23:35:59,464 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-29 23:35:59,464 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-29 23:35:59,466 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-29 23:35:59,467 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,467 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,467 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,467 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,467 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,468 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,468 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,469 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-29 23:35:59,470 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,473 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,478 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,482 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,485 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-29 23:35:59,486 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-29 23:35:59,487 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=2
2025-11-29 23:35:59,488 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 21.9ms
2025-11-29 23:35:59,495 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 23:35:59,496 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.0ms
2025-11-29 23:35:59,498 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-29 23:35:59,498 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-29 23:35:59,499 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 1.7ms
2025-11-29 23:35:59,499 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/usuarios/
2025-11-29 23:35:59,500 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 1.8ms
2025-11-29 23:35:59,500 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/all-active/
2025-11-29 23:35:59,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:35:59,501 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-29 23:35:59,502 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/usuarios/ 200 2.9ms
2025-11-29 23:35:59,503 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,503 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,504 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,505 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,505 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-29 23:35:59,505 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/all-active/ 200 5.2ms
2025-11-29 23:35:59,506 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,507 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,509 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,510 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,511 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-29 23:35:59,511 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:35:59,512 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,586 - app.modules.menus.application.services.menu_helper - INFO - Ãrbol de menÃº construido con 5 items raÃ­z.
2025-11-29 23:35:59,586 - app.modules.menus.application.services.menu_service - INFO - Ãrbol de menÃº construido para usuario 1 con 5 items raÃ­z.
2025-11-29 23:35:59,587 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 86.0ms
2025-11-29 23:35:59,589 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-29 23:35:59,590 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-29 23:35:59,590 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 89.3ms
2025-11-29 23:35:59,590 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,590 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,591 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,591 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,591 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,592 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,592 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,592 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-29 23:35:59,593 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,593 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,593 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,593 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,593 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,594 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,594 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,594 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-29 23:35:59,595 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,596 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,597 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,598 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,598 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,600 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,601 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: page=1, limit=10, BÃºsqueda: 'None'
2025-11-29 23:35:59,601 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 23:35:59,602 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,605 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,611 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:35:59,611 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:35:59,611 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:35:59,612 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios Ãºnicos de 3 filas crudas
2025-11-29 23:35:59,612 - app.modules.users.application.services.user_service - INFO - ObtenciÃ³n paginada de usuarios completada exitosamente
2025-11-29 23:35:59,612 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, PÃ¡gina: 1
2025-11-29 23:35:59,613 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,613 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,614 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,615 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,615 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,616 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,617 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-29 23:35:59,617 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,619 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-29 23:35:59,619 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-29 23:35:59,620 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 31.0ms
2025-11-29 23:35:59,621 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 31.0ms
2025-11-29 23:35:59,621 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-29 23:35:59,622 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,622 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,622 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,622 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,622 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,623 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,624 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,624 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-29 23:35:59,625 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,625 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,626 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,627 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,628 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-29 23:35:59,628 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-29 23:35:59,628 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,630 - app.modules.menus.application.services.menu_helper - INFO - Ãrbol de menÃº construido con 5 items raÃ­z.
2025-11-29 23:35:59,630 - app.modules.menus.application.services.menu_service - INFO - Ãrbol de menÃº construido para usuario 1 con 5 items raÃ­z.
2025-11-29 23:35:59,631 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/usuarios/
2025-11-29 23:35:59,632 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,632 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,632 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,632 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,633 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,633 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,634 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,634 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/usuarios/
2025-11-29 23:35:59,635 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,636 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,637 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,638 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,638 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,639 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,640 - app.modules.users.presentation.endpoints - INFO - Solicitud GET /usuarios/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: page=1, limit=10, BÃºsqueda: 'None'
2025-11-29 23:35:59,640 - app.modules.users.application.services.user_service - INFO - Obteniendo usuarios paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 23:35:59,640 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,642 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,645 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:35:59,645 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:35:59,645 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:35:59,645 - app.modules.users.application.services.user_service - INFO - [USUARIOS-PAGINADOS] Procesados 3 usuarios Ãºnicos de 3 filas crudas
2025-11-29 23:35:59,646 - app.modules.users.application.services.user_service - INFO - ObtenciÃ³n paginada de usuarios completada exitosamente
2025-11-29 23:35:59,646 - app.modules.users.presentation.endpoints - INFO - Lista paginada de usuarios recuperada para cliente 2 - Total: 3, PÃ¡gina: 1
2025-11-29 23:35:59,646 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/all-active/
2025-11-29 23:35:59,647 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 25.7ms
2025-11-29 23:35:59,647 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:35:59,647 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:35:59,647 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:35:59,647 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:35:59,647 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:35:59,648 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:35:59,648 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:35:59,649 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/all-active/
2025-11-29 23:35:59,650 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,650 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,651 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,652 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,653 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,653 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,654 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/all-active/ recibida por usuario 1 del cliente 2 para lista simple
2025-11-29 23:35:59,654 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:35:59,655 - app.modules.rbac.application.services.rol_service - INFO - Se encontraron 3 roles activos para cliente 2
2025-11-29 23:35:59,655 - app.modules.rbac.presentation.endpoints - INFO - Lista simple de roles activos recuperada para cliente 2 - Total: 3
2025-11-29 23:35:59,656 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/usuarios/ 200 24.5ms
2025-11-29 23:35:59,657 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/all-active/ 200 10.3ms
2025-11-29 23:36:01,535 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-29 23:36:01,535 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/roles/
2025-11-29 23:36:01,536 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 1.1ms
2025-11-29 23:36:01,536 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/roles/ 200 0.7ms
2025-11-29 23:36:01,538 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-29 23:36:01,539 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:36:01,539 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:36:01,539 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:36:01,539 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:36:01,539 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:36:01,540 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:36:01,540 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:36:01,540 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-29 23:36:01,541 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,542 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,543 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,544 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,546 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,547 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,548 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: page=1, limit=10, BÃºsqueda: 'None'
2025-11-29 23:36:01,548 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 23:36:01,548 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-29 23:36:01,548 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,551 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-29 23:36:01,551 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,554 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la pÃ¡gina 1 de 3 totales
2025-11-29 23:36:01,554 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:36:01,555 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:36:01,555 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:36:01,555 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, PÃ¡gina: 1/1, Resultados: 3
2025-11-29 23:36:01,555 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-29 23:36:01,556 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 17.5ms
2025-11-29 23:36:01,557 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/roles/
2025-11-29 23:36:01,558 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:36:01,558 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:36:01,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:36:01,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:36:01,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:36:01,559 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:36:01,559 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:36:01,559 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/roles/
2025-11-29 23:36:01,560 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,561 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,562 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,562 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,563 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,564 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,565 - app.modules.rbac.presentation.endpoints - INFO - Solicitud GET /roles/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: page=1, limit=10, BÃºsqueda: 'None'
2025-11-29 23:36:01,565 - app.modules.rbac.application.services.rol_service - INFO - Obteniendo roles paginados para cliente 2: page=1, limit=10, search='None'
2025-11-29 23:36:01,565 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Iniciando consulta para cliente_id=2, page=1, limit=10, search='None'
2025-11-29 23:36:01,565 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,566 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Total de roles encontrados para cliente 2: 3
2025-11-29 23:36:01,566 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:01,567 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Obtenidos 3 roles para la pÃ¡gina 1 de 3 totales
2025-11-29 23:36:01,567 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 1 tiene codigo_rol='ADMIN' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:36:01,568 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 2 tiene codigo_rol='SUPERVISOR' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:36:01,568 - app.modules.rbac.application.services.rol_service - WARNING - [NORMALIZAR-ROL] Rol 3 tiene codigo_rol='USER' pero cliente_id=2. Normalizando codigo_rol a None.
2025-11-29 23:36:01,568 - app.modules.rbac.application.services.rol_service - INFO - [ROLES-PAGINADOS] Consulta completada exitosamente - Cliente: 2, Total: 3, PÃ¡gina: 1/1, Resultados: 3
2025-11-29 23:36:01,568 - app.modules.rbac.presentation.endpoints - INFO - Respuesta exitosa para GET /roles/ - Cliente: 2, Total roles: 3
2025-11-29 23:36:01,569 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/roles/ 200 11.6ms
2025-11-29 23:36:02,480 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-29 23:36:02,481 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.0ms
2025-11-29 23:36:02,481 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-29 23:36:02,482 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 0.9ms
2025-11-29 23:36:02,483 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-29 23:36:02,484 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:36:02,484 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:36:02,484 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:36:02,484 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:36:02,484 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:36:02,485 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:36:02,486 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:36:02,486 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-29 23:36:02,487 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,488 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,490 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,491 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,492 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,493 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,494 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: skip=0, limit=10, BÃºsqueda: 'None'
2025-11-29 23:36:02,494 - app.modules.menus.application.services.area_service - INFO - Obteniendo Ã¡reas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-29 23:36:02,494 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,498 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,501 - app.modules.menus.application.services.area_service - INFO - PaginaciÃ³n completada para cliente 2: 2 Ã¡reas de 2 totales
2025-11-29 23:36:02,501 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de Ã¡reas recuperada para cliente 2 - Total: 2, PÃ¡gina: 1
2025-11-29 23:36:02,502 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 18.9ms
2025-11-29 23:36:02,504 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-29 23:36:02,504 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:36:02,504 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:36:02,505 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:36:02,505 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:36:02,505 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:36:02,506 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:36:02,506 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:36:02,506 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-29 23:36:02,506 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,507 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,508 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,508 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,509 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,509 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,510 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: skip=0, limit=10, BÃºsqueda: 'None'
2025-11-29 23:36:02,510 - app.modules.menus.application.services.area_service - INFO - Obteniendo Ã¡reas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-29 23:36:02,510 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,512 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:02,514 - app.modules.menus.application.services.area_service - INFO - PaginaciÃ³n completada para cliente 2: 2 Ã¡reas de 2 totales
2025-11-29 23:36:02,515 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de Ã¡reas recuperada para cliente 2 - Total: 2, PÃ¡gina: 1
2025-11-29 23:36:02,515 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 11.5ms
2025-11-29 23:36:04,730 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-29 23:36:04,731 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-29 23:36:04,732 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-29 23:36:04,732 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-29 23:36:04,732 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-29 23:36:04,733 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-29 23:36:04,733 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-29 23:36:04,733 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-29 23:36:04,734 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-29 23:36:04,734 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-29 23:36:04,734 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-29 23:36:04,734 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:04,736 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:04,743 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:36:04,743 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-29 23:36:04,743 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-29 23:36:04,744 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-29 23:36:04,746 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-29 23:36:04,747 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=2, usuario_id=1, exito=True
2025-11-29 23:36:04,747 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 15.2ms
2025-11-29 23:39:11,854 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.
2025-11-29 23:39:11,907 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:39:11,908 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-29 23:39:12,766 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-29 23:39:12,768 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-29 23:39:12,768 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-29 23:39:12,769 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-29 23:39:12,769 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-29 23:39:12,769 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-29 23:39:13,082 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-29 23:39:13,082 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-29 23:39:13,178 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-29 23:39:13,178 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-29 23:39:13,178 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-29 23:39:13,389 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-29 23:39:13,389 - app.main - INFO - â Rate limiting configurado y activo
2025-11-29 23:39:13,498 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'assets', 'cdn', 'backend', 'static', 'api', 'admin'}
2025-11-29 23:54:52,701 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 46, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-29 23:54:52,711 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-29 23:54:52,712 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:04:24,552 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:04:24,560 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:04:24,560 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:04:24,562 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:04:24,562 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:04:24,562 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:04:25,021 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:04:25,021 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:04:25,118 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:04:25,118 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:04:25,118 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:04:25,287 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:04:25,287 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:04:25,390 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'api', 'cdn', 'static', 'www', 'assets', 'backend'}
2025-11-30 00:04:31,937 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 00:04:31,937 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-30 00:04:31,939 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 00:04:31,940 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:31,940 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:31,940 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:31,940 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:31,940 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:31,940 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:31,941 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:31,941 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 00:04:31,943 - app.core.auth - WARNING - [REFRESH] No se proporcionÃ³ refresh token. Cliente: web
2025-11-30 00:04:31,943 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.8ms
2025-11-30 00:04:41,401 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-30 00:04:41,402 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-30 00:04:41,403 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-30 00:04:41,404 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:41,404 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:41,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:41,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:41,404 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:41,405 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:41,405 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:41,405 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-30 00:04:41,470 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-30 00:04:41,471 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-30 00:04:41,471 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-30 00:04:41,712 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 00:04:41,712 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-30 00:04:41,713 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-30 00:04:41,713 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 00:04:41,729 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:04:41,730 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14416, RotaciÃ³n: False
2025-11-30 00:04:41,730 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14416
2025-11-30 00:04:41,730 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-30 00:04:41,739 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:04:41,739 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-30 00:04:41,740 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 336.7ms
2025-11-30 00:04:41,748 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-30 00:04:41,749 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-30 00:04:41,751 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 00:04:41,751 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:41,752 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:41,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:41,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:41,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:41,752 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:41,752 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:41,752 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 00:04:41,770 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 00:04:41,771 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 00:04:41,773 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 00:04:41,774 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 00:04:41,775 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 24.3ms
2025-11-30 00:04:41,776 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-30 00:04:41,776 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 00:04:41,777 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-30 00:04:41,779 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:04:41,779 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:41,780 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:41,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:41,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:41,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:41,780 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:41,780 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:41,780 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:04:41,784 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:04:41,784 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:04:41,825 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:04:41,826 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 47.0ms
2025-11-30 00:04:41,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:04:41,828 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:41,828 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:41,828 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:41,828 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:41,828 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:41,828 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:41,828 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:41,829 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:04:41,831 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:04:41,832 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:04:41,832 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:04:41,833 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 5.5ms
2025-11-30 00:04:43,997 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 00:04:43,998 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-30 00:04:43,998 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 00:04:43,999 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-30 00:04:44,001 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:04:44,001 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:44,001 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:44,002 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:44,002 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:44,002 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:44,002 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:44,002 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:44,002 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:04:44,007 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:04:44,007 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:04:44,013 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:04:44,014 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 13.7ms
2025-11-30 00:04:44,016 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:04:44,017 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:44,017 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:44,017 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:44,017 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:44,017 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:44,017 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:44,018 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:44,018 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:04:44,022 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:04:44,022 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:04:44,024 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:04:44,025 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.9ms
2025-11-30 00:04:44,649 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 00:04:44,650 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.8ms
2025-11-30 00:04:44,650 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 00:04:44,651 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-30 00:04:44,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:04:44,652 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:44,652 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:44,652 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:44,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:44,653 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:44,653 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:44,653 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:44,653 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:04:44,657 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:04:44,657 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:04:44,661 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:04:44,663 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:04:44,664 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.7ms
2025-11-30 00:04:44,665 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:04:44,665 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:04:44,666 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:04:44,666 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:04:44,666 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:04:44,666 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:04:44,666 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:04:44,666 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:04:44,667 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:04:44,669 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:04:44,670 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:04:44,671 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:04:44,671 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:04:44,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.2ms
2025-11-30 00:13:43,657 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-30 00:13:43,658 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:13:43,658 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 00:13:43,658 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-30 00:13:43,658 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:13:43,659 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-30 00:13:43,659 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 00:13:43,659 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:13:43,659 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-30 00:13:43,660 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.5ms
2025-11-30 00:13:44,083 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 62, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.
2025-11-30 00:13:44,092 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-30 00:13:44,093 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:13:44,945 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:13:44,948 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:13:44,948 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:13:44,949 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:13:44,949 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:13:44,949 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:13:45,231 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:13:45,231 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:13:45,330 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:13:45,331 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:13:45,331 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:13:45,547 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:13:45,547 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:13:45,648 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'api', 'static', 'cdn', 'assets', 'admin', 'backend'}
2025-11-30 00:13:45,686 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-30 00:13:45,686 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:13:45,686 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 00:13:45,686 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-30 00:13:45,687 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:13:45,687 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-30 00:13:45,687 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 00:13:45,687 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:13:45,687 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-30 00:13:45,885 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 199.4ms
2025-11-30 00:13:50,480 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 62, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__static_attributes__', '__firstlineno__'}.
2025-11-30 00:13:50,490 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-30 00:13:50,490 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:13:52,343 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:13:52,344 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:13:52,345 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:13:52,345 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:13:52,345 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:13:52,345 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:13:52,609 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:13:52,610 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:13:52,686 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:13:52,686 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:13:52,686 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:13:52,846 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:13:52,847 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:13:52,946 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'backend', 'static', 'www', 'api', 'admin', 'cdn', 'assets'}
2025-11-30 00:13:55,991 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-30 00:13:55,992 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:13:55,992 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 00:13:55,992 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-30 00:13:55,992 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:13:55,992 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-30 00:13:55,992 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 00:13:55,993 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:13:55,993 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-30 00:13:55,993 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.3ms
2025-11-30 00:13:56,034 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-30 00:13:56,034 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:13:56,034 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 00:13:56,034 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-30 00:13:56,035 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:13:56,035 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-30 00:13:56,035 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 00:13:56,035 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:13:56,035 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-30 00:13:56,243 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 209.1ms
2025-11-30 00:13:59,671 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-30 00:13:59,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.6ms
2025-11-30 00:13:59,674 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-30 00:13:59,674 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:13:59,674 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:13:59,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:13:59,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:13:59,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:13:59,675 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:13:59,675 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:13:59,675 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-30 00:13:59,917 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:13:59,917 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 00:13:59,917 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 1, Usuario: 1 (superadmin)
2025-11-30 00:13:59,922 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:13:59,922 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=1, usuario_id=1, exito=True
2025-11-30 00:13:59,923 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 249.3ms
2025-11-30 00:14:01,067 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 00:14:01,068 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:01,068 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:01,068 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:01,068 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:01,068 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:01,068 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:01,069 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:01,069 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 00:14:01,070 - app.core.auth - WARNING - [REFRESH] No se proporcionÃ³ refresh token. Cliente: web
2025-11-30 00:14:01,071 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 3.6ms
2025-11-30 00:14:08,920 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-30 00:14:08,921 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:08,921 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:08,921 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:08,921 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:08,921 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:08,921 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:08,922 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:08,922 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-30 00:14:08,929 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-30 00:14:08,929 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-30 00:14:08,929 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-30 00:14:09,170 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 00:14:09,170 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-30 00:14:09,170 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-30 00:14:09,171 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 00:14:09,175 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:14:09,175 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14417, RotaciÃ³n: False
2025-11-30 00:14:09,175 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14417
2025-11-30 00:14:09,176 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-30 00:14:09,179 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:14:09,179 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-30 00:14:09,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 259.7ms
2025-11-30 00:14:09,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 00:14:09,189 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:09,189 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:09,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:09,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:09,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:09,190 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:09,190 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:09,190 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 00:14:09,206 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 00:14:09,207 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 00:14:09,209 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 00:14:09,210 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 21.6ms
2025-11-30 00:14:09,210 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:14:09,211 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:09,211 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:09,211 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:09,212 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:09,212 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:09,212 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:09,212 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:09,212 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:14:09,216 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:14:09,216 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:14:09,258 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:14:09,259 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 48.3ms
2025-11-30 00:14:09,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:14:09,261 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:09,261 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:09,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:09,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:09,261 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:09,261 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:09,262 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:09,262 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:14:09,265 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:14:09,265 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:14:09,266 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:14:09,267 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.6ms
2025-11-30 00:14:11,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:14:11,800 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:11,800 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:11,800 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:11,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:11,801 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:11,801 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:11,801 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:11,801 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:14:11,805 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:14:11,805 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:14:11,810 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:14:11,811 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.4ms
2025-11-30 00:14:11,812 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:14:11,813 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:11,813 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:11,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:11,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:11,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:11,814 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:11,814 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:11,814 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:14:11,817 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:14:11,818 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:14:11,819 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:14:11,820 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.4ms
2025-11-30 00:14:12,433 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:14:12,434 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:12,434 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:12,434 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:12,434 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:12,435 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:12,435 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:12,435 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:12,435 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:14:12,438 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:14:12,438 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:14:12,442 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:14:12,444 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:14:12,445 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 11.7ms
2025-11-30 00:14:12,447 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:14:12,447 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:12,447 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:12,447 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:12,447 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:12,448 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:12,448 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:12,448 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:12,448 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:14:12,451 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:14:12,451 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:14:12,452 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:14:12,453 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:14:12,453 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 6.8ms
2025-11-30 00:14:13,517 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:14:13,518 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:13,518 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:13,518 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:13,518 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:13,518 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:13,518 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:13,519 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:13,519 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:14:13,522 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:14:13,522 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:14:13,524 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:14:13,525 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:14:13,526 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 8.6ms
2025-11-30 00:14:13,528 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:14:13,528 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:13,529 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:13,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:13,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:13,529 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:13,529 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:13,529 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:13,529 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:14:13,533 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:14:13,533 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:14:13,534 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:14:13,535 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:14:13,536 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 7.6ms
2025-11-30 00:14:13,882 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:14:13,883 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:13,883 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:13,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:13,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:13,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:13,883 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:13,884 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:13,884 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:14:13,887 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:14:13,887 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:14:13,889 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:14:13,890 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.6ms
2025-11-30 00:14:13,891 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:14:13,892 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:13,892 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:13,892 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:13,892 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:13,892 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:13,892 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:13,893 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:13,893 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:14:13,896 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:14:13,896 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:14:13,898 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:14:13,898 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.2ms
2025-11-30 00:14:33,827 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 62, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-30 00:14:33,839 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-30 00:14:33,839 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:14:34,576 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:14:34,577 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:14:34,577 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:14:34,578 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:14:34,578 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:14:34,578 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:14:34,841 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:14:34,841 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:14:34,909 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:14:34,910 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:14:34,910 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:14:35,071 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:14:35,072 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:14:35,171 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'assets', 'static', 'cdn', 'backend', 'api', 'admin'}
2025-11-30 00:14:55,137 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 00:14:55,137 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-30 00:14:55,140 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 00:14:55,140 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:55,140 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:55,140 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:55,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:55,141 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:55,141 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:55,141 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:55,141 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 00:14:55,187 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-30 00:14:55,189 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-30 00:14:55,190 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 00:14:55,197 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:14:55,197 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14418, RotaciÃ³n: True
2025-11-30 00:14:55,207 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:14:55,208 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 00:14:55,208 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-30 00:14:55,208 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14418
2025-11-30 00:14:55,208 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-30 00:14:55,212 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:14:55,212 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-30 00:14:55,213 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 73.4ms
2025-11-30 00:14:55,216 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-30 00:14:55,217 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.8ms
2025-11-30 00:14:55,220 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-30 00:14:55,220 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:55,221 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:55,221 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:55,221 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:55,221 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:55,221 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:55,221 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:55,222 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-30 00:14:55,224 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-30 00:14:55,224 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-30 00:14:55,225 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-30 00:14:55,238 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-30 00:14:55,238 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-30 00:14:55,239 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 19.2ms
2025-11-30 00:14:55,242 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-30 00:14:55,243 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-30 00:14:55,245 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 00:14:55,245 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:55,246 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:55,246 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:55,246 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:55,246 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:55,246 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:55,246 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:55,247 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 00:14:55,251 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 00:14:55,251 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 00:14:55,254 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 00:14:55,255 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 10.3ms
2025-11-30 00:14:55,260 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 00:14:55,261 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-30 00:14:55,263 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 00:14:55,264 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 00:14:55,264 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 00:14:55,264 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:14:55,265 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.9ms
2025-11-30 00:14:55,265 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.6ms
2025-11-30 00:14:55,265 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:55,266 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:55,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:55,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:55,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:55,266 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:55,266 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:55,266 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:14:55,268 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 3.6ms
2025-11-30 00:14:55,272 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:14:55,273 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:14:55,273 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:14:55,276 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 11.3ms
2025-11-30 00:14:55,276 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:14:55,277 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:55,277 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:55,277 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:55,277 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:55,277 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:55,277 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:55,277 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:55,278 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:14:55,281 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:14:55,281 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:14:55,283 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:14:55,285 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:14:55,288 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.7ms
2025-11-30 00:14:55,289 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:55,290 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:55,292 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:55,293 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:55,293 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:55,293 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:55,294 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:55,294 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:14:55,309 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:14:55,309 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:14:55,311 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:14:55,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:14:55,313 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:55,313 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:55,314 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:55,314 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:55,314 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:55,314 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:55,314 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:55,314 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:14:55,315 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 30.1ms
2025-11-30 00:14:55,319 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:14:55,319 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:14:55,321 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:14:55,322 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.5ms
2025-11-30 00:14:57,351 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 00:14:57,352 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.2ms
2025-11-30 00:14:57,353 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 00:14:57,354 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 1.1ms
2025-11-30 00:14:57,355 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:14:57,356 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:57,356 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:57,357 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:57,357 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:57,357 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:57,357 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:57,358 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:57,358 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:14:57,362 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:14:57,362 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:14:57,363 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:14:57,364 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:14:57,365 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.5ms
2025-11-30 00:14:57,367 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:14:57,367 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:14:57,368 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:14:57,368 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:14:57,368 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:14:57,368 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:14:57,368 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:14:57,368 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:14:57,369 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:14:57,374 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:14:57,374 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:14:57,375 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:14:57,376 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:14:57,377 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 10.2ms
2025-11-30 00:15:02,251 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:15:02,252 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:02,252 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:02,252 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:02,252 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:02,252 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:02,252 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:02,252 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:02,253 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:15:02,256 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:15:02,256 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:15:02,258 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:15:02,259 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 8.3ms
2025-11-30 00:15:02,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 00:15:02,262 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:02,262 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:02,262 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:02,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:02,263 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:02,263 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:02,263 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:02,263 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 00:15:02,266 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 00:15:02,267 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 00:15:02,268 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 00:15:02,269 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.5ms
2025-11-30 00:15:03,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:15:03,122 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:03,122 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:03,122 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:03,122 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:03,122 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:03,123 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:03,123 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:03,123 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:15:03,127 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:15:03,128 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:15:03,129 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:15:03,130 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:15:03,130 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 9.3ms
2025-11-30 00:15:03,132 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 00:15:03,133 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:03,133 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:03,133 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:03,133 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:03,133 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:03,133 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:03,133 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:03,134 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 00:15:03,137 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 00:15:03,137 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 00:15:03,138 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 00:15:03,138 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 00:15:03,139 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 6.9ms
2025-11-30 00:15:06,558 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-30 00:15:06,558 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:06,558 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:06,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:06,558 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:06,559 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:06,559 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:06,559 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:06,559 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-30 00:15:06,567 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:15:06,567 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 00:15:06,568 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 1, Usuario: 1 (superadmin)
2025-11-30 00:15:06,574 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:15:06,574 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=1, usuario_id=1, exito=True
2025-11-30 00:15:06,575 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 17.0ms
2025-11-30 00:15:18,127 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-30 00:15:18,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-30 00:15:18,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-30 00:15:18,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:18,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:18,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:18,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:18,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:18,130 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:18,130 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:18,130 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-30 00:15:18,137 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-30 00:15:18,137 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-30 00:15:18,137 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-30 00:15:18,369 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 00:15:18,369 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-30 00:15:18,369 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-30 00:15:18,370 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 00:15:18,378 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:15:18,379 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14419, RotaciÃ³n: False
2025-11-30 00:15:18,379 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14419
2025-11-30 00:15:18,379 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-30 00:15:18,387 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 00:15:18,387 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-30 00:15:18,388 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 259.3ms
2025-11-30 00:15:18,396 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 00:15:18,396 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:18,397 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:18,397 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:18,397 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:18,397 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:18,397 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:18,397 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:18,397 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 00:15:18,415 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 00:15:18,415 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 00:15:18,417 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 00:15:18,418 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 22.3ms
2025-11-30 00:15:18,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:15:18,419 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:18,419 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:18,419 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:18,420 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:18,420 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:18,420 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:18,420 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:18,420 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:15:18,424 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:15:18,424 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:15:18,471 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:15:18,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 53.9ms
2025-11-30 00:15:18,474 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 00:15:18,474 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:18,474 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 00:15:18,475 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 00:15:18,475 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:18,475 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 00:15:18,475 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 00:15:18,475 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:18,475 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 00:15:18,479 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 00:15:18,479 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 00:15:18,480 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 00:15:18,480 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.5ms
2025-11-30 00:15:27,654 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-30 00:15:27,655 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:27,655 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 00:15:27,655 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-30 00:15:27,655 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:27,655 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-30 00:15:27,656 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 00:15:27,656 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:27,656 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/docs
2025-11-30 00:15:27,657 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 2.2ms
2025-11-30 00:15:27,710 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-30 00:15:27,710 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host '127.0.0.1:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 00:15:27,710 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 00:15:27,710 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: '127.0.0.1'
2025-11-30 00:15:27,710 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 00:15:27,710 - app.core.tenant.middleware - WARNING - [SUBDOMAIN] No se detectÃ³ subdominio vÃ¡lido en: '127.0.0.1'. Verifica BASE_DOMAIN='app.local'
2025-11-30 00:15:27,711 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: 127.0.0.1:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 00:15:27,711 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 00:15:27,711 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/openapi.json
2025-11-30 00:15:27,961 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 251.7ms
2025-11-30 00:15:38,939 - app.infrastructure.database.connection_pool - ERROR - [CONNECTION_POOL] Error al inicializar pools: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.. Connection pooling desactivado (fallback seguro)
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection_pool.py", line 62, in _initialize_pools
    from sqlalchemy import create_engine, pool
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\__init__.py", line 13, in <module>
    from .engine import AdaptedConnection as AdaptedConnection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\__init__.py", line 18, in <module>
    from . import events as events
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\events.py", line 19, in <module>
    from .base import Connection
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 30, in <module>
    from .interfaces import BindTyping
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\engine\interfaces.py", line 38, in <module>
    from ..sql.compiler import Compiled as Compiled
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\__init__.py", line 14, in <module>
    from .compiler import COLLECT_CARTESIAN_PRODUCTS as COLLECT_CARTESIAN_PRODUCTS
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 61, in <module>
    from . import crud
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\crud.py", line 34, in <module>
    from . import dml
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\dml.py", line 34, in <module>
    from . import util as sql_util
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\util.py", line 46, in <module>
    from .ddl import sort_tables as sort_tables  # noqa: F401
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\ddl.py", line 30, in <module>
    from .elements import ClauseElement
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 808, in <module>
    class SQLCoreOperations(Generic[_T_co], ColumnOperators, TypingOnly):
    ...<472 lines>...
                ...
  File "C:\Users\Carlos\AppData\Local\Programs\Python\Python313\Lib\typing.py", line 1257, in _generic_init_subclass
    super(Generic, cls).__init_subclass__(*args, **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1988, in __init_subclass__
    raise AssertionError(
    ...<2 lines>...
    )
AssertionError: Class <class 'sqlalchemy.sql.elements.SQLCoreOperations'> directly inherits TypingOnly but has additional attributes {'__firstlineno__', '__static_attributes__'}.
2025-11-30 00:15:38,950 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-30 00:15:38,950 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:21:09,460 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:21:09,462 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:21:09,462 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:21:09,462 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:21:09,463 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:21:09,463 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:21:09,738 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:21:09,738 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:21:09,812 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:21:09,813 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:21:09,813 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:21:09,965 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:21:09,965 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:21:10,066 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'static', 'admin', 'www', 'cdn', 'backend', 'assets'}
2025-11-30 00:21:12,783 - app.infrastructure.database.connection_pool - WARNING - [CONNECTION_POOL] Error de compatibilidad SQLAlchemy 2.0.44 + Python 3.13 detectado. Connection pooling desactivado automÃ¡ticamente (fallback seguro). El sistema funcionarÃ¡ con conexiones directas sin problemas. Para resolver: Actualizar SQLAlchemy a versiÃ³n >= 2.0.36 o usar Python 3.12.
2025-11-30 00:21:12,784 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-30 00:21:12,784 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:28:54,249 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:28:54,250 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:28:54,251 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:28:54,251 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:28:54,251 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:28:54,251 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:28:54,514 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:28:54,514 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:28:54,585 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:28:54,585 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:28:54,585 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:28:54,750 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:28:54,750 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:28:54,853 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'cdn', 'api', 'admin', 'static', 'backend', 'assets'}
2025-11-30 00:28:57,792 - app.infrastructure.database.connection_pool - WARNING - [CONNECTION_POOL] Error de compatibilidad SQLAlchemy 2.0.44 + Python 3.13 detectado. Connection pooling desactivado automÃ¡ticamente (fallback seguro). El sistema funcionarÃ¡ con conexiones directas sin problemas. Para resolver: Actualizar SQLAlchemy a versiÃ³n >= 2.0.36 o usar Python 3.12.
2025-11-30 00:28:57,793 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-30 00:28:57,793 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:37:14,853 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:37:14,855 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:37:14,855 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:37:14,855 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:37:14,856 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:37:14,856 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:37:15,117 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:37:15,117 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:37:15,198 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:37:15,198 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:37:15,199 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:37:15,358 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:37:15,358 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:37:15,464 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'backend', 'api', 'www', 'admin', 'cdn', 'assets'}
2025-11-30 00:37:18,543 - app.infrastructure.database.connection_pool - WARNING - [CONNECTION_POOL] Error de compatibilidad SQLAlchemy 2.0.44 + Python 3.13 detectado. Connection pooling desactivado automÃ¡ticamente (fallback seguro). El sistema funcionarÃ¡ con conexiones directas sin problemas. Para resolver: Actualizar SQLAlchemy a versiÃ³n >= 2.0.36 o usar Python 3.12.
2025-11-30 00:37:18,544 - app.infrastructure.database.connection_pool - INFO - â¹ï¸ MÃ³dulo de connection pooling cargado pero desactivado
2025-11-30 00:37:18,544 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 00:37:32,383 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 00:37:32,385 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 00:37:32,385 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 00:37:32,386 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 00:37:32,386 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 00:37:32,386 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 00:37:32,643 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 00:37:32,643 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 00:37:32,716 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 00:37:32,716 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 00:37:32,716 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 00:37:32,891 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 00:37:32,891 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 00:37:32,991 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'api', 'cdn', 'backend', 'admin', 'www', 'static'}
2025-11-30 10:39:32,967 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 10:39:48,446 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 10:39:48,447 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 10:39:48,447 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 10:39:48,450 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 10:39:48,450 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 10:39:48,450 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 10:39:48,783 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 10:39:48,783 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 10:39:48,872 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 10:39:48,872 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 10:39:48,872 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 10:39:49,066 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 10:39:49,066 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 10:40:25,170 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 10:40:25,170 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 10:40:25,170 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 10:40:25,170 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 10:40:25,177 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 10:40:25,177 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 10:40:25,451 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 10:40:25,451 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 10:40:25,524 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 10:40:25,525 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 10:40:25,525 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 10:40:25,708 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 10:40:25,708 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 10:40:25,822 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'www', 'api', 'static', 'cdn', 'admin', 'backend', 'assets'}
2025-11-30 10:40:45,489 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 10:40:45,489 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 10:40:45,489 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 10:40:45,489 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 10:40:45,489 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 10:40:45,489 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 10:43:08,140 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 10:43:08,140 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 10:43:08,140 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 10:43:08,140 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 10:43:08,140 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 10:43:08,140 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 10:43:08,440 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 10:43:08,440 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 10:43:08,512 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 10:43:08,512 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 10:43:08,512 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 10:43:08,695 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 10:43:08,696 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 10:43:08,799 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'admin', 'assets', 'www', 'api', 'cdn', 'backend'}
2025-11-30 10:43:42,064 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-30 10:43:42,065 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-30 10:43:42,066 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:43:42,066 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:42,066 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:43:42,360 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:43:46,491 - app.infrastructure.cache.redis_cache - WARNING - [REDIS_CACHE] Error conectando a Redis: Error 10061 connecting to localhost:6379. No se puede establecer una conexiÃ³n ya que el equipo de destino denegÃ³ expresamente dicha conexiÃ³n.. Cache desactivado automÃ¡ticamente (usando fallback en memoria).
2025-11-30 10:43:46,491 - app.infrastructure.cache.redis_cache - INFO - â¹ï¸ MÃ³dulo de Redis cache cargado pero desactivado (usando fallback en memoria)
2025-11-30 10:43:46,498 - app.core.tenant.routing - INFO - [METADATA] Metadata cargada para cliente 2: multi - bd_cliente_acme
2025-11-30 10:43:46,498 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:43:46,499 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/docs
2025-11-30 10:43:46,499 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-30 10:43:46,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:46,500 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-30 10:43:46,501 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', CÃ³digo='INNOVA002', ID=3
2025-11-30 10:43:46,502 - app.core.tenant.routing - INFO - [METADATA] Metadata cargada para cliente 3: multi - bd_cliente_innova
2025-11-30 10:43:46,503 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-30 10:43:46,503 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/docs
2025-11-30 10:43:46,505 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-30 10:43:46,505 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 4441.4ms
2025-11-30 10:43:46,506 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 4440.8ms
2025-11-30 10:43:46,506 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-30 10:43:46,506 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:46,507 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-30 10:43:46,508 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', CÃ³digo='TECH003', ID=4
2025-11-30 10:43:46,509 - app.core.tenant.routing - INFO - [METADATA] Metadata cargada para cliente 4: single - bd_sistema
2025-11-30 10:43:46,509 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-30 10:43:46,510 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/docs
2025-11-30 10:43:46,512 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 7.4ms
2025-11-30 10:43:46,742 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-30 10:43:46,742 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-30 10:43:46,742 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:46,742 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-30 10:43:46,743 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', CÃ³digo='INNOVA002', ID=3
2025-11-30 10:43:46,745 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-30 10:43:46,745 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/openapi.json
2025-11-30 10:43:46,970 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-30 10:43:46,970 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', CÃ³digo='TECH003', ID=4
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/openapi.json
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:43:46,970 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/openapi.json
2025-11-30 10:43:46,970 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 234.0ms
2025-11-30 10:43:46,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 10.7ms
2025-11-30 10:43:46,983 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 10.6ms
2025-11-30 10:43:48,982 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /docs
2025-11-30 10:43:48,982 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-30 10:43:48,982 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:48,982 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-30 10:43:48,982 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', CÃ³digo='GLOBAL004', ID=5
2025-11-30 10:43:48,982 - app.core.tenant.routing - INFO - [METADATA] Metadata cargada para cliente 5: single - bd_sistema
2025-11-30 10:43:48,982 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-30 10:43:48,982 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/docs
2025-11-30 10:43:48,982 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /docs 200 4.9ms
2025-11-30 10:43:49,272 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /openapi.json
2025-11-30 10:43:49,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-30 10:43:49,272 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:49,277 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-30 10:43:49,277 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', CÃ³digo='GLOBAL004', ID=5
2025-11-30 10:43:49,277 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-30 10:43:49,277 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/openapi.json
2025-11-30 10:43:49,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /openapi.json 200 7.1ms
2025-11-30 10:43:49,482 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 10:43:49,482 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.7ms
2025-11-30 10:43:49,490 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:43:49,490 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/refresh/
2025-11-30 10:43:49,498 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:43:49,526 - app.modules.auth.application.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 2
2025-11-30 10:43:49,526 - app.core.auth - WARNING - [REFRESH] Token JWT vÃ¡lido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-30 10:43:49,526 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:43:49,532 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:43:49,535 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_invalid_or_revoked, cliente_id=1, usuario_id=None, exito=False
2025-11-30 10:43:49,535 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 45.7ms
2025-11-30 10:43:52,363 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 10:43:52,363 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-30 10:43:52,363 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': innova.app.local:5173
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'innova.app.local'
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'innova'
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='innova', CÃ³digo='INNOVA002', ID=3
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_innova, servidor=localhost
2025-11-30 10:43:52,363 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=3, db_type=multi, bd=bd_cliente_innova, path=/api/v1/auth/refresh/
2025-11-30 10:43:52,371 - app.core.tenant.routing - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-30 10:43:52,395 - app.modules.auth.application.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 3
2025-11-30 10:43:52,396 - app.core.auth - WARNING - [REFRESH] Token JWT vÃ¡lido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-30 10:43:52,396 - app.core.tenant.routing - INFO - [ROUTING] Cliente 3 -> Multi-DB (bd_cliente_innova)
2025-11-30 10:43:52,455 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:43:52,456 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_invalid_or_revoked, cliente_id=1, usuario_id=None, exito=False
2025-11-30 10:43:52,458 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 10:43:52,458 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 91.4ms
2025-11-30 10:43:52,458 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 1.2ms
2025-11-30 10:43:52,462 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 10:43:52,462 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:52,462 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': techcorp.app.local:5173
2025-11-30 10:43:52,462 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'techcorp.app.local'
2025-11-30 10:43:52,463 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:52,463 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'techcorp'
2025-11-30 10:43:52,464 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='techcorp', CÃ³digo='TECH003', ID=4
2025-11-30 10:43:52,464 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-30 10:43:52,464 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=4, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-30 10:43:52,480 - app.modules.auth.application.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 4
2025-11-30 10:43:52,480 - app.core.auth - WARNING - [REFRESH] Token JWT vÃ¡lido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-30 10:43:52,517 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:43:52,519 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_invalid_or_revoked, cliente_id=1, usuario_id=None, exito=False
2025-11-30 10:43:52,519 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 58.5ms
2025-11-30 10:43:53,165 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 10:43:53,165 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.6ms
2025-11-30 10:43:53,167 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 10:43:53,167 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:53,167 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': global.app.local:5173
2025-11-30 10:43:53,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'global.app.local'
2025-11-30 10:43:53,168 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:53,168 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'global'
2025-11-30 10:43:53,170 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='global', CÃ³digo='GLOBAL004', ID=5
2025-11-30 10:43:53,171 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_sistema, servidor=localhost
2025-11-30 10:43:53,171 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=5, db_type=single, bd=bd_sistema, path=/api/v1/auth/refresh/
2025-11-30 10:43:53,175 - app.modules.auth.application.services.refresh_token_service - WARNING - [VALIDATE-TOKEN] Token no encontrado, revocado o expirado - Cliente 5
2025-11-30 10:43:53,175 - app.core.auth - WARNING - [REFRESH] Token JWT vÃ¡lido, pero inactivo/revocado en BD. Usuario: superadmin
2025-11-30 10:43:53,190 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:43:53,191 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_invalid_or_revoked, cliente_id=1, usuario_id=None, exito=False
2025-11-30 10:43:53,192 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 24.7ms
2025-11-30 10:43:54,581 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 10:43:54,582 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.5ms
2025-11-30 10:43:54,583 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 10:43:54,583 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:54,584 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:43:54,584 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:43:54,584 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:54,584 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:43:54,584 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:43:54,584 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:43:54,585 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 10:43:54,587 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-30 10:43:54,590 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-30 10:43:54,596 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 10:43:54,601 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:43:54,602 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14420, RotaciÃ³n: True
2025-11-30 10:43:54,605 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:43:54,606 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 10:43:54,606 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-30 10:43:54,606 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14420
2025-11-30 10:43:54,606 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-30 10:43:54,611 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:43:54,611 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-30 10:43:54,612 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 28.5ms
2025-11-30 10:43:54,615 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-30 10:43:54,616 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-30 10:43:54,617 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:43:54,618 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-30 10:43:54,622 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-30 10:43:54,622 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-30 10:43:54,622 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-30 10:43:54,634 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-30 10:43:54,634 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-30 10:43:54,635 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 16.8ms
2025-11-30 10:43:54,638 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-30 10:43:54,639 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-11-30 10:43:54,641 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 10:43:54,642 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:54,642 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:43:54,642 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:43:54,642 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:54,642 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:43:54,642 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:43:54,643 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:43:54,643 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 10:43:54,704 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 10:43:54,704 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 10:43:54,706 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 10:43:54,707 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 10:43:54,708 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 67.0ms
2025-11-30 10:43:54,708 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-30 10:43:54,708 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 10:43:54,709 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.3ms
2025-11-30 10:43:54,711 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 10:43:54,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:54,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:43:54,713 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:43:54,713 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:54,713 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:43:54,713 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:43:54,713 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:43:54,713 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 10:43:54,716 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 10:43:54,717 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 10:43:54,760 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 10:43:54,761 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 50.1ms
2025-11-30 10:43:54,763 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 10:43:54,763 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:43:54,763 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:43:54,763 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:43:54,764 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:43:54,764 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:43:54,764 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:43:54,764 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:43:54,764 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 10:43:54,768 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 10:43:54,768 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 10:43:54,768 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 10:43:54,769 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 6.0ms
2025-11-30 10:44:08,158 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 10:44:08,158 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:08,158 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:08,158 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:08,158 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:08,160 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:08,160 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:08,160 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:08,160 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 10:44:08,163 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-30 10:44:08,164 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-30 10:44:08,166 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 10:44:08,173 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:08,174 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14421, RotaciÃ³n: True
2025-11-30 10:44:08,175 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:08,175 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 10:44:08,175 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-30 10:44:08,175 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14421
2025-11-30 10:44:08,177 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-30 10:44:08,178 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:08,178 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-30 10:44:08,180 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 21.9ms
2025-11-30 10:44:08,188 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-30 10:44:08,189 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:08,189 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:08,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:08,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:08,189 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:08,189 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:08,190 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:08,190 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-30 10:44:08,191 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-30 10:44:08,191 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-30 10:44:08,191 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-30 10:44:08,194 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-30 10:44:08,194 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-30 10:44:08,194 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 6.2ms
2025-11-30 10:44:08,198 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 10:44:08,198 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:08,198 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:08,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:08,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:08,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:08,200 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:08,200 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:08,200 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 10:44:08,208 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 10:44:08,210 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 10:44:08,211 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 10:44:08,212 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 13.4ms
2025-11-30 10:44:08,226 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 10:44:08,226 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:08,227 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:08,227 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:08,227 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:08,227 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:08,227 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:08,227 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:08,227 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 10:44:08,230 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 10:44:08,230 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 10:44:08,230 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 10:44:08,235 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.9ms
2025-11-30 10:44:08,238 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 10:44:08,238 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:08,238 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:08,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:08,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:08,240 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:08,240 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:08,240 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:08,240 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 10:44:08,246 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 10:44:08,246 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 10:44:08,246 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 10:44:08,248 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 9.3ms
2025-11-30 10:44:12,181 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 10:44:12,181 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.8ms
2025-11-30 10:44:12,184 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 10:44:12,184 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 0.9ms
2025-11-30 10:44:12,185 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 10:44:12,186 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:12,186 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:12,187 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:12,187 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:12,187 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:12,187 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:12,189 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:12,189 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 10:44:12,194 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 10:44:12,194 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 10:44:12,201 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 10:44:12,202 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 17.6ms
2025-11-30 10:44:12,209 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 10:44:12,210 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:12,210 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:12,211 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:12,211 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:12,211 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:12,211 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:12,211 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:12,212 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 10:44:12,216 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 10:44:12,217 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 10:44:12,218 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 10:44:12,220 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 11.1ms
2025-11-30 10:44:13,447 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 10:44:13,448 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-30 10:44:13,448 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 10:44:13,448 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.9ms
2025-11-30 10:44:13,450 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 10:44:13,450 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:13,450 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:13,450 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:13,450 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:13,450 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:13,450 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:13,450 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:13,453 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 10:44:13,456 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 10:44:13,457 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 10:44:13,461 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 10:44:13,462 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 10:44:13,463 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 12.8ms
2025-11-30 10:44:13,465 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 10:44:13,465 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:13,465 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:13,466 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:13,466 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:13,466 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:13,466 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:13,466 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:13,466 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 10:44:13,468 - app.modules.tenant.presentation.endpoints_modulos - INFO - Solicitud GET /modulos/ recibida - skip: 0, limit: 20, solo_activos: True
2025-11-30 10:44:13,470 - app.modules.tenant.application.services.modulo_service - INFO - Obteniendo catÃ¡logo de mÃ³dulos - skip: 0, limit: 20
2025-11-30 10:44:13,471 - app.modules.tenant.application.services.modulo_service - INFO - Contando total de mÃ³dulos en el sistema
2025-11-30 10:44:13,471 - app.modules.tenant.presentation.endpoints_modulos - INFO - CatÃ¡logo de mÃ³dulos recuperado: 5 mÃ³dulos de 5 totales
2025-11-30 10:44:13,472 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 200 6.8ms
2025-11-30 10:44:16,664 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 10:44:16,665 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:16,665 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:16,665 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:16,665 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:16,665 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:16,666 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:16,666 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:16,666 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 10:44:16,668 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 10:44:16,668 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 10:44:16,671 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 10:44:16,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 7.9ms
2025-11-30 10:44:16,674 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 10:44:16,674 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:16,674 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:16,674 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:16,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:16,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:16,675 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:16,675 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:16,675 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 10:44:16,680 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 10:44:16,680 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 10:44:16,682 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 10:44:16,683 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 9.0ms
2025-11-30 10:44:17,765 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-30 10:44:17,765 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-30 10:44:17,767 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [TENANT] Subdominio SUPERADMIN: platform -> Cliente ID: 1
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 10:44:17,767 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-30 10:44:17,770 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:17,770 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 10:44:17,770 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 1, Usuario: 1 (superadmin)
2025-11-30 10:44:17,773 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:17,773 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=1, usuario_id=1, exito=True
2025-11-30 10:44:17,774 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 7.6ms
2025-11-30 10:44:29,121 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-30 10:44:29,121 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-30 10:44:29,123 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-30 10:44:29,123 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:29,123 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:44:29,124 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:44:29,124 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:29,124 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:44:29,125 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:44:29,125 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:44:29,125 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/login/
2025-11-30 10:44:29,132 - app.modules.auth.presentation.endpoints - INFO - Cliente 2 resuelto y validado para login.
2025-11-30 10:44:29,132 - app.core.auth - INFO - [AUTH] Intento de login: username='admin_acme', cliente_id_destino=2
2025-11-30 10:44:29,132 - app.core.auth - INFO - [AUTH] Usuario regular. Buscando en BD del cliente_id=2
2025-11-30 10:44:29,132 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,352 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,358 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,367 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-30 10:44:29,367 - app.core.auth - INFO - [AUTH] Login exitoso: username='admin_acme', usuario_id=1, cliente_origen=2, cliente_destino=N/A, access_level=4, user_type=tenant_admin
2025-11-30 10:44:29,367 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,370 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,371 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=4, super_admin=False, type=tenant_admin
2025-11-30 10:44:29,371 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,374 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:29,375 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 2, Usuario 1, Tipo: web, Token ID: 2041, RotaciÃ³n: False
2025-11-30 10:44:29,375 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 2041
2025-11-30 10:44:29,375 - app.modules.auth.presentation.endpoints - INFO - Usuario admin_acme autenticado exitosamente (WEB) para cliente 2
2025-11-30 10:44:29,375 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,378 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:29,379 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=2, usuario_id=1, exito=True
2025-11-30 10:44:29,379 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 255.7ms
2025-11-30 10:44:29,380 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-30 10:44:29,380 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-30 10:44:29,389 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 10:44:29,390 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:29,390 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:44:29,390 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:44:29,390 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:29,390 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:44:29,394 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:44:29,394 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:44:29,394 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/clientes/tenant/branding
2025-11-30 10:44:29,396 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,397 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,401 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,406 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,410 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=2 por usuario: admin_acme
2025-11-30 10:44:29,411 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=2
2025-11-30 10:44:29,411 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=2
2025-11-30 10:44:29,412 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 22.1ms
2025-11-30 10:44:29,417 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 10:44:29,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-30 10:44:29,418 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 10:44:29,419 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.3ms
2025-11-30 10:44:29,420 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.8ms
2025-11-30 10:44:29,421 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.0ms
2025-11-30 10:44:29,421 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/areas/
2025-11-30 10:44:29,423 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/areas/ 200 1.7ms
2025-11-30 10:44:29,424 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 10:44:29,425 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:29,425 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:44:29,425 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:44:29,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:29,426 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:44:29,427 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:44:29,427 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:44:29,427 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-30 10:44:29,428 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,430 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,430 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,431 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,431 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-30 10:44:29,432 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 10:44:29,432 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,490 - app.modules.menus.application.services.menu_helper - INFO - Ãrbol de menÃº construido con 5 items raÃ­z.
2025-11-30 10:44:29,490 - app.modules.menus.application.services.menu_service - INFO - Ãrbol de menÃº construido para usuario 1 con 5 items raÃ­z.
2025-11-30 10:44:29,490 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:44:29,490 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-30 10:44:29,495 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,495 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,495 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,495 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,495 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,500 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,501 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: skip=0, limit=10, BÃºsqueda: 'None'
2025-11-30 10:44:29,501 - app.modules.menus.application.services.area_service - INFO - Obteniendo Ã¡reas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-30 10:44:29,501 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,504 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,507 - app.modules.menus.application.services.area_service - INFO - PaginaciÃ³n completada para cliente 2: 2 Ã¡reas de 2 totales
2025-11-30 10:44:29,507 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de Ã¡reas recuperada para cliente 2 - Total: 2, PÃ¡gina: 1
2025-11-30 10:44:29,507 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 84.0ms
2025-11-30 10:44:29,508 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 16.1ms
2025-11-30 10:44:29,510 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 10:44:29,511 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:29,511 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:44:29,511 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:44:29,511 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:29,511 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:44:29,512 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:44:29,512 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:44:29,513 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/menus/getmenu/
2025-11-30 10:44:29,514 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,514 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,515 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,516 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,516 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 2
2025-11-30 10:44:29,517 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 10:44:29,517 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,517 - app.modules.menus.application.services.menu_helper - INFO - Ãrbol de menÃº construido con 5 items raÃ­z.
2025-11-30 10:44:29,518 - app.modules.menus.application.services.menu_service - INFO - Ãrbol de menÃº construido para usuario 1 con 5 items raÃ­z.
2025-11-30 10:44:29,518 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/areas/
2025-11-30 10:44:29,518 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:29,520 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:44:29,520 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:44:29,520 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:29,520 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:44:29,521 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:44:29,521 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:44:29,521 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/areas/
2025-11-30 10:44:29,522 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,523 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,524 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,524 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,525 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,526 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,527 - app.modules.menus.presentation.endpoints_areas - INFO - Solicitud GET /areas/ recibida por usuario 1 del cliente 2 - PaginaciÃ³n: skip=0, limit=10, BÃºsqueda: 'None'
2025-11-30 10:44:29,527 - app.modules.menus.application.services.area_service - INFO - Obteniendo Ã¡reas paginadas para cliente 2: skip=0, limit=10, search='None'
2025-11-30 10:44:29,527 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,529 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:29,530 - app.modules.menus.application.services.area_service - INFO - PaginaciÃ³n completada para cliente 2: 2 Ã¡reas de 2 totales
2025-11-30 10:44:29,530 - app.modules.menus.presentation.endpoints_areas - INFO - Lista paginada de Ã¡reas recuperada para cliente 2 - Total: 2, PÃ¡gina: 1
2025-11-30 10:44:29,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 21.0ms
2025-11-30 10:44:29,530 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/areas/ 200 13.0ms
2025-11-30 10:44:31,127 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-30 10:44:31,127 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-30 10:44:31,129 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-30 10:44:31,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 10:44:31,129 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Tenant extraÃ­do de 'origin': acme.app.local:5173
2025-11-30 10:44:31,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'acme.app.local'
2025-11-30 10:44:31,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 10:44:31,129 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'acme'
2025-11-30 10:44:31,130 - app.core.tenant.middleware - INFO - [TENANT] Cliente resuelto: Subdominio='acme', CÃ³digo='ACME001', ID=2
2025-11-30 10:44:31,130 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=multi, bd=bd_cliente_acme, servidor=localhost
2025-11-30 10:44:31,131 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=2, db_type=multi, bd=bd_cliente_acme, path=/api/v1/auth/logout/
2025-11-30 10:44:31,131 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:31,134 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:31,138 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:31,139 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 2, Usuario 1
2025-11-30 10:44:31,139 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 2, Usuario: 1 (admin_acme)
2025-11-30 10:44:31,139 - app.core.tenant.routing - INFO - [ROUTING] Cliente 2 -> Multi-DB (bd_cliente_acme)
2025-11-30 10:44:31,143 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 10:44:31,144 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=2, usuario_id=1, exito=True
2025-11-30 10:44:31,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 15.2ms
2025-11-30 13:21:14,403 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 13:21:14,403 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 13:21:14,403 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 13:21:14,403 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 13:21:14,403 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 13:21:14,403 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 17:36:27,746 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 17:36:27,755 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 17:36:27,756 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 17:36:27,759 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 17:36:27,759 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 17:36:27,759 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 17:36:28,249 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 17:36:28,249 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 17:36:28,347 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 17:36:28,347 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 17:36:28,347 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 17:36:28,557 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 17:36:28,557 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 17:36:28,695 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'www', 'cdn', 'api', 'assets', 'admin', 'backend'}
2025-11-30 17:36:42,740 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 17:36:42,741 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-30 17:36:42,743 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 17:36:42,743 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:42,744 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:42,744 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:42,744 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:42,744 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:42,834 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:42,834 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:42,834 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:42,834 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:42,834 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:42,834 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:42,835 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:42,835 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:42,835 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:42,835 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:42,835 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:42,835 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:42,835 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 17:36:42,837 - app.core.auth - WARNING - [REFRESH] No se proporcionÃ³ refresh token. Cliente: web
2025-11-30 17:36:42,838 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 95.6ms
2025-11-30 17:36:50,159 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 17:36:50,159 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:50,159 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:50,160 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:50,160 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:50,160 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:50,183 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:50,183 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:50,183 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:50,183 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:50,184 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:50,185 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:50,185 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:50,185 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:50,185 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:50,185 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:50,185 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:50,186 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:50,186 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 17:36:50,188 - app.core.auth - WARNING - [REFRESH] No se proporcionÃ³ refresh token. Cliente: web
2025-11-30 17:36:50,188 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 29.6ms
2025-11-30 17:36:57,312 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-30 17:36:57,313 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.5ms
2025-11-30 17:36:57,314 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-30 17:36:57,314 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:57,314 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:57,314 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,315 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,315 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,315 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:57,316 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:57,316 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,316 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,316 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,317 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:57,317 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:57,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:57,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,317 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:57,317 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:57,318 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:57,318 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-30 17:36:57,331 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-30 17:36:57,331 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-30 17:36:57,331 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-30 17:36:57,573 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 17:36:57,573 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-30 17:36:57,573 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-30 17:36:57,574 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 17:36:57,587 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:36:57,587 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14422, RotaciÃ³n: False
2025-11-30 17:36:57,587 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14422
2025-11-30 17:36:57,588 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-30 17:36:57,596 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:36:57,596 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-30 17:36:57,597 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 282.7ms
2025-11-30 17:36:57,605 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-30 17:36:57,605 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.6ms
2025-11-30 17:36:57,608 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 17:36:57,608 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:57,608 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:57,608 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,608 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,609 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,609 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:57,609 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:57,609 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,610 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,610 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,610 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:57,610 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:57,611 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:57,611 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,611 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:57,611 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:57,611 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:57,611 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 17:36:57,630 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 17:36:57,630 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 17:36:57,632 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 17:36:57,633 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 17:36:57,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 26.1ms
2025-11-30 17:36:57,634 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 0.9ms
2025-11-30 17:36:57,634 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 17:36:57,635 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.2ms
2025-11-30 17:36:57,637 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:36:57,638 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:57,638 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:57,638 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,639 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,639 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,640 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:57,640 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:57,640 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,640 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,640 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,641 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:57,641 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:57,642 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:57,642 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,642 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:57,642 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:57,642 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:57,642 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:36:57,645 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 17:36:57,645 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 17:36:57,686 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 17:36:57,687 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 49.3ms
2025-11-30 17:36:57,689 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:36:57,689 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:57,689 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:57,690 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,690 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,690 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,691 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:57,691 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:57,691 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:57,691 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,691 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:57,692 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:57,692 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:57,692 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:57,692 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:57,692 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:57,693 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:57,693 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:57,693 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:36:57,695 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 17:36:57,695 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 17:36:57,696 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 17:36:57,696 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 8.7ms
2025-11-30 17:36:59,651 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 17:36:59,652 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 17:36:59,652 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.1ms
2025-11-30 17:36:59,653 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.1ms
2025-11-30 17:36:59,654 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:36:59,654 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:59,654 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:59,654 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:59,654 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:59,654 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:59,656 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:59,656 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:59,656 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:59,656 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:59,656 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:59,658 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:59,658 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:59,658 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:59,659 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:59,659 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:59,659 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:59,659 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:59,659 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:36:59,663 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 17:36:59,663 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 17:36:59,671 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 17:36:59,672 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 18.2ms
2025-11-30 17:36:59,674 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:36:59,675 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:36:59,675 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:36:59,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:59,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:59,675 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:59,676 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:36:59,676 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:36:59,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:36:59,676 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:59,677 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:36:59,677 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:36:59,677 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:36:59,679 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:36:59,679 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:36:59,679 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:36:59,679 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:36:59,679 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:36:59,679 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:36:59,682 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 17:36:59,683 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 17:36:59,684 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 17:36:59,685 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 10.7ms
2025-11-30 17:37:00,694 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 17:37:00,694 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:37:00,694 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:37:00,694 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,694 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,694 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,695 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:37:00,695 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:37:00,696 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,696 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,696 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,697 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:37:00,697 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:37:00,697 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:37:00,697 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,697 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:37:00,699 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:37:00,699 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:37:00,699 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 17:37:00,704 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-30 17:37:00,706 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-30 17:37:00,707 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 17:37:00,708 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:37:00,710 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14423, RotaciÃ³n: True
2025-11-30 17:37:00,716 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:37:00,717 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 17:37:00,717 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-30 17:37:00,717 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14423
2025-11-30 17:37:00,717 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-30 17:37:00,720 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:37:00,720 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-30 17:37:00,722 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 28.0ms
2025-11-30 17:37:00,726 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-30 17:37:00,726 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-30 17:37:00,728 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-30 17:37:00,728 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:37:00,728 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:37:00,729 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,729 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,729 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,731 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:37:00,731 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:37:00,731 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,731 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,731 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,732 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:37:00,732 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:37:00,732 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:37:00,732 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,732 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:37:00,732 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:37:00,733 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:37:00,733 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-30 17:37:00,734 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-30 17:37:00,735 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-30 17:37:00,735 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-30 17:37:00,747 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-30 17:37:00,747 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-30 17:37:00,747 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 18.6ms
2025-11-30 17:37:00,750 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 17:37:00,750 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:37:00,750 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:37:00,751 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,751 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,751 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,752 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:37:00,752 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:37:00,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,752 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,753 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:37:00,753 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:37:00,753 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:37:00,753 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,753 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:37:00,753 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:37:00,754 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:37:00,754 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 17:37:00,757 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /tenant/branding recibida para cliente_id=1 por usuario: superadmin
2025-11-30 17:37:00,757 - app.modules.tenant.application.services.cliente_service - INFO - Solicitando branding para cliente_id=1
2025-11-30 17:37:00,759 - app.modules.tenant.application.services.cliente_service - INFO - Branding obtenido exitosamente para cliente_id=1
2025-11-30 17:37:00,760 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 200 9.3ms
2025-11-30 17:37:00,763 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:37:00,764 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:37:00,764 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:37:00,764 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,765 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,765 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,765 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:37:00,766 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:37:00,766 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,766 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,766 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,767 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:37:00,767 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:37:00,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:37:00,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,767 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:37:00,768 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:37:00,768 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:37:00,768 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:37:00,768 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:37:00,772 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 17:37:00,772 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 17:37:00,772 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 17:37:00,773 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:37:00,773 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:37:00,773 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,773 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,773 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,774 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:37:00,774 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:37:00,774 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,774 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,775 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,776 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:37:00,776 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:37:00,776 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:37:00,776 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,776 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:37:00,776 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:37:00,777 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:37:00,777 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:37:00,781 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 17:37:00,781 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 17:37:00,782 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 17:37:00,783 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.5ms
2025-11-30 17:37:00,784 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 14.9ms
2025-11-30 17:37:00,785 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:37:00,785 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:37:00,786 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:37:00,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,786 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,787 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:37:00,787 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:37:00,787 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,787 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,787 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,788 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:37:00,788 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:37:00,788 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:37:00,788 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,788 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:37:00,788 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:37:00,788 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:37:00,788 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:37:00,790 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:37:00,793 - app.modules.menus.presentation.endpoints - INFO - Solicitud GET /menus/getmenu/ recibida para usuario ID: 1 del cliente 1
2025-11-30 17:37:00,794 - app.modules.menus.application.services.menu_service - INFO - Obteniendo menÃº filtrado para usuario_id: 1
2025-11-30 17:37:00,795 - app.modules.menus.application.services.menu_service - INFO - No se encontraron menÃºs permitidos para el usuario ID: 1.
2025-11-30 17:37:00,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:37:00,795 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:37:00,795 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,795 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,795 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,797 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:37:00,797 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:37:00,797 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:37:00,798 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,798 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:37:00,798 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:37:00,799 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:37:00,799 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:37:00,799 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:37:00,799 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:37:00,799 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:37:00,799 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:37:00,799 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:37:00,802 - app.modules.tenant.presentation.endpoints_clientes - INFO - Solicitud GET /clientes/ recibida - skip: 0, limit: 10, solo_activos: True, buscar: None por usuario: superadmin
2025-11-30 17:37:00,803 - app.modules.tenant.application.services.cliente_service - INFO - Listando clientes - skip: 0, limit: 10, solo_activos: True, buscar: None
2025-11-30 17:37:00,804 - app.modules.tenant.application.services.cliente_service - INFO - Listados 6 clientes de 6 totales
2025-11-30 17:37:00,805 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 200 19.6ms
2025-11-30 17:37:00,805 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 200 15.6ms
2025-11-30 17:37:32,372 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 17:37:32,372 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 17:37:32,372 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 17:37:32,372 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 17:37:32,373 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 17:37:32,373 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 17:57:42,752 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 17:57:42,754 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 17:57:42,754 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 17:57:42,754 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 17:57:42,755 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 17:57:42,755 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 17:57:43,026 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 17:57:43,026 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 17:57:43,096 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 17:57:43,097 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 17:57:43,097 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 17:57:43,278 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 17:57:43,280 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 17:57:43,378 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'cdn', 'static', 'backend', 'assets', 'api', 'www', 'admin'}
2025-11-30 17:57:53,684 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/refresh/
2025-11-30 17:57:53,684 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/refresh/ 200 0.8ms
2025-11-30 17:57:53,686 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 17:57:53,687 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:57:53,687 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:57:53,687 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,687 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,687 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,754 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:57:53,754 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:57:53,754 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,755 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,755 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,755 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:57:53,756 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:57:53,756 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:57:53,756 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,756 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:57:53,756 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:57:53,756 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:57:53,757 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 17:57:53,765 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-30 17:57:53,768 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-30 17:57:53,775 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 17:57:53,781 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:57:53,781 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14424, RotaciÃ³n: True
2025-11-30 17:57:53,788 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:57:53,788 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 17:57:53,789 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-30 17:57:53,789 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14424
2025-11-30 17:57:53,789 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-30 17:57:53,794 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:57:53,795 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-30 17:57:53,795 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 109.1ms
2025-11-30 17:57:53,800 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/me/
2025-11-30 17:57:53,800 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/me/ 200 0.5ms
2025-11-30 17:57:53,802 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-30 17:57:53,802 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:57:53,803 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:57:53,803 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,803 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,803 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,804 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:57:53,804 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:57:53,804 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,804 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,804 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,805 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:57:53,805 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:57:53,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:57:53,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,805 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:57:53,805 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:57:53,805 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:57:53,807 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-30 17:57:53,810 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-30 17:57:53,810 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-30 17:57:53,810 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-30 17:57:53,822 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-30 17:57:53,822 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-30 17:57:53,823 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 20.6ms
2025-11-30 17:57:53,827 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/tenant/branding
2025-11-30 17:57:53,828 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/tenant/branding 200 0.5ms
2025-11-30 17:57:53,829 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 17:57:53,830 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:57:53,830 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:57:53,830 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,830 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,830 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,831 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:57:53,831 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:57:53,831 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,831 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,832 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,832 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:57:53,832 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:57:53,832 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:57:53,832 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,832 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:57:53,832 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:57:53,832 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:57:53,833 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 17:57:53,834 - app.infrastructure.database.queries - INFO - [SQL_VERSION] Detectada versiÃ³n: SQL Server 2022 (internal: 16)
2025-11-30 17:57:53,853 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:57:53,856 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 17:57:53,857 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 28.9ms
2025-11-30 17:57:53,858 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 1.9ms
2025-11-30 17:57:53,858 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/menus/getmenu/
2025-11-30 17:57:53,858 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 17:57:53,858 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/clientes/
2025-11-30 17:57:53,861 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/menus/getmenu/ 200 2.2ms
2025-11-30 17:57:53,861 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 2.1ms
2025-11-30 17:57:53,861 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/clientes/ 200 1.9ms
2025-11-30 17:57:53,864 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:57:53,864 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:57:53,864 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:57:53,865 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,865 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,865 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,866 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:57:53,866 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:57:53,866 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,866 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,866 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,867 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:57:53,867 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:57:53,867 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:57:53,867 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,867 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:57:53,867 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:57:53,868 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:57:53,868 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:57:53,868 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:57:53,870 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:57:53,871 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:57:53,871 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:57:53,871 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,871 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,871 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,872 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:57:53,872 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:57:53,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,872 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,873 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:57:53,873 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:57:53,873 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:57:53,874 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,874 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:57:53,874 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:57:53,874 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:57:53,874 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:57:53,876 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:57:53,877 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 13.6ms
2025-11-30 17:57:53,878 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 9.7ms
2025-11-30 17:57:53,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:57:53,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:57:53,881 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:57:53,882 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:57:53,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,882 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:57:53,882 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:57:53,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,884 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:57:53,884 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:57:53,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:57:53,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,884 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:57:53,884 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:57:53,885 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:57:53,885 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:57:53,886 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:57:53,887 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:57:53,887 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:57:53,888 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,888 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,888 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,888 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:57:53,890 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:57:53,890 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:57:53,890 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,890 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:57:53,891 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:57:53,891 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:57:53,891 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:57:53,891 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:57:53,891 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:57:53,891 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:57:53,892 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:57:53,892 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:57:53,894 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:57:53,895 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 14.8ms
2025-11-30 17:57:53,895 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 14.6ms
2025-11-30 17:58:00,261 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 17:58:00,261 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.7ms
2025-11-30 17:58:00,262 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/modulos/
2025-11-30 17:58:00,263 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/modulos/ 200 0.4ms
2025-11-30 17:58:00,264 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 17:58:00,265 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:00,265 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:00,265 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:00,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:00,266 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:00,267 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:00,267 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:00,267 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:00,267 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:00,268 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:00,268 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:00,270 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:00,270 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:00,270 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:00,270 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:00,270 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:00,270 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:00,270 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 17:58:00,272 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:00,273 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 500 9.0ms
2025-11-30 17:58:00,275 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/modulos/
2025-11-30 17:58:00,275 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:00,276 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:00,276 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:00,276 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:00,276 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:00,278 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:00,278 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:00,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:00,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:00,278 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:00,279 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:00,279 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:00,279 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:00,279 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:00,279 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:00,280 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:00,280 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:00,280 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/modulos/
2025-11-30 17:58:00,282 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:00,283 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/modulos/ 500 8.4ms
2025-11-30 17:58:02,594 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/logout/
2025-11-30 17:58:02,594 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/logout/ 200 0.5ms
2025-11-30 17:58:02,596 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/logout/
2025-11-30 17:58:02,596 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:02,596 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:02,596 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:02,597 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:02,597 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:02,598 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:02,598 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:02,598 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:02,598 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:02,598 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:02,598 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:02,598 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:02,600 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:02,600 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:02,600 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:02,600 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:02,600 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:02,600 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/logout/
2025-11-30 17:58:02,602 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:58:02,602 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 17:58:02,602 - app.modules.auth.presentation.endpoints - INFO - [LOGOUT-WEB] Token no encontrado en BD (ya expirado/revocado) - Cliente: 1, Usuario: 1 (superadmin)
2025-11-30 17:58:02,606 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:58:02,606 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=logout, cliente_id=1, usuario_id=1, exito=True
2025-11-30 17:58:02,607 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/logout/ 200 11.3ms
2025-11-30 17:58:05,097 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 17:58:05,097 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:05,097 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:05,097 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:05,098 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:05,098 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:05,098 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:05,098 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:05,098 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:05,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:05,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:05,100 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:05,100 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:05,100 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:05,101 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:05,101 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:05,101 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:05,101 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:05,101 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 17:58:05,104 - app.core.auth - WARNING - [REFRESH] No se proporcionÃ³ refresh token. Cliente: web
2025-11-30 17:58:05,104 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 401 6.8ms
2025-11-30 17:58:21,604 - app.main - INFO - [SYSTEM] 127.0.0.1 -> OPTIONS /api/v1/auth/login/
2025-11-30 17:58:21,604 - app.main - INFO - [SYSTEM] 127.0.0.1 <- OPTIONS /api/v1/auth/login/ 200 0.4ms
2025-11-30 17:58:21,606 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/login/
2025-11-30 17:58:21,606 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:21,606 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:21,607 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,607 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,607 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,608 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:21,608 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:21,608 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,608 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,608 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,608 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:21,608 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:21,609 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:21,609 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,609 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:21,609 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:21,609 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:21,609 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/login/
2025-11-30 17:58:21,615 - app.modules.auth.presentation.endpoints - INFO - Cliente 1 resuelto y validado para login.
2025-11-30 17:58:21,616 - app.core.auth - INFO - [AUTH] Intento de login: username='superadmin', cliente_id_destino=1
2025-11-30 17:58:21,616 - app.core.auth - INFO - [AUTH] SUPERADMIN detectado. Buscando en BD ADMIN (cliente_id=1), accediendo a cliente_id=1
2025-11-30 17:58:21,850 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 17:58:21,850 - app.core.auth - INFO - [AUTH] Login exitoso: username='superadmin', usuario_id=1, cliente_origen=1, cliente_destino=1, access_level=5, user_type=super_admin
2025-11-30 17:58:21,851 - app.modules.auth.presentation.endpoints - INFO - [LOGIN] Superadmin accediendo a cliente_id=1
2025-11-30 17:58:21,851 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 17:58:21,852 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:58:21,852 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14425, RotaciÃ³n: False
2025-11-30 17:58:21,852 - app.modules.auth.presentation.endpoints - INFO - [LOGIN-WEB] Token almacenado - ID: 14425
2025-11-30 17:58:21,853 - app.modules.auth.presentation.endpoints - INFO - Usuario superadmin autenticado exitosamente (WEB) para cliente 1
2025-11-30 17:58:21,857 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 17:58:21,857 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=login_success, cliente_id=1, usuario_id=1, exito=True
2025-11-30 17:58:21,858 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/login/ 200 251.3ms
2025-11-30 17:58:21,865 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 17:58:21,865 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:21,865 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:21,865 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,867 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,867 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,868 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:21,868 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:21,868 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,868 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,868 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,869 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:21,869 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:21,869 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:21,869 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,870 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:21,870 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:21,870 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:21,870 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 17:58:21,872 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:21,874 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 8.8ms
2025-11-30 17:58:21,881 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:58:21,881 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:21,881 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:21,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,883 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:21,883 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:21,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,886 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:21,886 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:21,886 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:21,886 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,886 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:21,886 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:21,886 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:21,887 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:58:21,889 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:21,890 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 9.9ms
2025-11-30 17:58:21,891 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 17:58:21,892 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:21,892 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:21,892 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,892 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,892 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,893 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:21,893 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:21,893 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:21,895 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,895 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:21,896 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:21,896 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:21,896 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:21,896 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:21,896 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:21,896 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:21,897 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:21,897 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 17:58:21,899 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:21,899 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/menus/getmenu/ 500 8.0ms
2025-11-30 17:58:30,136 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:58:30,137 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:30,137 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:30,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:30,137 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:30,138 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:30,138 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:30,139 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:30,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:30,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:30,139 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:30,140 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:30,140 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:30,140 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:30,140 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:30,140 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:30,141 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:30,141 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:30,141 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:58:30,142 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:30,144 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 7.0ms
2025-11-30 17:58:30,145 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:58:30,146 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:30,146 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:30,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:30,146 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:30,147 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:30,148 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:30,148 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:30,148 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:30,148 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:30,148 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:30,148 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:30,148 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:30,150 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:30,150 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:30,150 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:30,150 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:30,150 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:30,150 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:58:30,152 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:30,152 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 7.4ms
2025-11-30 17:58:58,148 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:58:58,148 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:58,148 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:58,150 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:58,150 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:58,150 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:58,167 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:58,167 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:58,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:58,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:58,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:58,168 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:58,168 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:58,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:58,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:58,169 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:58,169 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:58,169 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:58,169 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:58:58,193 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:58,195 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 46.5ms
2025-11-30 17:58:58,197 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:58:58,197 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:58:58,197 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:58:58,197 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:58,197 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:58,198 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:58,198 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:58:58,199 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:58:58,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:58:58,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:58,199 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:58:58,200 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:58:58,200 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:58:58,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:58:58,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:58:58,200 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:58:58,200 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:58:58,200 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:58:58,201 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:58:58,202 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:58:58,203 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 6.8ms
2025-11-30 17:59:03,003 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 17:59:03,003 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 17:59:03,003 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 17:59:03,003 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 17:59:03,004 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 17:59:03,004 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 17:59:06,103 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 17:59:06,104 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 17:59:06,104 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 17:59:06,105 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 17:59:06,105 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 17:59:06,105 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 17:59:06,377 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 17:59:06,378 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 17:59:06,447 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 17:59:06,447 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 17:59:06,447 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 17:59:06,631 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 17:59:06,631 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 17:59:06,736 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'admin', 'static', 'api', 'cdn', 'www', 'backend', 'assets'}
2025-11-30 17:59:15,825 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:59:15,825 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:59:15,827 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:59:15,827 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:15,827 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:15,827 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:15,882 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:59:15,882 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:59:15,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:15,882 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:15,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:15,883 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:59:15,883 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:59:15,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:59:15,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:15,883 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:59:15,883 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:59:15,884 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:59:15,884 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:59:15,887 - app.infrastructure.database.queries - INFO - [SQL_VERSION] Detectada versiÃ³n: SQL Server 2022 (internal: 16)
2025-11-30 17:59:15,890 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:59:15,893 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 67.3ms
2025-11-30 17:59:15,895 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:59:15,895 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:59:15,895 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:59:15,895 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:15,895 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:15,896 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:15,896 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:59:15,897 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:59:15,897 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:15,897 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:15,897 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:15,897 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:59:15,899 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:59:15,899 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:59:15,899 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:15,899 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:59:15,899 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:59:15,899 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:59:15,899 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:59:15,900 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:59:15,901 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 6.3ms
2025-11-30 17:59:20,514 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 17:59:20,514 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 17:59:20,514 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 17:59:20,514 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 17:59:20,515 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 17:59:20,515 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 17:59:22,936 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 17:59:22,938 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 17:59:22,938 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 17:59:22,939 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 17:59:22,939 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 17:59:22,939 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 17:59:23,207 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 17:59:23,208 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 17:59:23,276 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 17:59:23,276 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 17:59:23,276 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 17:59:23,461 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 17:59:23,461 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 17:59:23,575 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'static', 'backend', 'assets', 'cdn', 'api', 'admin', 'www'}
2025-11-30 17:59:25,477 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:59:25,478 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:59:25,478 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:59:25,478 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:25,478 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:25,478 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:25,502 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:59:25,502 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:59:25,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:25,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:25,503 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:25,503 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:59:25,504 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:59:25,504 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:59:25,504 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:25,504 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:59:25,504 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:59:25,504 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:59:25,504 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:59:25,508 - app.infrastructure.database.queries - INFO - [SQL_VERSION] Detectada versiÃ³n: SQL Server 2022 (internal: 16)
2025-11-30 17:59:25,510 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:59:25,513 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 36.3ms
2025-11-30 17:59:25,515 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:59:25,515 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:59:25,515 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:59:25,516 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:25,516 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:25,516 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:25,517 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:59:25,517 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:59:25,517 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:25,517 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:25,517 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:25,518 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:59:25,518 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:59:25,518 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:59:25,519 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:25,519 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:59:25,519 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:59:25,519 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:59:25,519 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:59:25,521 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:59:25,522 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 7.6ms
2025-11-30 17:59:50,986 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 17:59:50,987 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 17:59:50,987 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 17:59:50,987 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 17:59:50,987 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 17:59:50,987 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 17:59:55,272 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 17:59:55,273 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 17:59:55,275 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 17:59:55,275 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 17:59:55,275 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 17:59:55,275 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 17:59:55,546 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 17:59:55,546 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 17:59:55,616 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 17:59:55,616 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 17:59:55,617 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 17:59:55,800 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 17:59:55,801 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 17:59:55,902 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'static', 'admin', 'www', 'assets', 'cdn', 'backend'}
2025-11-30 17:59:59,711 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:59:59,711 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:59:59,712 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:59:59,712 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:59,712 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:59,712 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:59,779 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:59:59,779 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:59:59,779 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:59,779 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:59,779 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:59,780 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:59:59,780 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:59:59,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:59:59,780 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:59,781 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:59:59,781 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:59:59,781 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:59:59,781 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:59:59,784 - app.infrastructure.database.queries - INFO - [SQL_VERSION] Detectada versiÃ³n: SQL Server 2022 (internal: 16)
2025-11-30 17:59:59,806 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:59:59,808 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 97.7ms
2025-11-30 17:59:59,810 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 17:59:59,810 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 17:59:59,810 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 17:59:59,811 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:59,811 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:59,811 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:59,813 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 17:59:59,813 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 17:59:59,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 17:59:59,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:59,813 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 17:59:59,814 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 17:59:59,814 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 17:59:59,814 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 17:59:59,814 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 17:59:59,814 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 17:59:59,814 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 17:59:59,814 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 17:59:59,815 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 17:59:59,816 - app.api.deps - ERROR - Error parseando diccionario de rol a RolRead: {'rol_id': 1, 'nombre': 'Super Administrador', 'descripcion': 'Acceso completo al sistema multi-tenant. Nivel LBAC 5.', 'nivel_acceso': 5, 'codigo_rol': 'SUPER_ADMIN', 'es_activo': True}. Error: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 341, in get_current_active_user
    roles_list.append(RolRead(**rol_dict))
                      ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\venv\Lib\site-packages\pydantic\main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for RolRead
fecha_creacion
  Field required [type=missing, input_value={'rol_id': 1, 'nombre': '...MIN', 'es_activo': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-11-30 17:59:59,817 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 7.0ms
2025-11-30 18:03:44,891 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 18:03:44,891 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 18:03:44,891 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 18:03:44,891 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 18:03:44,892 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 18:03:44,892 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 18:03:45,660 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 18:03:45,662 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 18:03:45,662 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 18:03:45,663 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 18:03:45,663 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 18:03:45,663 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 18:03:45,956 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 18:03:45,956 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 18:03:46,023 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 18:03:46,023 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 18:03:46,023 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 18:03:46,202 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 18:03:46,203 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 18:03:46,306 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'assets', 'cdn', 'api', 'backend', 'admin', 'static', 'www'}
2025-11-30 18:03:48,274 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 18:03:48,275 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 18:03:48,275 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 18:03:48,275 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:48,275 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:48,275 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:48,348 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 18:03:48,348 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 18:03:48,348 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:48,348 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:48,350 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:48,350 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 18:03:48,350 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 18:03:48,350 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 18:03:48,351 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:48,351 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 18:03:48,351 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 18:03:48,351 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 18:03:48,351 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 18:03:48,355 - app.infrastructure.database.queries - INFO - [SQL_VERSION] Detectada versiÃ³n: SQL Server 2022 (internal: 16)
2025-11-30 18:03:48,358 - app.infrastructure.database.queries - ERROR - Error en execute_auth_query: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:48,359 - app.infrastructure.database.connection - ERROR - Error general en la gestiÃ³n de conexiÃ³n: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection.py", line 142, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:48,360 - app.api.deps - ERROR - Error inesperado obteniendo usuario activo 'superadmin': Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 196, in get_current_active_user
    user_dict = execute_auth_query(
                ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:48,362 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 88.5ms
2025-11-30 18:03:48,364 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 18:03:48,364 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 18:03:48,364 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 18:03:48,364 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:48,364 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:48,364 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:48,366 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 18:03:48,366 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 18:03:48,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:48,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:48,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:48,367 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 18:03:48,367 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 18:03:48,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 18:03:48,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:48,367 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 18:03:48,367 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 18:03:48,368 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 18:03:48,368 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/
2025-11-30 18:03:48,369 - app.infrastructure.database.queries - ERROR - Error en execute_auth_query: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:48,370 - app.infrastructure.database.connection - ERROR - Error general en la gestiÃ³n de conexiÃ³n: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection.py", line 142, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:48,371 - app.api.deps - ERROR - Error inesperado obteniendo usuario activo 'superadmin': Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 196, in get_current_active_user
    user_dict = execute_auth_query(
                ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:48,372 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/ 500 8.2ms
2025-11-30 18:03:52,973 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Pool ADMIN inicializado. Size=10, MaxOverflow=5
2025-11-30 18:03:52,974 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] ConfiguraciÃ³n de pools de tenants: MaxPools=50, PoolSize=3, MaxOverflow=2, InactivityTimeout=3600s
2025-11-30 18:03:52,974 - app.infrastructure.database.connection_pool - INFO - â MÃ³dulo de connection pooling cargado y activo
2025-11-30 18:03:52,974 - app.infrastructure.database.connection_pool - INFO -    ConfiguraciÃ³n: MaxTenantPools=50, TenantPoolSize=3, InactivityTimeout=3600s
2025-11-30 18:03:52,974 - app.infrastructure.database.connection_pool - INFO - [CONNECTION_POOL] Todos los pools cerrados
2025-11-30 18:03:52,974 - app.main - INFO - â Pools de conexiÃ³n cerrados correctamente
2025-11-30 18:03:56,211 - app.core.tenant.context - INFO - MÃ³dulo tenant_context cargado (versiÃ³n hÃ­brida)
2025-11-30 18:03:56,212 - app.core.security.encryption - INFO - EncryptionManager inicializado correctamente
2025-11-30 18:03:56,212 - app.core.security.encryption - INFO - MÃ³dulo de encriptaciÃ³n cargado correctamente
2025-11-30 18:03:56,213 - app.core.tenant.cache - INFO - â ConnectionMetadataCache inicializado (TTL: 300s)
2025-11-30 18:03:56,213 - app.core.tenant.cache - INFO - MÃ³dulo connection_cache cargado. Cache global: ConnectionMetadataCache(size=0, ttl=300.0s)
2025-11-30 18:03:56,213 - app.core.tenant.routing - INFO - MÃ³dulo multi_db cargado. SYSTEM_CLIENT_ID=1, DEFAULT_TYPE=single
2025-11-30 18:03:56,482 - app.core.security.rate_limiting - INFO - [RATE_LIMITING] Activado. LÃ­mites: Login=10/minute, API=200/minute
2025-11-30 18:03:56,482 - app.core.security.rate_limiting - INFO - â MÃ³dulo de rate limiting cargado y activo
2025-11-30 18:03:56,552 - app.core.authorization.rbac - INFO - ð Inicializando sistema de autorizaciÃ³n...
2025-11-30 18:03:56,552 - app.core.authorization.rbac - INFO - â Sistema de autorizaciÃ³n inicializado correctamente
2025-11-30 18:03:56,552 - app.core.authorization.rbac - INFO - ð Permisos del sistema: 6 mÃ³dulos configurados
2025-11-30 18:03:56,729 - app.core.tenant.middleware - INFO - MÃ³dulo tenant_middleware cargado (versiÃ³n hÃ­brida con soporte para proxies)
2025-11-30 18:03:56,730 - app.main - INFO - â Rate limiting configurado y activo
2025-11-30 18:03:56,833 - app.core.tenant.middleware - INFO - [TENANT_MW] Inicializado - BASE_DOMAIN=app.local, SYSTEM_ID=1, EXCLUDED_SUBDOMAINS={'api', 'backend', 'assets', 'static', 'www', 'cdn', 'admin'}
2025-11-30 18:03:59,046 - app.main - INFO - [SYSTEM] 127.0.0.1 -> POST /api/v1/auth/refresh/
2025-11-30 18:03:59,046 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 18:03:59,047 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 18:03:59,047 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,047 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,047 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,072 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 18:03:59,073 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 18:03:59,073 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,073 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,073 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,074 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 18:03:59,074 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 18:03:59,074 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 18:03:59,074 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,074 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 18:03:59,075 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 18:03:59,075 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 18:03:59,075 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/refresh/
2025-11-30 18:03:59,092 - app.modules.auth.application.services.refresh_token_service - INFO - [VALIDATE-TOKEN] Token vÃ¡lido - Cliente 1, Usuario 1, Tipo: web
2025-11-30 18:03:59,094 - app.core.auth - INFO - [REFRESH] Token validado exitosamente (BD OK) para usuario: superadmin (Cliente: 1, Level: 5, Type: super_admin)
2025-11-30 18:03:59,100 - app.core.auth - INFO - Niveles calculados - Usuario 1: level=5, super_admin=True, type=super_admin
2025-11-30 18:03:59,106 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 18:03:59,106 - app.modules.auth.application.services.refresh_token_service - INFO - [STORE-TOKEN] Token insertado exitosamente - Cliente 1, Usuario 1, Tipo: web, Token ID: 14426, RotaciÃ³n: True
2025-11-30 18:03:59,115 - app.infrastructure.database.queries - INFO - ActualizaciÃ³n exitosa, filas afectadas: -1
2025-11-30 18:03:59,115 - app.modules.auth.application.services.refresh_token_service - WARNING - [REVOKE-TOKEN] Token no encontrado o ya revocado - Cliente 1, Usuario 1
2025-11-30 18:03:59,117 - app.modules.auth.presentation.endpoints - WARNING - [REFRESH] Token antiguo no encontrado para revocar (no crÃ­tico)
2025-11-30 18:03:59,117 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token rotado exitosamente - ID: 14426
2025-11-30 18:03:59,117 - app.modules.auth.presentation.endpoints - INFO - [REFRESH-WEB] Token refrescado exitosamente - Usuario: superadmin
2025-11-30 18:03:59,124 - app.infrastructure.database.queries - INFO - InserciÃ³n exitosa, filas afectadas: -1
2025-11-30 18:03:59,124 - app.modules.superadmin.application.services.audit_service - INFO - [AUDIT] auth_audit_log registrado: evento=token_refresh, cliente_id=1, usuario_id=1, exito=True
2025-11-30 18:03:59,125 - app.main - INFO - [SYSTEM] 127.0.0.1 <- POST /api/v1/auth/refresh/ 200 79.1ms
2025-11-30 18:03:59,128 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/auth/me/
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,128 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,128 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,131 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 18:03:59,131 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 18:03:59,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 18:03:59,131 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,132 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 18:03:59,132 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 18:03:59,132 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 18:03:59,132 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/auth/me/
2025-11-30 18:03:59,135 - app.modules.auth.presentation.endpoints - INFO - Solicitud /me/ recibida para usuario: superadmin
2025-11-30 18:03:59,135 - app.modules.auth.presentation.endpoints - INFO - [ME] Niveles desde token - Level: 5, Super Admin: True, Type: super_admin
2025-11-30 18:03:59,135 - app.modules.users.application.services.user_service - INFO - Obteniendo usuario completo ID 1 para cliente 1
2025-11-30 18:03:59,146 - app.modules.users.application.services.user_service - INFO - Usuario completo obtenido exitosamente: ID 1 con 1 roles activos
2025-11-30 18:03:59,146 - app.modules.auth.presentation.endpoints - INFO - [ME] Datos completos enviados - Usuario: superadmin, Type: super_admin, Level: 5, Super Admin: True, Roles: 1
2025-11-30 18:03:59,147 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/auth/me/ 200 18.4ms
2025-11-30 18:03:59,151 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/tenant/branding
2025-11-30 18:03:59,151 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 18:03:59,151 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 18:03:59,152 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,152 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,152 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,153 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 18:03:59,153 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 18:03:59,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,153 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,154 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 18:03:59,154 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 18:03:59,154 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 18:03:59,154 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,154 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 18:03:59,154 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 18:03:59,154 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 18:03:59,154 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/clientes/tenant/branding
2025-11-30 18:03:59,155 - app.infrastructure.database.queries - INFO - [SQL_VERSION] Detectada versiÃ³n: SQL Server 2022 (internal: 16)
2025-11-30 18:03:59,156 - app.infrastructure.database.queries - ERROR - Error en execute_auth_query: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:59,157 - app.infrastructure.database.connection - ERROR - Error general en la gestiÃ³n de conexiÃ³n: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection.py", line 142, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:59,158 - app.api.deps - ERROR - Error inesperado obteniendo usuario activo 'superadmin': Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 196, in get_current_active_user
    user_dict = execute_auth_query(
                ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:59,160 - app.main - INFO - [SYSTEM] 127.0.0.1 <- GET /api/v1/clientes/tenant/branding 500 9.7ms
2025-11-30 18:03:59,163 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/menus/getmenu/
2025-11-30 18:03:59,164 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Host 'backend.app.local:8000' es localhost/infraestructura, buscando tenant real en origin/referer
2025-11-30 18:03:59,164 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'origin': platform.app.local:5173
2025-11-30 18:03:59,164 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,164 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,164 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,165 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando origin
2025-11-30 18:03:59,166 - app.core.tenant.middleware - INFO - [HOST_DETECTION] Desarrollo: Tenant extraÃ­do de 'referer': platform.app.local:5173
2025-11-30 18:03:59,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'platform.app.local'
2025-11-30 18:03:59,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,166 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Detectado: 'platform'
2025-11-30 18:03:59,167 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] Subdominio 'platform' no existe en BD, rechazando referer
2025-11-30 18:03:59,167 - app.core.tenant.middleware - WARNING - [HOST_DETECTION] No se pudo extraer tenant real de origin/referer, usando cliente por defecto (SYSTEM)
2025-11-30 18:03:59,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] Procesando host: 'backend.app.local'
2025-11-30 18:03:59,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] BASE_DOMAIN: 'app.local'
2025-11-30 18:03:59,167 - app.core.tenant.middleware - INFO - [SUBDOMAIN] 'backend' es infraestructura, ignorando (usando SYSTEM)
2025-11-30 18:03:59,168 - app.core.tenant.middleware - WARNING - [TENANT] Sin subdominio en Host: backend.app.local:8000. Usando Cliente ID por defecto: 1 (SYSTEM)
2025-11-30 18:03:59,168 - app.core.tenant.middleware - INFO - [TENANT] Metadata cargada: db_type=single, bd=bd_hybrid_sistema_central, servidor=N/A
2025-11-30 18:03:59,168 - app.core.tenant.middleware - INFO - [TENANT] CONTEXTO ESTABLECIDO: cliente_id=1, db_type=single, bd=bd_hybrid_sistema_central, path=/api/v1/menus/getmenu/
2025-11-30 18:03:59,168 - app.main - INFO - [SYSTEM] 127.0.0.1 -> GET /api/v1/clientes/
2025-11-30 18:03:59,170 - app.infrastructure.database.queries - ERROR - Error en execute_auth_query: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:59,170 - app.infrastructure.database.connection - ERROR - Error general en la gestiÃ³n de conexiÃ³n: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\connection.py", line 142, in get_db_connection
    yield conn
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
2025-11-30 18:03:59,172 - app.api.deps - ERROR - Error inesperado obteniendo usuario activo 'superadmin': Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 157, in execute_auth_query
    cursor.execute(query, params)
pyodbc.ProgrammingError: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\base_multi_tenant_fastapi\app\api\deps.py", line 196, in get_current_active_user
    user_dict = execute_auth_query(
                ^^^^^^^^^^^^^^^^^^^
  File "D:\base_multi_tenant_fastapi\app\infrastructure\database\queries.py", line 171, in execute_auth_query
    raise DatabaseError(
app.core.exceptions.DatabaseError: Error en la autenticaciÃ³n: ('42S22', "[42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Invalid column name 'es_eliminado'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Statement(s) could not be prepared. (8180)")
